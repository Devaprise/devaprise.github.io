<!DOCTYPE html>
<html>
<head>
  <title>JavaScript</title>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/processing.js/1.4.8/processing.min.js"></script>
</head>
<body>
  <canvas id="canvas"></canvas>
  <script>
    var canvas = document.getElementById("canvas");
    var processing = new Processing(canvas, function(processing) {
        processing.size(screen.width, screen.height);
        processing.background(0xFFF);
    
        var mouseIsPressed = false;
        processing.mousePressed = function () { mouseIsPressed = true; };
        processing.mouseReleased = function () { mouseIsPressed = false; };

        var keyIsPressed = false;
        processing.keyPressed = function () { keyIsPressed = true; };
        processing.keyReleased = function () { keyIsPressed = false; };

        with (processing) {
            // INSERT YOUR KHAN ACADEMY PROGRAM HERE
            /*
          Wonder Paint
          
          Created by Thomas L.
          on 1/11/2014
          
          Last updated on 8/8/2014
      */
      
      // Set this to false to see your abstract creations slowly fade away
      var paint_mode = true;
      
      var spores = [];
      var record = [];
      
      colorMode(HSB);
      
      var drawSpores = true;
      var bgs = true;
      
      mousePressed = function() {
          drawSpores = true;
          bgs = !bgs;
      };
      
      mouseReleased = function() {
          drawSpores = false;
      };
      
      record.draw = function() {
          if(record.length) {
              var rl = record.length-1;
              var mx = record[rl][0];
              var my = record[rl][1];
              var pmx = record[rl][2];
              var pmy = record[rl][3];
              for (var i = 0; i < round(random(10)); i++) {
                  var r = random(-5,5);
                  var r1 = random(-5,5);
                  var mxr = mx-i*r;
                  var myr = my-i*r1;
                  var sec = random(3,abs(((mx-pmx)%20)+((my-pmx)%20)));
                  
                  spores.add(mxr,myr,1,sec);
                  spores.add(400-mxr,myr,1,sec);
      
      
                  stroke((frameCount)%255, 220, 255);
                  line(mx,my,pmx,pmy);
                  line(400-mx,my,400-pmx,pmy);
              }
          }
          spores.draw();
          record.pop();
          record.pop();
          record.pop();
      };
      
      spores.draw = function() {
          for (var i = 0; i < spores.length; i ++) {
              var s = spores[i];
              if(s.s>s.ms) {
                  spores.splice(i,1);
              } else {
                  s.s++;
              }
              fill(frameCount%255, 220, 255);
              noStroke();
              ellipse(s.x,s.y,s.s,s.s);
          }
          
      };
      
      spores.add = function(x,y,s,ms) {
          spores.push({
              x:x,y:y,s:s,ms:ms
          });
      };
      
      noStroke();
      background(0, 0, 0);
      
      draw = function() {
          noStroke();
          if(bgs) {
              if(drawSpores) {
                  fill(255, 0, 255,40);
              } else {
                  fill(255, 0, 0,40);
              }
          } else {
              if(drawSpores) {
                  fill(255, 0, 0,40);
              } else {
                  fill(255, 0, 255,40);
              }
          }
      
          if(!paint_mode) {
              rect(0,0,width,height);
          }
          
          if(mouseIsPressed) {
              for (var i = 0; i < round(random(10)); i++) {
                  
              var r = random(-5,5);
              var r1 = random(-5,5);
              var mxr = mouseX-i*r;
              var myr = mouseY-i*r1;
              var sec = random(3,abs(((mouseX-pmouseX)%20)+((mouseY-pmouseX)%20)));
              
              record.push([mouseX,mouseY,pmouseX,pmouseY]);
              spores.add(mxr,myr,1,sec);
              
              spores.add(400-mxr,myr,1,sec);
              
              }
              
              stroke((frameCount)%255, 220, 255);
              line(mouseX,mouseY,pmouseX,pmouseY);
              line(400-mouseX,mouseY,400-pmouseX,pmouseY);
          }
          
          if(!paint_mode) {
              fill(0, 0, 0);
              ellipse(pmouseX,pmouseY,2,2);
              ellipse(400-pmouseX,pmouseY,2,2);
              
              fill(0, 0, 255);
              ellipse(mouseX,mouseY,2,2);
              ellipse(400-mouseX,mouseY,2,2);
          }
          
                if(drawSpores) {
                    spores.draw();
                } else {
                    record.draw();
                }
            };
          }
          if (typeof draw !== 'undefined') processing.draw = draw;
      });
    </script>
</body>
</html>
