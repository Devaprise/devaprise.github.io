/**
 * @preserve FastClick: polyfill to remove click delays on browsers with touch UIs.
 *
 * @version 1.0.0
 * @codingstandard ftlabs-jsv2
 * @copyright The Financial Times Limited [All Rights Reserved]
 * @license MIT License (see LICENSE.txt)
 */
function FastClick(e){"use strict";function t(e,t){return function(){return e.apply(t,arguments)}}var a;this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=10,this.layer=e,FastClick.notNeeded(e)||(deviceIsAndroid&&(e.addEventListener("mouseover",t(this.onMouse,this),!0),e.addEventListener("mousedown",t(this.onMouse,this),!0),e.addEventListener("mouseup",t(this.onMouse,this),!0)),e.addEventListener("click",t(this.onClick,this),!0),e.addEventListener("touchstart",t(this.onTouchStart,this),!1),e.addEventListener("touchmove",t(this.onTouchMove,this),!1),e.addEventListener("touchend",t(this.onTouchEnd,this),!1),e.addEventListener("touchcancel",t(this.onTouchCancel,this),!1),Event.prototype.stopImmediatePropagation||(e.removeEventListener=function(t,a,n){var i=Node.prototype.removeEventListener;"click"===t?i.call(e,t,a.hijacked||a,n):i.call(e,t,a,n)},e.addEventListener=function(t,a,n){var i=Node.prototype.addEventListener;"click"===t?i.call(e,t,a.hijacked||(a.hijacked=function(e){e.propagationStopped||a(e)}),n):i.call(e,t,a,n)}),"function"==typeof e.onclick&&(a=e.onclick,e.addEventListener("click",function(e){a(e)},!1),e.onclick=null))}function show_modal(e){$(window).scrollTop(0),$("input, select, textarea").blur(),ELM.modals.add(ELM.modal_bg).attr("class",e),ELM.body.addClass("modal")}function close_modal(){$("section.panel.loading").removeClass("loading"),ELM.modals.add(ELM.modal_bg).attr("class","hide"),ELM.body.removeClass("modal")}function show_notify(e){void 0==e&&(e={}),notify_timeout&&window.clearTimeout(notify_timeout),e.type&&"error"==e.type?ELM.notify.addClass("error"):ELM.notify.removeClass("error"),void 0!==e.text?(ELM.notify.addClass("text"),ELM.notify.children("p").html(e.text)):ELM.notify.removeClass("text"),ELM.notify.addClass("show"),notify_timeout=window.setTimeout(function(){ELM.notify.removeClass("show")},4e3)}function restrictAlpha(e){var t;return e.metaKey||e.ctrlKey?!0:0===e.which?!0:e.which<33?!0:(t=String.fromCharCode(e.which),!!/[a-zA-Z\s]/.test(t))}function restrictAlphaNumeric(e){var t;return e.metaKey||e.ctrlKey?!0:0===e.which?!0:e.which<33?!0:(t=String.fromCharCode(e.which),!!/[a-zA-Z0-9\s]/.test(t))}function email_check(e){var t=/^[^@]+@[^@.]+\.[^@]*\w\w$/,a=/[\(\)\<\>\,\;\:\\\"\[\]]/;return!t.test(e)||e.match(a)?!1:!0}function transactions_fillout(e){var t="",a=window.devicePixelRatio>=1.2?100:50;if(e.count>0)for(var n=0;n<e.sets_count;n++){var i=e.items[n];t=t+'<li class="heading ani">'+i.date+"</li>";for(var s=0;s<i.count;s++){var r=i[s],l=get_currency_symbol(r.currency),o=r.customer_info.name,d=_lc_words.paid.toLowerCase(),c=_lc_words["for"].toLowerCase(),p=_lc_words.payment.toLowerCase(),m=r.id;"terminal"==r.payment_from?(r.space=[],r.space.name=_lc_words.virtual_terminal,d=_lc_words.was_charged,c=_lc_words.via_the):"payme"==r.payment_from?(r.space=[],r.space.name=_lc_words.pay_me_page,d=_lc_words.paid_you.toLowerCase(),c=_lc_words.via_your):"invoice"==r.payment_from?(r.space=[],r.space.name=_lc_words.invoice,d=_lc_words.paid_you.toLowerCase(),c=_lc_words.via_an):(p="onetime"==r.space.type?"payment":"member",m="membership"==r.space.type?r.member_id:m,o="me"==r.buyer_type?_lc_words.you:r.customer_info.name);var u="YES"==r.refunded?'<div class="icon icon-badge refunded"><strong>'+_lc_words.refunded+"</strong></div>":"",_="YES"==r.shipped?'<div class="icon icon-badge shipped"><strong>'+_lc_words.shipped+"</strong></div>":"";t=t+'<li data-id="'+m+'" data-buyer-type="'+r.buyer_type+'" class="'+p+' ani"><div class="avatar"><img src="https://www.gravatar.com/avatar/'+r.customer_info.avatar+"?s="+a+"&d="+encodeURIComponent(s3_url+"media/default-avatar_"+a+".png")+'" alt=""></div><h4>'+o+' <span class="light">'+d+"</span> "+l+r.amount+' <span class="light">'+c+"</span> "+r.space.name+'</h4><div class="arrow"></div><div class="right-text"><div class="wrap"><div class="inner">'+u+_+'<strong class="text">'+r.transaction_id+"</strong></div></div></div></li>"}}""!=t?(ELM.panel_dash_recent.find(".search-field").removeAttr("style"),ELM.recent_list.html(t),animation_setup({elem:ELM.recent_list,delay:50,do_filter:!0})):(ELM.panel_dash_recent.find(".search-field").hide(),ELM.recent_list.html('<li class="none">'+_lc_words.no_payments_yet+"</li>"))}function space_setup_fillout(e,t){e.addClass("fetched").data("reports",t.reports);var a=ELM.panel_setup.find("form"),n=get_currency_symbol(t.charge_currency),i=$("#upload_background"),s=t.logo;if(ELM.panel_setup.attr("data-id",t.id).attr("data-type",e.attr("data-type")).attr("data-cursym",n),$("#setup_view_space").attr("href",base_url+"s/"+t.url_name),$("#space_url").attr("href",base_url+"s/"+t.url_name).text(base_url+"s/"+t.url_name),$("#space_tweet").attr("href","https://twitter.com/intent/tweet/?text="+encodeURIComponent("Check out "+t.name+":")+"&url="+encodeURIComponent(base_url+"s/"+t.url_name)),$("#space_fb").attr("href","http://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(base_url+"s/"+t.url_name)),i.attr("data-type",t.bg_appearance),i.attr("data-value",t.bg_color).find(".inner.open-colorpicker").attr("data-value",t.bg_color).attr("style","background-color:#"+t.bg_color+";"),window.devicePixelRatio>=1.2&&(s="default_space_200.jpg"==t.logo?t.logo.replace("_200.jpg","_400.jpg"):t.logo.replace(".jpg","_400.jpg")),ELM.panel_setup.children("header:first").attr("data-bg_image",s3_url+"theme/"+t.bg_image).find("img").attr("src",s3_url+"theme/"+s),"image"==t.bg_appearance?(ELM.panel_setup.children("header:first").attr("style","background-image:url('"+s3_url+"theme/"+t.bg_image+"');").removeClass("color dark light").addClass("image"),i.find(".tab-switch a.image").trigger("click")):(ELM.panel_setup.children("header:first").attr("style","background-color:#"+t.bg_color+";").removeClass("image dark light").addClass("color "+get_color_contrast(t.bg_color)),i.find(".tab-switch a.color").trigger("click")),"default_space_200.jpg"==t.logo?$("#upload_logo").removeClass("image").children(".inner:first").removeAttr("style"):$("#upload_logo").addClass("image").children(".inner:first").attr("style","background-image:url('"+s3_url+"theme/"+s+"');"),"default_space_bg.jpg"==t.bg_image?i.removeClass("image").children(".inner:first").removeAttr("style"):i.addClass("image").children(".inner:first").attr("style","background-image:url('"+s3_url+"theme/"+t.bg_image+"');"),ELM.shipping_list.parents(".shipping").add($("#invoice_address_fields")).removeClass("show"),"onetime"==t.type?(a.find("select[name=space_mode] option.pre-order").length<=0&&a.find("select[name=space_mode] option:last").before('<option class="pre-order" value="pre-order">'+_lc_words.pre_order+"</option>"),a.find("input[name=require_shipping]").parents("label").removeClass("left").addClass("right half")):"membership"==t.type&&(a.find("select[name=space_mode] option.pre-order").remove(),a.find("input[name=require_shipping]").parents("label").removeClass("right left half")),"pre-order"==t.space_mode?$("#setup_charge_date").css("display","block").find("input").val(t.charge_date):$("#setup_charge_date").hide(),a.find("select[name=charge_currency]").length>0&&(a.find("select[name=charge_currency]")[0].value=t.charge_currency),$("#setup_space_title").html(t.name),$("#setup_today_stat dd").html(n+t.reports.today),a.find("input[name=name]").val(t.name),a.find("input[name=charge_amount]").val(t.charge_amount),a.find("textarea[name=description]").val(t.description),a.find("textarea[name=terms]").val(t.terms),a.find("input[name=seller_name]").val(t.seller_name),a.find("input[name=seller_email]").val(t.seller_email),a.find("input[name=seller_website]").val(t.seller_website),a.find("input[name=return_url]").val(t.return_url),a.find("input[name=analytics]").val(t.analytics),a.find("input[name=tax_amount]").val(t.tax_amount),a.find("input[name=invoice_address]").val(t.invoice_address),a.find("input[name=invoice_city]").val(t.invoice_city),a.find("input[name=invoice_state]").val(t.invoice_state),a.find("input[name=invoice_zip]").val(t.invoice_zip),a.find("input[name=invoice_country]").val(t.invoice_country),a.find("select[name=analytics_service]")[0].value=t.analytics_service,a.find("select[name=space_mode]")[0].value=t.space_mode,a.find("select[name=space_mode]").attr("data-mode",t.space_mode),"YES"==t.require_billing&&0==a.find("input[name=require_billing]:checked").length&&a.find("input[name=require_billing]").click(),"YES"==t.require_shipping&&0==a.find("input[name=require_shipping]:checked").length&&a.find("input[name=require_shipping]").click(),"YES"==t.email_me&&0==a.find("input[name=email_me]:checked").length&&a.find("input[name=email_me]").click(),"YES"==t.in_market&&0==a.find("input[name=in_market]:checked").length&&a.find("input[name=in_market]").click(),"YES"==t.allow_coupons&&0==a.find("input[name=allow_coupons]:checked").length&&a.find("input[name=allow_coupons]").click(),"YES"==t.send_invoice&&0==a.find("input[name=send_invoice]:checked").length&&a.find("input[name=send_invoice]").click(),"YES"==t.add_tax&&0==a.find("input[name=add_tax]:checked").length?a.find("input[name=add_tax]").click():a.find("input[name=tax_amount]").parents("label:first").removeClass("show"),t.plans){var r=ELM.spaces_nav.find("li.selected a.plans");r.hasClass("fetched")||r.data("fetched_data",t.plans).addClass("fetched")}if(ELM.shipping_list.html(""),t.shipping_options&&""!=t.shipping_options){for(var l=t.shipping_options,o=0;o<l.length;o++)ELM.shipping_list.append('<li><input type="text" class="name inline" placeholder="'+_lc_words.fee_name+'" value="'+l[o].name+'" title="'+_lc_words.fee_name+'"><span class="currency inline"><strong>'+n+'</strong><input type="text" class="amount price" value="'+l[o].amount+'" placeholder="10.99" min="1" title="'+n+" "+_lc_words.amount+'"></span><a href="" class="icon delete push" title="'+_lc_words["delete"]+'">✕</a></li>');ELM.shipping_list.find("input.price").payment("restrictPrice")}else ELM.shipping_list.html('<li class="none">'+_lc_words.none+"</li>");$(window).scrollTop(0),ELM.panel_setup.removeClass("loading")}function products_list_fillout(e){var t=ELM.panel_setup.attr("data-cursym"),a=1==e.count?_lc_words.product:_lc_words.products;if($("#products_total_items").text(e.count+" "+a),e.count>0){for(var n=[],i=0;i<e.count;i++){var s=e.items[i],r="any"==s.type?_lc_words.any:t+s.amount,l=$('<li data-id="'+s.id+'" class="ani"><div class="handle"><em></em><em></em><em></em></div><h4>'+s.name+'</h4><div class="arrow"></div><div class="right-text full"><div class="wrap"><div class="inner"><div class="text">'+r+"</div></div></div></div></li>");n.push(l)}ELM.products_list.html(n).sortable("reload"),animation_setup({elem:ELM.products_list,delay:0,do_filter:!0})}else ELM.products_list.html('<li class="none">'+_lc_words.no_products_yet+"</li>");ELM.panel_products.removeClass("loading")}function product_upload_handler(e,t,a,n){if(t&&!e.hasClass("stale")){var i=!1,s={product_id:t,space_id:ELM.spaces_nav.find("li.selected").attr("data-id"),name:e.parents("li:first").find("input.name").val(),filename:e[0].files[0].name,filesize:e[0].files[0].size,filetype:e[0].files[0].type};a&&(s.file_id=a);var r=e[0].files[0],l=function(t){if(t.lengthComputable){var a=Math.round(100*t.loaded/t.total);100==a?e.parents("li:first").removeClass("progress"):e.parents("li:first").find("div.progress-bar div.inner").css("width",a+"%")}};if(!i){var o=[];ELM.files_list.children("li").each(function(){null!=$(this).attr("data-id")&&o.push({id:$(this).attr("data-id")})}),s.order=o,e.addClass("stale"),e.parents("li:first").addClass("progress"),$.ajax({type:"POST",url:base_url+"api/files",data:JSON.stringify(s),success:function(i){var o=i.upload;$.ajax({type:"PUT",url:decodeURIComponent(o.upload_url),data:r,cache:!1,contentType:!1,processData:!1,dataType:!1,headers:{"x-amz-acl":"private","Content-Type":s.filetype},xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",function(e){l(e)},!1),e},success:function(n){a?(e.parents("li:first").find("a.download").attr("href",o.download_url),e.find("input").remove(),e.prepend('<input type="file">')):(e.parents("li:first").removeClass("progress new").addClass("saved").attr("data-id",o.id),e.parents("a:first").after('<a href="'+o.download_url+'" class="icon download push" title="'+_lc_words.download_file+'">↓</a><a href="" class="icon delete push" title="'+_lc_words["delete"]+'">✕</a>'),e.parents("a:first").remove());var i=ELM.spaces_nav.find("li.selected a.products").data("fetched_data");for(var s in i)if(i[s].id==t){i[s].files=n.items;break}ELM.spaces_nav.find("li.selected a.products").data("fetched_data",i),e.parents("li:first").removeClass("progress"),show_notify({text:_lc_words.file_uploaded})},error:function(t){e.parents("li:first").removeClass("progress"),e.find("input").remove(),e.prepend('<input type="file">'),ajax_error(t)},complete:function(){n&&n()}})},error:function(t){e.parents("li:first").removeClass("progress"),ajax_error(t)}})}}}function data_list_fillout(e){ELM.panel_data.find("footer a.submit").removeClass("disabled");var t=ELM.panel_setup.attr("data-cursym"),a=1==e.count?_lc_words.data_item:_lc_words.data_items;if($("#data_total_items").html("<span>"+e.count+"</span> "+a),e.count>0){for(var n=[],i=0;i<e.count;i++){var s=e.items[i],r=$('<li class="saved ani no-highlight" data-id="'+s.id+'"><div class="handle"><em></em><em></em><em></em></div><input type="text" class="name inline" placeholder="'+_lc_words.name+'" value="'+s.name+'" title="'+_lc_words.name+'"><label class="general-holder"><input type="checkbox" class="required"> '+_lc_words.required+'</label><div class="select-holder"><select class="type"><option value="general">'+_lc_words.general_text+'</option><option value="email">'+_lc_words.email+'</option><option value="letters">'+_lc_words.letters_only+'</option><option value="numbers">'+_lc_words.numbers_only+'</option><option value="alpha">'+_lc_words.alphanumeric_only+'</option><option value="textarea">'+_lc_words.textarea+'</option></select></div><a href="" class="icon delete push" title="'+_lc_words["delete"]+'">✕</a></li>');r.find("select")[0].value=s.type,"YES"==s.required&&r.find("input.required").attr("checked","checked"),n.push(r)}ELM.data_list.html(n).sortable("reload"),animation_setup({elem:ELM.data_list,delay:0,do_filter:!0})}else ELM.data_list.html('<li class="none">'+_lc_words.no_data_items_yet+"</li>"),ELM.panel_data.find("footer").hide();ELM.panel_data.removeClass("loading")}function content_list_fillout(e){var t=ELM.panel_setup.attr("data-cursym"),a=1==e.count?_lc_words.post:_lc_words.posts;if($("#content_total_items").text(e.count+" "+a),e.count>0){for(var n=[],i=0;i<e.count;i++){var s=e.items[i],r=""==s.clip||" "==s.clip?s.original_filename:s.clip,l=$('<li data-id="'+s.id+'" class="ani"><h4>'+r+'</h4><div class="arrow"></div><div class="right-text full"><div class="wrap"><div class="inner"><time class="text">'+s.time+"</time></div></div></div></li>");""!=s.original_filename&&null!=s.original_filename&&l.addClass("file").prepend('<div class="icon"></div>'),n.push(l)}var o=ELM.panel_content_item.find("form span.checks-holder"),d=ELM.spaces_nav.find("li.selected a.plans").data("fetched_data");o.html("");for(var c=0;c<d.count;c++){var s=d.items[c],p=s.interval_count>0?s.interval_count+" "+s.interval+"s":s.interval;o.append('<label><input type="checkbox" name="plans[]" value="'+s.id+'"> '+s.name+"</label>")}ELM.content_list.html(n),animation_setup({elem:ELM.content_list,delay:0,do_filter:!0})}else ELM.content_list.html('<li class="none">'+_lc_words.no_posts_yet+"</li>");ELM.panel_content.removeClass("loading")}function plans_list_fillout(e){var t=ELM.panel_setup.attr("data-cursym"),a=1==e.count?_lc_words.plan:_lc_words.plans;if($("#plans_total_items").text(e.count+" "+a),e.count>0){for(var n=[],i=0;i<e.count;i++){var s=e.items[i],r=s.interval_count>0?s.interval_count+" "+s.interval+"s":s.interval,l=$('<li data-id="'+s.id+'" class="ani"><div class="handle"><em></em><em></em><em></em></div><h4>'+s.name+'</h4><div class="arrow"></div><div class="right-text full"><div class="wrap"><div class="inner"><div class="text capitalize"><strong>'+t+s.amount+"</strong> / "+r+"</div></div></div></div></li>");""!=s.original_filename&&null!=s.original_filename&&l.addClass("file").prepend('<div class="icon" data-icon="◰"></div>'),n.push(l)}ELM.plans_list.html(n).sortable("reload"),animation_setup({elem:ELM.plans_list,delay:0,do_filter:!0})}else ELM.plans_list.html('<li class="none">'+_lc_words.no_plans_yet+"</li>");ELM.panel_plans.removeClass("loading")}function payments_fillout(e){for(var t=[],a=0;a<e.data.count;a++){var n=e.data.items[a],i=get_currency_symbol(n.currency),s="YES"==n.refunded?'<div class="icon icon-badge refunded"><strong>'+_lc_words.refunded+"</strong></div>":"",r="YES"==n.shipped?'<div class="icon icon-badge shipped"><strong>'+_lc_words.shipped+"</strong></div>":"";if("member"==e.type)var l=n.transaction_id;else var l=void 0!=n.customer_info.email&&""!=n.customer_info.email?n.customer_info.email:n.customer_info.name;t.push($('<li data-id="'+n.id+'" class="ani"><h4 class="inline">'+i+n.amount+'</h4><div class="left-text">'+l+'</div><div class="arrow"></div><div class="right-text"><div class="wrap"><div class="inner">'+r+s+'<time class="text">'+n.time+"</time></div></div></div></li>"))}e.data._append?e.list_elem.append(t):e.list_elem.html(t),animation_setup({elem:e.list_elem,delay:0,do_filter:!0}),void 0!=e.data._fetched&&t.length>19&&e.list_elem.parent().find("a.load-more").removeAttr("style")}function _get_refunds_html(e){for(var t="",a=0;a<e.refunds.length;a++)t+="<li><h4>"+e.refunds[a].time+'</h4><div class="right-text full"><div class="wrap"><div class="inner"><div class="text">-'+e.cur_sym+e.refunds[a].amount+"</div></div></div></div></li>";return t=t+'<li class="last"><div class="right-text inline"><div class="wrap"><div class="inner"><div class="total red"><small>'+_lc_words.total_refunded+"</small><span>"+e.cur_sym+e.refunded_amount+'</span></div></div></div></li><li class="last"><div class="right-text inline"><div class="wrap"><div class="inner"><div class="total"><small>'+_lc_words.total_after_refunds+"</small><span>"+e.cur_sym+e.amount_after_refunds+"</span></div></div></div></li>"}function members_fillout(e){if(e.count>0){ELM.panel_members.find(".search-field").removeAttr("style");for(var t=[],a=0;a<e.count;a++){var n=e.items[a],i=window.devicePixelRatio>=1.2?100:50;window.devicePixelRatio>=3&&(i=200);var s=n.plan_name&&null!=n.plan_name?'<div class="badge">'+n.plan_name+"</div>":"",r=""!=n.email?n.email:n.name,l="YES"==n.deleted?" gone":"";t.push('<li data-id="'+n.id+'" class="ani'+l+'"><div class="avatar"><img src="https://www.gravatar.com/avatar/'+n.avatar+"?s="+i+"&d="+encodeURIComponent(s3_url+"media/default-avatar_"+i+".png")+'" alt=""></div><h4>'+r+'</h4><div class="arrow"></div><div class="right-text full"><div class="wrap"><div class="inner">'+s+'<time class="text">'+n.time+"</time></div></div></div></li>")}e._append?ELM.members_list.append(t):ELM.members_list.html(t),animation_setup({elem:ELM.members_list,delay:0,do_filter:!0}),void 0!=e._fetched&&t.length>19&&ELM.panel_members.find("a.load-more").removeAttr("style")}else ELM.panel_members.find(".search-field").hide(),ELM.members_list.html('<li class="none noclick">'+_lc_words.no_members_yet+"</li>")}function ajax_error(e){var t=_lc_words.error_please_try_again;if(void 0!==e.error.message)t=e.error.message;else if(void 0!==e.responseText){var a=$.parseJSON(e.responseText);a&&void 0!==a.error&&(t=a.error)}a&&void 0!==a.login&&!e.LOGIN_REQ?show_modal("log-back-in"):a&&void 0!==a.logout?window.location=base_url+"login":show_notify({type:"error",text:t})}function element_display_error(e,t,a){a="undefined"!=typeof a?a:42,show_notify({type:"error",text:t}),e.parent().find(".error-description").length<=0&&(e.addClass("error"),a&&e.after('<div class="error-description">'+t+"</div>"))}function remove_display_errors(e){e.find(".error").removeClass("error"),e.find(".error-description").remove()}function confirmation(e,t,a){a="undefined"!=typeof a?a:!0,a?ELM.dialog.find("a.btn.cancel").unbind("click").click(function(e){close_modal(),t(!1),e.preventDefault()}).show():ELM.dialog.find("a.btn.cancel").hide(),ELM.dialog.find("a.btn.ok").text("OK").unbind("click").click(function(e){t(!0),close_modal(),e.preventDefault()}),ELM.dialog.find("div.inner > p").html(e),show_modal("dialog")}function do_upload_image(e){var t=e.elem,a=t.attr("name"),n=new FormData,i=!1;""!=t.val().replace("C:\\fakepath\\","")&&(t[0].files[0]&&"image/jpeg"!=t[0].files[0].type&&"image/png"!=t[0].files[0].type&&"image/gif"!=t[0].files[0].type?(show_notify({type:"error",text:"Images must be either a JPG, PNG or GIF"}),i=!0):n.append(a,t[0].files[0]));var s=function(e){if(e.lengthComputable){var a=Math.round(100*e.loaded/e.total);100==a?t.parents(".upload-holder").removeClass("progress"):t.parents(".upload-holder").find("div.progress-bar div.inner").css("width",a+"%")}};i||(t.parents(".upload-holder").addClass("progress").find("div.progress-bar div.inner").css("width","0%"),$.ajax({type:"POST",url:base_url+e.url,data:n,cache:!1,contentType:!1,processData:!1,dataType:!1,xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",function(e){s(e)},!1),e},success:function(a){t.parents(".upload-holder").removeClass("progress").addClass("image"),e.callback(a)},error:function(e){t.parents(".upload-holder").removeClass("progress"),ajax_error(e)}}))}function email_check(e){var t=/^[^@]+@[^@.]+\.[^@]*\w\w$/,a=/[\(\)\<\>\,\;\:\\\"\[\]]/;return!t.test(e)||e.match(a)?!1:!0}function get_currency_symbol(e){return e=e.toLowerCase(),"gbp"==e?"&#163;":"eur"==e?"&#8364;":"xpf"==e?"&#8355;":"yen"==e?"&#165;":"zar"==e?"R":"$"}function add_button_spinner(e){var t=e.elem.outerWidth(),a=e.elem.html();e.elem.data("text",a).html("&nbsp;").css("width",t).addClass("stale").spin({lines:10,length:3,width:2,radius:4,color:e.color,speed:1,trail:40,shadow:!1})}function remove_button_spinner(e){var t=e.data("text");e.html(t).removeAttr("style").removeClass("stale")}function validate_date(e){var t,a,n,i,s;return 10!==e.length?!1:"/"!==e.substring(2,3)||"/"!==e.substring(5,6)?!1:(i=e.substring(0,2)-1,n=e.substring(3,5)-0,s=e.substring(6,10)-0,1e3>s||s>3e3?!1:(a=new Date(s,i,n).getTime(),t=new Date,t.setTime(a),t.getFullYear()!==s||t.getMonth()!==i||t.getDate()!==n?!1:!0))}function animation_setup(e){var t="undefined"!=typeof e.start?e.start:!1,a="undefined"!=typeof e.end?e.end:!1,n=e.elem.find(e.do_filter?".ani:not(.ani-ran)":".ani"),i=n.length,s="ani_"+e.elem.parents("[id]:eq(0)").attr("id");if(t&&window.setTimeout(function(){t()},0),animation_object[s])for(e.elem.find(".ani-go").removeClass("ani-go"),clearTimeout(animation_object[s]),clearTimeout(animation_object[s+"__end"]),y=0;i>y;y++)clearTimeout(animation_object[s+"_s"+y]),clearTimeout(animation_object[s+"_e"+y]);animation_object[s]=window.setTimeout(function(){n.each(function(e){var t=$(this),n=40*(e+1),r=700>200*i?700:200*i;animation_object[s+"_s"+e]=window.setTimeout(function(){t.addClass("ani-go ani-ran")},n),animation_object[s+"_e"+e]=window.setTimeout(function(){t.removeClass("ani-go")},r),e==i-1&&a&&(animation_object[s+"__end"]=window.setTimeout(function(){a()},r))})},e.delay)}function get_color_contrast(e){return parseInt(e,16)>8388607.5?"dark":"light"}function is_odd_number(e){return e%2}function SwipeParserObj(e){function t(e){return null==e?"":e.replace(/[^0-9]/g,"")}if(this.input_trackdata_str=e,this.account_name=null,this.surname=null,this.firstname=null,this.acccount=null,this.exp_month=null,this.exp_year=null,this.track1=null,this.track2=null,this.hasTrack1=!1,this.hasTrack2=!1,sTrackData=this.input_trackdata_str,""!=e){if(nHasTrack1=e.indexOf("^"),nHasTrack2=e.indexOf("="),this.hasTrack1=bHasTrack1=!1,this.hasTrack2=bHasTrack2=!1,nHasTrack1>0&&(this.hasTrack1=bHasTrack1=!0),nHasTrack2>0&&(this.hasTrack2=bHasTrack2=!0),bTrack1_2=!1,bTrack1=!1,bTrack2=!1,bHasTrack1&&bHasTrack2&&(bTrack1_2=!0),bHasTrack1&&!bHasTrack2&&(bTrack1=!0),!bHasTrack1&&bHasTrack2&&(bTrack2=!0),bShowAlert=!1,bTrack1_2){strCutUpSwipe=""+e+" ",arrayStrSwipe=new Array(4),arrayStrSwipe=strCutUpSwipe.split("^");var a,n,i,s,r;if(arrayStrSwipe.length>2){this.account=t(arrayStrSwipe[0].substring(1,arrayStrSwipe[0].length)),this.account_name=arrayStrSwipe[1],this.exp_month=arrayStrSwipe[2].substring(2,4),this.exp_year="20"+arrayStrSwipe[2].substring(0,2),"%"==sTrackData.substring(0,1)&&(sTrackData=sTrackData.substring(1,sTrackData.length));var l=sTrackData.indexOf(";");-1!=l&&(this.track1=sTrackData.substring(0,l),this.track2=sTrackData.substring(l));var o=this.account_name.indexOf("/");-1!=o&&(this.surname=this.account_name.substring(0,o),this.firstname=this.account_name.substring(o+1))}else bShowAlert=!0}if(bTrack1){strCutUpSwipe=""+e+" ",arrayStrSwipe=new Array(4),arrayStrSwipe=strCutUpSwipe.split("^");var a,n,i,s,r;if(arrayStrSwipe.length>2){this.account=a=t(arrayStrSwipe[0].substring(1,arrayStrSwipe[0].length)),this.account_name=n=arrayStrSwipe[1],this.exp_month=s=arrayStrSwipe[2].substring(2,4),this.exp_year=r="20"+arrayStrSwipe[2].substring(0,2),"%"==sTrackData.substring(0,1)&&(this.track1=sTrackData=sTrackData.substring(1,sTrackData.length)),this.track2=";"+a+"="+r.substring(2,4)+s+"111111111111?",sTrackData+=this.track2;var o=this.account_name.indexOf("/");-1!=o&&(this.surname=this.account_name.substring(0,o),this.firstname=this.account_name.substring(o+1))}else bShowAlert=!0}bTrack2&&(nSeperator=e.indexOf("="),sCardNumber=e.substring(1,nSeperator),r=e.substr(nSeperator+1,2),s=e.substr(nSeperator+3,2),this.account=a=t(sCardNumber),this.exp_month=s=s,this.exp_year=r="20"+r,"%"==sTrackData.substring(0,1)&&(sTrackData=sTrackData.substring(1,sTrackData.length)))}this.dump=function(){var e="",t="\r";return e+="Name: "+this.account_name+t,e+="Surname: "+this.surname+t,e+="first name: "+this.firstname+t,e+="account: "+this.account+t,e+="exp_month: "+this.exp_month+t,e+="exp_year: "+this.exp_year+t,e+="has track1: "+this.hasTrack1+t,e+="has track2: "+this.hasTrack2+t,e+="TRACK 1: "+this.track1+t,e+="TRACK 2: "+this.track2+t,e+="Raw Input Str: "+this.input_trackdata_str+t}}!function(e){var t,a,n=e();e.fn.sortable=function(i){var s=String(i);return i=e.extend({connectWith:!1,placeholder:null,dragImage:null},i),this.each(function(){if("reload"===s&&e(this).children(i.items).off("dragstart.h5s dragend.h5s selectstart.h5s dragover.h5s dragenter.h5s drop.h5s"),/^enable|disable|destroy$/.test(s)){var r=e(this).children(e(this).data("items")).attr("draggable","enable"===s);return void("destroy"===s&&(e(this).off("sortupdate"),e(this).removeData("opts"),r.add(this).removeData("connectWith items").off("dragstart.h5s dragend.h5s selectstart.h5s dragover.h5s dragenter.h5s drop.h5s").off("sortupdate")))}var l=e(this).data("opts");"undefined"==typeof l?e(this).data("opts",i):i=l;var o,d,c=e(this).children(i.items),p,m,u=null===i.placeholder?e("<"+(/^ul|ol$/i.test(this.tagName)?"li":"div")+' class="sortable-placeholder">'):e(i.placeholder).addClass("sortable-placeholder");c.find(i.handle).mousedown(function(){o=!0}).mouseup(function(){o=!1}),e(this).data("items",i.items),n=n.add(u),i.connectWith&&e(i.connectWith).add(this).data("connectWith",i.connectWith),c.attr("role","option"),c.attr("aria-grabbed","false"),c.attr("draggable","true").on("dragstart.h5s",function(n){if(n.stopImmediatePropagation(),i.handle&&!o)return!1;o=!1;var s=n.originalEvent.dataTransfer;s.effectAllowed="move",s.setData("text",""),i.dragImage&&s.setDragImage&&s.setDragImage(i.dragImage,0,0),d=(t=e(this)).addClass("sortable-dragging").attr("aria-grabbed","true").index(),a=t.outerHeight(),p=e(this).parent()}).on("dragend.h5s",function(){t&&(t.removeClass("sortable-dragging").attr("aria-grabbed","false").show(),n.detach(),m=e(this).parent(),(d!==t.index()||p.get(0)!==m.get(0))&&t.parent().triggerHandler("sortupdate",{item:t,oldindex:d,startparent:p,endparent:m}),t=null,a=null)}).not("a[href], img").on("selectstart.h5s",function(){return i.handle&&!o?!0:(this.dragDrop&&this.dragDrop(),!1)}).end().add([this,u]).on("dragover.h5s dragenter.h5s drop.h5s",function(s){if(!c.is(t)&&i.connectWith!==e(t).parent().data("connectWith"))return!0;if("drop"===s.type)return s.stopPropagation(),n.filter(":visible").after(t),t.trigger("dragend.h5s"),!1;if(s.preventDefault(),s.originalEvent.dataTransfer.dropEffect="move",c.is(this)){var r=e(this).outerHeight();if(i.forcePlaceholderSize&&u.height(a),r>a){var l=r-a,o=e(this).offset().top;if(u.index()<e(this).index()&&s.originalEvent.pageY<o+l)return!1;if(u.index()>e(this).index()&&s.originalEvent.pageY>o+r-l)return!1}t.hide(),e(this)[u.index()<e(this).index()?"after":"before"](u),n.not(u).detach()}else n.is(this)||e(this).children(i.items).length||(n.detach(),e(this).append(u));return!1})})}}(jQuery),function(){var $,e,t,a,n,i,s,r,l,o,d,c,p,m,u,_,f,h,v,g,y=[].slice,b=[].indexOf||function(e){for(var t=0,a=this.length;a>t;t++)if(t in this&&this[t]===e)return t;return-1},E=this;$=jQuery,$.payment={},$.payment.fn={},$.fn.payment=function(){var e,t;return t=arguments[0],e=2<=arguments.length?y.call(arguments,1):[],$.payment.fn[t].apply(this,e)},n=/(\d{1,4})/g,a=[{type:"maestro",pattern:/^(5018|5020|5038|6304|6759|676[1-3])/,format:n,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:!0},{type:"dinersclub",pattern:/^(36|38|30[0-5])/,format:n,length:[14],cvcLength:[3],luhn:!0},{type:"laser",pattern:/^(6706|6771|6709)/,format:n,length:[16,17,18,19],cvcLength:[3],luhn:!0},{type:"jcb",pattern:/^35/,format:n,length:[16],cvcLength:[3],luhn:!0},{type:"unionpay",pattern:/^62/,format:n,length:[16,17,18,19],cvcLength:[3],luhn:!1},{type:"discover",pattern:/^(6011|65|64[4-9]|622)/,format:n,length:[16],cvcLength:[3],luhn:!0},{type:"mastercard",pattern:/^5[1-5]/,format:n,length:[16],cvcLength:[3],luhn:!0},{type:"amex",pattern:/^3[47]/,format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[3,4],luhn:!0},{type:"visa",pattern:/^4/,format:n,length:[13,14,15,16],cvcLength:[3],luhn:!0}],e=function(e){var t,n,i;for(e=(e+"").replace(/\D/g,""),n=0,i=a.length;i>n;n++)if(t=a[n],t.pattern.test(e))return t},t=function(e){var t,n,i;for(n=0,i=a.length;i>n;n++)if(t=a[n],t.type===e)return t},p=function(e){var t,a,n,i,s,r;for(n=!0,i=0,a=(e+"").split("").reverse(),s=0,r=a.length;r>s;s++)t=a[s],t=parseInt(t,10),(n=!n)&&(t*=2),t>9&&(t-=9),i+=t;return i%10===0},c=function(e){var t;return null!=e.prop("selectionStart")&&e.prop("selectionStart")!==e.prop("selectionEnd")?!0:("undefined"!=typeof document&&null!==document&&null!=(t=document.selection)&&"function"==typeof t.createRange?t.createRange().text:void 0)?!0:!1},m=function(e){var t=this;return setTimeout(function(){var t,a;return t=$(e.currentTarget),a=t.val(),a=$.payment.formatCardNumber(a),t.val(a)})},r=function(t){var a,n,i,s,r,l,o;return i=String.fromCharCode(t.which),!/^\d+$/.test(i)||(a=$(t.currentTarget),o=a.val(),n=e(o+i),s=(o.replace(/\D/g,"")+i).length,l=16,n&&(l=n.length[n.length.length-1]),s>=l||null!=a.prop("selectionStart")&&a.prop("selectionStart")!==o.length)?void 0:(r=n&&"amex"===n.type?/^(\d{4}|\d{4}\s\d{6})$/:/(?:^|\s)(\d{4})$/,r.test(o)?(t.preventDefault(),a.val(o+" "+i)):r.test(o+i)?(t.preventDefault(),a.val(o+i+" ")):void 0)},i=function(e){var t,a;return t=$(e.currentTarget),a=t.val(),e.meta||8!==e.which||null!=t.prop("selectionStart")&&t.prop("selectionStart")!==a.length?void 0:/\d\s$/.test(a)?(e.preventDefault(),t.val(a.replace(/\d\s$/,""))):/\s\d?$/.test(a)?(e.preventDefault(),t.val(a.replace(/\s\d?$/,""))):void 0},l=function(e){var t,a,n;if(a=String.fromCharCode(e.which),/^\d+$/.test(a)){if(t=$(e.currentTarget),n=t.val()+a,/^\d$/.test(n)&&"0"!==n&&"1"!==n)return e.preventDefault(),t.val("0"+n+"/");if(/^\d\d$/.test(n))return e.preventDefault(),t.val(""+n+"/");if(/^\d\d\/\d\d$/.test(n)){e.preventDefault();
var i=n.split("/");return t.val("20"!==i[1]?i[0]+"/20"+i[1]:n)}}},o=function(e){var t,a,n;return a=String.fromCharCode(e.which),/^\d+$/.test(a)?(t=$(e.currentTarget),n=t.val(),/^\d\d$/.test(n)?t.val(""+n+"/"):void 0):void 0},d=function(e){var t,a,n;return a=String.fromCharCode(e.which),"/"===a?(t=$(e.currentTarget),n=t.val(),/^\d$/.test(n)&&"0"!==n?t.val("0"+n+"/"):void 0):void 0},s=function(e){var t,a;if(!e.meta&&(t=$(e.currentTarget),a=t.val(),8===e.which&&(null==t.prop("selectionStart")||t.prop("selectionStart")===a.length)))return/\d(\s|\/)+$/.test(a)?(e.preventDefault(),t.val(a.replace(/\d(\s|\/)*$/,""))):/\/?\d?$/.test(a)?(e.preventDefault(),t.val(a.replace(/\/?\d?$/,""))):void 0},v=function(e){var t;return e.metaKey||e.ctrlKey?!0:32===e.which?!1:0===e.which?!0:e.which<33?!0:(t=String.fromCharCode(e.which),!!/[\d\s]/.test(t))},h=function(e){var t;if(e.metaKey||e.ctrlKey)return!0;if(32===e.which)return!1;if(0===e.which)return!0;if(e.which<33)return!0;t=String.fromCharCode(e.which);var a=this.value.indexOf("."),n=this.selectionStart;return"."===t&&""===this.value?!1:-1!==a&&"."===t?!1:"."===t&&n<this.value.length-2?!1:-1!==a&&a+2<this.value.length&&!c($(e.currentTarget))?!1:!!/[0-9\.]/.test(t)},_=function(t){var a,n,i,s;return a=$(t.currentTarget),i=String.fromCharCode(t.which),/^\d+$/.test(i)&&!c(a)?(s=(a.val()+i).replace(/\D/g,""),n=e(s),n?s.length<=n.length[n.length.length-1]:s.length<=16):void 0},f=function(e){var t,a,n;return t=$(e.currentTarget),a=String.fromCharCode(e.which),/^\d+$/.test(a)&&!c(t)?(n=t.val()+a,n=n.replace(/\D/g,""),n.length>6?!1:void 0):void 0},u=function(e){var t,a,n;return t=$(e.currentTarget),a=String.fromCharCode(e.which),/^\d+$/.test(a)?(n=t.val()+a,n.length<=4):void 0},g=function(e){var t,n,i,s,r;return t=$(e.currentTarget),r=t.val(),s=$.payment.cardType(r)||"unknown",t.hasClass(s)?void 0:(n=function(){var e,t,n;for(n=[],e=0,t=a.length;t>e;e++)i=a[e],n.push(i.type);return n}(),t.removeClass("unknown"),t.removeClass(n.join(" ")),t.addClass(s),t.toggleClass("identified","unknown"!==s),t.trigger("payment.cardType",s))},$.payment.fn.formatCardCVC=function(){return this.payment("restrictNumeric"),this.on("keypress",u),this},$.payment.fn.formatCardExpiry=function(){return this.payment("restrictNumeric"),this.on("keypress",f),this.on("keypress",l),this.on("keypress",d),this.on("keypress",o),this.on("keydown",s),this},$.payment.fn.formatCardNumber=function(){return this.payment("restrictNumeric"),this.on("keypress",_),this.on("keypress",r),this.on("keydown",i),this.on("keyup",g),this.on("paste",m),this},$.payment.fn.restrictNumeric=function(){return this.on("keypress",v),this},$.payment.fn.restrictPrice=function(){return this.on("keypress",h),this},$.payment.fn.cardExpiryVal=function(){return $.payment.cardExpiryVal($(this).val())},$.payment.cardExpiryVal=function(e){var t,a,n,i;return e=e.replace(/\s/g,""),i=e.split("/",2),t=i[0],n=i[1],2===(null!=n?n.length:void 0)&&/^\d+$/.test(n)&&(a=(new Date).getFullYear(),a=a.toString().slice(0,2),n=a+n),t=parseInt(t,10),n=parseInt(n,10),{month:t,year:n}},$.payment.validateCardNumber=function(t){var a,n;return t=(t+"").replace(/\s+|-/g,""),/^\d+$/.test(t)?(a=e(t),a?(n=t.length,b.call(a.length,n)>=0&&(a.luhn===!1||p(t))):!1):!1},$.payment.validateCardExpiry=function(e,t){var a,n,i,s;return"object"==typeof e&&"month"in e&&(s=e,e=s.month,t=s.year),e&&t?(e=$.trim(e),t=$.trim(t),/^\d+$/.test(e)&&/^\d+$/.test(t)&&parseInt(e,10)<=12?(2===t.length&&(i=(new Date).getFullYear(),i=i.toString().slice(0,2),t=i+t),n=new Date(t,e),a=new Date,n.setMonth(n.getMonth()-1),n.setMonth(n.getMonth()+1,1),n>a):!1):!1},$.payment.validateCardCVC=function(e,a){var n,i;return e=$.trim(e),/^\d+$/.test(e)?a?(n=e.length,b.call(null!=(i=t(a))?i.cvcLength:void 0,n)>=0):e.length>=3&&e.length<=4:!1},$.payment.cardType=function(t){var a;return t?(null!=(a=e(t))?a.type:void 0)||null:null},$.payment.formatCardNumber=function(t){var a,n,i,s;return(a=e(t))?(i=a.length[a.length.length-1],t=t.replace(/\D/g,""),t=t.slice(0,+i+1||9e9),a.format.global?null!=(s=t.match(a.format))?s.join(" "):void 0:(n=a.format.exec(t),null!=n&&n.shift(),null!=n?n.join(" "):void 0)):t}}.call(this),function(e,t,a){function n(e){for(var t={x:e.offsetLeft,y:e.offsetTop};e=e.offsetParent;)t.x+=e.offsetLeft,t.y+=e.offsetTop;return t}function i(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)e[i]===a&&(e[i]=n[i])}return e}function s(e,t){for(var a in t)e.style[r(e,a)||a]=t[a];return e}function r(e,t){var n=e.style,i,s;if(n[t]!==a)return t;for(t=t.charAt(0).toUpperCase()+t.slice(1),s=0;s<c.length;s++)if(i=c[s]+t,n[i]!==a)return i}function l(e,t,a,n){var i=["opacity",t,~~(100*e),a,n].join("-"),s=.01+a/n*100,r=Math.max(1-(1-e)/t*(100-s),e),l=m.substring(0,m.indexOf("Animation")).toLowerCase(),o=l&&"-"+l+"-"||"";return p[i]||(u.insertRule("@"+o+"keyframes "+i+"{0%{opacity:"+r+"}"+s+"%{opacity:"+e+"}"+(s+.01)+"%{opacity:1}"+(s+t)%100+"%{opacity:"+e+"}100%{opacity:"+r+"}}",0),p[i]=1),i}function o(e,t,a){return a&&!a.parentNode&&o(e,a),e.insertBefore(t,a||null),e}function d(e,a){var n=t.createElement(e||"div"),i;for(i in a)n[i]=a[i];return n}var c=["webkit","Moz","ms","O"],p={},m,u=function(){var e=d("style");return o(t.getElementsByTagName("head")[0],e),e.sheet||e.styleSheet}(),_=function v(e){return this.spin?void(this.opts=i(e||{},v.defaults,f)):new v(e)},f=_.defaults={lines:12,length:7,width:5,radius:10,color:"#000",speed:1,trail:100,opacity:.25,fps:20},h=_.prototype={spin:function(e){this.stop();var t=this,a=t.el=s(d(),{position:"relative"}),i,r;if(e&&(r=n(o(e,a,e.firstChild)),i=n(a),s(a,{left:(e.offsetWidth>>1)-i.x+r.x+"px",top:(e.offsetHeight>>1)-i.y+r.y+"px"})),a.setAttribute("aria-role","progressbar"),t.lines(a,t.opts),!m){var l=t.opts,c=0,p=l.fps,u=p/l.speed,_=(1-l.opacity)/(u*l.trail/100),f=u/l.lines;!function h(){c++;for(var e=l.lines;e;e--){var n=Math.max(1-(c+e*f)%u*_,l.opacity);t.opacity(a,l.lines-e,n,l)}t.timeout=t.el&&setTimeout(h,~~(1e3/p))}()}return t},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=a),this}};h.lines=function(e,t){function a(e,a){return s(d(),{position:"absolute",width:t.length+t.width+"px",height:t.width+"px",background:e,boxShadow:a,transformOrigin:"left",transform:"rotate("+~~(360/t.lines*n)+"deg) translate("+t.radius+"px,0)",borderRadius:(t.width>>1)+"px"})}for(var n=0,i;n<t.lines;n++)i=s(d(),{position:"absolute",top:1+~(t.width/2)+"px",transform:"translate3d(0,0,0)",opacity:t.opacity,animation:m&&l(t.opacity,t.trail,n,t.lines)+" "+1/t.speed+"s linear infinite"}),t.shadow&&o(i,s(a("#000","0 0 4px #000"),{top:"2px"})),o(e,o(i,a(t.color,"0 0 1px rgba(0,0,0,.1)")));return e},h.opacity=function(e,t,a){t<e.childNodes.length&&(e.childNodes[t].style.opacity=a)},function(){var e=s(d("group"),{behavior:"url(#default#VML)"}),t;if(!r(e,"transform")&&e.adj){for(t=4;t--;)u.addRule(["group","roundrect","fill","stroke"][t],"behavior:url(#default#VML)");h.lines=function(e,t){function a(e,a,r){o(l,o(s(n(),{rotation:360/t.lines*e+"deg",left:~~a}),o(s(d("roundrect",{arcsize:1}),{width:i,height:t.width,left:t.radius,top:-t.width>>1,filter:r}),d("fill",{color:t.color,opacity:t.opacity}),d("stroke",{opacity:0}))))}function n(){return s(d("group",{coordsize:r+" "+r,coordorigin:-i+" "+-i}),{width:r,height:r})}var i=t.length+t.width,r=2*i,l=n(),c=~(t.length+t.radius+t.width)+"px",p;if(t.shadow)for(p=1;p<=t.lines;p++)a(p,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(p=1;p<=t.lines;p++)a(p);return o(s(e,{margin:c+" 0 0 "+c,zoom:1}),l)},h.opacity=function(e,t,a,n){var i=e.firstChild;n=n.shadow&&n.lines||0,i&&t+n<i.childNodes.length&&(i=i.childNodes[t+n],i=i&&i.firstChild,i=i&&i.firstChild,i&&(i.opacity=a))}}else m=r(e,"animation")}(),e.Spinner=_}(window,document),$.fn.spin=function(e){return this.each(function(){var t=$(this),a=t.data();a.spinner&&(a.spinner.stop(),delete a.spinner),e!==!1&&(a.spinner=new Spinner($.extend({color:t.css("color")},e)).spin(this))}),this};var deviceIsAndroid=navigator.userAgent.indexOf("Android")>0,deviceIsIOS=/iP(ad|hone|od)/.test(navigator.userAgent),deviceIsIOS4=deviceIsIOS&&/OS 4_\d(_\d)?/.test(navigator.userAgent),deviceIsIOSWithBadTarget=deviceIsIOS&&/OS ([6-9]|\d{2})_\d/.test(navigator.userAgent);FastClick.prototype.needsClick=function(e){"use strict";switch(e.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(e.disabled)return!0;break;case"input":if(deviceIsIOS&&"file"===e.type||e.disabled)return!0;break;case"label":case"video":return!0}return/\bneedsclick\b/.test(e.className)},FastClick.prototype.needsFocus=function(e){"use strict";switch(e.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!deviceIsAndroid;case"input":switch(e.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!e.disabled&&!e.readOnly;default:return/\bneedsfocus\b/.test(e.className)}},FastClick.prototype.sendClick=function(e,t){"use strict";var a,n;document.activeElement&&document.activeElement!==e&&document.activeElement.blur(),n=t.changedTouches[0],a=document.createEvent("MouseEvents"),a.initMouseEvent(this.determineEventType(e),!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),a.forwardedTouchEvent=!0,e.dispatchEvent(a)},FastClick.prototype.determineEventType=function(e){"use strict";return deviceIsAndroid&&"select"===e.tagName.toLowerCase()?"mousedown":"click"},FastClick.prototype.focus=function(e){"use strict";var t;deviceIsIOS&&e.setSelectionRange&&0!==e.type.indexOf("date")&&"time"!==e.type?(t=e.value.length,e.setSelectionRange(t,t)):e.focus()},FastClick.prototype.updateScrollParent=function(e){"use strict";var t,a;if(t=e.fastClickScrollParent,!t||!t.contains(e)){a=e;do{if(a.scrollHeight>a.offsetHeight){t=a,e.fastClickScrollParent=a;break}a=a.parentElement}while(a)}t&&(t.fastClickLastScrollTop=t.scrollTop)},FastClick.prototype.getTargetElementFromEventTarget=function(e){"use strict";return e.nodeType===Node.TEXT_NODE?e.parentNode:e},FastClick.prototype.onTouchStart=function(e){"use strict";var t,a,n;if(e.targetTouches.length>1)return!0;if(t=this.getTargetElementFromEventTarget(e.target),a=e.targetTouches[0],deviceIsIOS){if(n=window.getSelection(),n.rangeCount&&!n.isCollapsed)return!0;if(!deviceIsIOS4){if(a.identifier===this.lastTouchIdentifier)return e.preventDefault(),!1;this.lastTouchIdentifier=a.identifier,this.updateScrollParent(t)}}return this.trackingClick=!0,this.trackingClickStart=e.timeStamp,this.targetElement=t,this.touchStartX=a.pageX,this.touchStartY=a.pageY,e.timeStamp-this.lastClickTime<200&&e.preventDefault(),!0},FastClick.prototype.touchHasMoved=function(e){"use strict";var t=e.changedTouches[0],a=this.touchBoundary;return Math.abs(t.pageX-this.touchStartX)>a||Math.abs(t.pageY-this.touchStartY)>a?!0:!1},FastClick.prototype.onTouchMove=function(e){"use strict";return this.trackingClick?((this.targetElement!==this.getTargetElementFromEventTarget(e.target)||this.touchHasMoved(e))&&(this.trackingClick=!1,this.targetElement=null),!0):!0},FastClick.prototype.findControl=function(e){"use strict";return void 0!==e.control?e.control:e.htmlFor?document.getElementById(e.htmlFor):e.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},FastClick.prototype.onTouchEnd=function(e){"use strict";var t,a,n,i,s,r=this.targetElement;if(!this.trackingClick)return!0;if(e.timeStamp-this.lastClickTime<200)return this.cancelNextClick=!0,!0;if(this.cancelNextClick=!1,this.lastClickTime=e.timeStamp,a=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,deviceIsIOSWithBadTarget&&(s=e.changedTouches[0],r=document.elementFromPoint(s.pageX-window.pageXOffset,s.pageY-window.pageYOffset)||r,r.fastClickScrollParent=this.targetElement.fastClickScrollParent),n=r.tagName.toLowerCase(),"label"===n){if(t=this.findControl(r)){if(this.focus(r),deviceIsAndroid)return!1;r=t}}else if(this.needsFocus(r))return e.timeStamp-a>100||deviceIsIOS&&window.top!==window&&"input"===n?(this.targetElement=null,!1):(this.focus(r),this.sendClick(r,e),deviceIsIOS4&&"select"===n||(this.targetElement=null,e.preventDefault()),!1);return deviceIsIOS&&!deviceIsIOS4&&(i=r.fastClickScrollParent,i&&i.fastClickLastScrollTop!==i.scrollTop)?!0:(this.needsClick(r)||(e.preventDefault(),this.sendClick(r,e)),!1)},FastClick.prototype.onTouchCancel=function(){"use strict";this.trackingClick=!1,this.targetElement=null},FastClick.prototype.onMouse=function(e){"use strict";return this.targetElement?e.forwardedTouchEvent?!0:e.cancelable&&(!this.needsClick(this.targetElement)||this.cancelNextClick)?(e.stopImmediatePropagation?e.stopImmediatePropagation():e.propagationStopped=!0,e.stopPropagation(),e.preventDefault(),!1):!0:!0},FastClick.prototype.onClick=function(e){"use strict";var t;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):"submit"===e.target.type&&0===e.detail?!0:(t=this.onMouse(e),t||(this.targetElement=null),t)},FastClick.prototype.destroy=function(){"use strict";var e=this.layer;deviceIsAndroid&&(e.removeEventListener("mouseover",this.onMouse,!0),e.removeEventListener("mousedown",this.onMouse,!0),e.removeEventListener("mouseup",this.onMouse,!0)),e.removeEventListener("click",this.onClick,!0),e.removeEventListener("touchstart",this.onTouchStart,!1),e.removeEventListener("touchmove",this.onTouchMove,!1),e.removeEventListener("touchend",this.onTouchEnd,!1),e.removeEventListener("touchcancel",this.onTouchCancel,!1)},FastClick.notNeeded=function(e){"use strict";var t,a;if("undefined"==typeof window.ontouchstart)return!0;if(a=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]){if(!deviceIsAndroid)return!0;if(t=document.querySelector("meta[name=viewport]")){if(-1!==t.content.indexOf("user-scalable=no"))return!0;if(a>31&&window.innerWidth<=window.screen.width)return!0}}return"none"===e.style.msTouchAction?!0:!1},FastClick.attach=function(e){"use strict";return new FastClick(e)},"undefined"!=typeof define&&define.amd?define(function(){"use strict";return FastClick}):"undefined"!=typeof module&&module.exports?(module.exports=FastClick.attach,module.exports.FastClick=FastClick):window.FastClick=FastClick,function(e,t,a){function n(t){if(e.event&&e.event.contentOverflow!==a)return{x:e.event.offsetX,y:e.event.offsetY};if(t.offsetX!==a&&t.offsetY!==a)return{x:t.offsetX,y:t.offsetY};var n=t.target.parentNode.parentNode;return{x:t.layerX-n.offsetLeft,y:t.layerY-n.offsetTop}}function $(e,a,n){e=t.createElementNS(h,e);for(var i in a)e.setAttribute(i,a[i]);"[object Array]"!=Object.prototype.toString.call(n)&&(n=[n]);for(var s=0,r=n[0]&&n.length||0;r>s;s++)e.appendChild(n[s]);return e}function i(e){var t,a,n,i,s,r=e.h%360/60;s=e.v*e.s,i=s*(1-Math.abs(r%2-1)),t=a=n=e.v-s,r=~~r,t+=[s,i,0,0,i,s][r],a+=[i,s,s,i,0,0][r],n+=[0,0,i,s,s,i][r];var l=Math.floor(255*t),o=Math.floor(255*a),d=Math.floor(255*n);return{r:l,g:o,b:d,hex:"#"+(16777216|d|o<<8|l<<16).toString(16).slice(1)}}function s(e){var t=e.r,a=e.g,n=e.b;(e.r>1||e.g>1||e.b>1)&&(t/=255,a/=255,n/=255);var i,s,r,l;return r=Math.max(t,a,n),l=r-Math.min(t,a,n),i=0==l?null:r==t?(a-n)/l+(n>a?6:0):r==a?(n-t)/l+2:(t-a)/l+4,i=i%6*60,s=0==l?0:l/r,{h:i,s:s,v:r}}function r(t,s,r){return function(l){l=l||e.event;var o=n(l);t.h=o.y/s.offsetHeight*360+f;var d=i({h:t.h,s:1,v:1}),c=i({h:t.h,s:t.s,v:t.v});r.style.backgroundColor=d.hex,t.pickerInput[0].value=d.hex.replace("#",""),t.callback&&t.callback(c.hex,{h:t.h-f,s:t.s,v:t.v},{r:c.r,g:c.g,b:c.b},a,o)}}function l(t,a){return function(s){s=s||e.event;var r=n(s),l=a.offsetWidth,o=a.offsetHeight;t.s=r.x/l,t.v=(o-r.y)/o;var d=i(t);t.callback&&t.callback(d.hex,{h:t.h-f,s:t.s,v:t.v},{r:d.r,g:d.g,b:d.b},r),t.pickerInput[0].value=d.hex.replace("#","")}}function o(e,t,n){if(!(this instanceof o))return new o(e,t,n);var i=this;this.h=0,this.s=1,this.v=1;var s=e.getElementsByClassName("input");if(n)this.callback=n,this.pickerElement=t,this.slideElement=e,this.pickerInput=s;else{var f=e;f.innerHTML=v,this.slideElement=f.getElementsByClassName("slide")[0],this.pickerElement=f.getElementsByClassName("picker")[0],this.pickerInput=s;var h=f.getElementsByClassName("slide-indicator")[0],y=f.getElementsByClassName("picker-indicator")[0];o.fixIndicators(h,y),this.callback=function(e,a,n,i,s){o.positionIndicators(h,y,s,i),t(e,a,n)}}if("SVG"==m){var b=_.cloneNode(!0),E=u.cloneNode(!0),w=b.getElementById("gradient-hsv"),L=b.getElementsByTagName("rect")[0];w.id="gradient-hsv-"+g,L.setAttribute("fill","url(#"+w.id+")");var M=[E.getElementById("gradient-black"),E.getElementById("gradient-white")],k=E.getElementsByTagName("rect");M[0].id="gradient-black-"+g,M[1].id="gradient-white-"+g,k[0].setAttribute("fill","url(#"+M[1].id+")"),k[1].setAttribute("fill","url(#"+M[0].id+")"),this.slideElement.appendChild(b),this.pickerElement.appendChild(E),g++}else this.slideElement.innerHTML=_,this.pickerElement.innerHTML=u;s[0].onkeypress=function(e){var t;return e.metaKey||e.ctrlKey?!0:32===e.which?!1:0===e.which?!0:e.which<33?!0:(t=String.fromCharCode(e.which),!!/[A-Za-z0-9]/.test(t))},s[0].onkeyup=function(e){var t=this.value;6==t.length&&p(i,o.hex2hsv("#"+t),a,"#"+t)},d(this.slideElement,"click",r(this,this.slideElement,this.pickerElement)),d(this.pickerElement,"click",l(this,this.pickerElement)),c(this,this.slideElement,r(this,this.slideElement,this.pickerElement)),c(this,this.pickerElement,l(this,this.pickerElement))}function d(e,t,a){e.attachEvent?e.attachEvent("on"+t,a):e.addEventListener&&e.addEventListener(t,a,!1)}function c(e,t,a){var n=!1;d(t,"mousedown",function(e){n=!0}),d(t,"mouseup",function(e){n=!1}),d(t,"mouseout",function(e){n=!1}),d(t,"mousemove",function(e){n&&a(e)})}function p(e,t,a,n){e.h=t.h%360,e.s=t.s,e.v=t.v;var s=i(e),r={y:e.h*e.slideElement.offsetHeight/360,x:0},l=e.pickerElement.offsetHeight,o={x:e.s*e.pickerElement.offsetWidth,y:l-e.v*l};return e.pickerElement.style.backgroundColor=i({h:e.h,s:1,v:1}).hex,e.callback&&e.callback(n||s.hex,{h:e.h,s:e.s,v:e.v},a||{r:s.r,g:s.g,b:s.b},o,r),e.pickerInput[0].value=n.replace("#","")||s.hex.replace("#",""),e}var m=e.SVGAngle||t.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML",u,_,f=15,h="http://www.w3.org/2000/svg",v=['<div class="picker-wrapper">','<div class="picker"></div>','<div class="picker-indicator"></div>',"</div>",'<div class="slide-wrapper">','<div class="slide"></div>','<div class="slide-indicator"></div>',"</div>",'<div class="input-wrapper">','<input type="text" class="input" maxlength="6">','<div class="hex-helper">#</div>',"</div>"].join("");"SVG"==m?(_=$("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%"},[$("defs",{},$("linearGradient",{id:"gradient-hsv",x1:"0%",y1:"100%",x2:"0%",y2:"0%"},[$("stop",{offset:"0%","stop-color":"#FF0000","stop-opacity":"1"}),$("stop",{offset:"13%","stop-color":"#FF00FF","stop-opacity":"1"}),$("stop",{offset:"25%","stop-color":"#8000FF","stop-opacity":"1"}),$("stop",{offset:"38%","stop-color":"#0040FF","stop-opacity":"1"}),$("stop",{offset:"50%","stop-color":"#00FFFF","stop-opacity":"1"}),$("stop",{offset:"63%","stop-color":"#00FF40","stop-opacity":"1"}),$("stop",{offset:"75%","stop-color":"#0BED00","stop-opacity":"1"}),$("stop",{offset:"88%","stop-color":"#FFFF00","stop-opacity":"1"}),$("stop",{offset:"100%","stop-color":"#FF0000","stop-opacity":"1"})])),$("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-hsv)"})]),u=$("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%"},[$("defs",{},[$("linearGradient",{id:"gradient-black",x1:"0%",y1:"100%",x2:"0%",y2:"0%"},[$("stop",{offset:"0%","stop-color":"#000000","stop-opacity":"1"}),$("stop",{offset:"100%","stop-color":"#CC9A81","stop-opacity":"0"})]),$("linearGradient",{id:"gradient-white",x1:"0%",y1:"100%",x2:"100%",y2:"100%"},[$("stop",{offset:"0%","stop-color":"#FFFFFF","stop-opacity":"1"}),$("stop",{offset:"100%","stop-color":"#CC9A81","stop-opacity":"0"})])]),$("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-white)"}),$("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-black)"})])):"VML"==m&&(_=['<DIV style="position: relative; width: 100%; height: 100%">','<v:rect style="position: absolute; top: 0; left: 0; width: 100%; height: 100%" stroked="f" filled="t">','<v:fill type="gradient" method="none" angle="0" color="red" color2="red" colors="8519f fuchsia;.25 #8000ff;24903f #0040ff;.5 aqua;41287f #00ff40;.75 #0bed00;57671f yellow"></v:fill>',"</v:rect>","</DIV>"].join(""),u=['<DIV style="position: relative; width: 100%; height: 100%">','<v:rect style="position: absolute; left: -1px; top: -1px; width: 101%; height: 101%" stroked="f" filled="t">','<v:fill type="gradient" method="none" angle="270" color="#FFFFFF" opacity="100%" color2="#CC9A81" o:opacity2="0%"></v:fill>',"</v:rect>",'<v:rect style="position: absolute; left: 0px; top: 0px; width: 100%; height: 101%" stroked="f" filled="t">','<v:fill type="gradient" method="none" angle="0" color="#000000" opacity="100%" color2="#CC9A81" o:opacity2="0%"></v:fill>',"</v:rect>","</DIV>"].join(""),t.namespaces.v||t.namespaces.add("v","urn:schemas-microsoft-com:vml","#default#VML"));var g=0;o.hsv2rgb=function(e){var t=i(e);return delete t.hex,t},o.hsv2hex=function(e){return i(e).hex},o.rgb2hsv=s,o.rgb2hex=function(e){return i(s(e)).hex},o.hex2hsv=function(e){return s(o.hex2rgb(e))},o.hex2rgb=function(e){return{r:parseInt(e.substr(1,2),16),g:parseInt(e.substr(3,2),16),b:parseInt(e.substr(5,2),16)}},o.prototype.setHsv=function(e){return p(this,e)},o.prototype.setRgb=function(e){return p(this,s(e),e)},o.prototype.setHex=function(e){return p(this,o.hex2hsv(e),a,e)},o.positionIndicators=function(e,t,a,n){a&&(e.style.top=a.y-e.offsetHeight/2+"px"),n&&(t.style.top=n.y-t.offsetHeight/2+"px",t.style.left=n.x-t.offsetWidth/2+"px")},o.fixIndicators=function(e,t){t.style.pointerEvents="none",e.style.pointerEvents="none"},e.ColorPicker=o}(window,window.document),$.ajaxSetup({dataType:"json",contentType:"application/json"}),$("form").submit(function(e){e.preventDefault(),$(this).find("a.btn.submit").click()});var ELM={body:$("body"),wrapper:$("#wrapper"),container:$("#container"),content:$("#content"),sidebar:$("#sidebar"),sidebar_switcher:$("#sidebar_switcher"),subnav:$("#sidebar .sub-list"),app_nav:$("#app_nav"),spaces_nav:$("#spaces_nav"),add_space_btn:$("#add_space_btn"),hamburger:$("#hamburger"),mobile_header:$("#mobile_header"),mobile_helper:$("#mobile_helper"),modals:$("#modals"),modal_bg:$("#modal_bg"),notify:$("#notify"),log_back_in:$("#log_back_in"),dialog:$("#modal_dialog"),modal_shipped:$("#modal_shipped"),upload_progress:$("#upload_progress"),payments_item_menu:$("#payments_item_menu"),colorpicker:$("#colorpicker"),recent_list:$("#recent_list"),products_list:$("#products_list"),content_list:$("#content_list"),data_list:$("#data_list"),files_list:$("#files_list"),members_list:$("#members_list"),members_plans_list:$("#members_plans_list"),members_payments_list:$("#members_payments_list"),payments_list:$("#payments_list"),payment_products_list:$("#payment_products_list"),invoices_list:$("#invoices_list"),invoice_charges_list:$("#invoice_charges_list"),coupons_list:$("#coupons_list"),plans_list:$("#plans_list"),shipping_list:$("#shipping_list"),funds_list:$("#funds_list"),notifications_list:$("#notifications_list"),panel_dash_recent:$("#panel_dash_recent"),panel_dash_sales:$("#panel_dash_sales"),panel_dash_members:$("#panel_dash_members"),panel_setup:$("#panel_setup"),panel_acct_details:$("#panel_acct_details"),panel_terminal:$("#panel_terminal"),panel_products:$("#panel_products"),panel_products_item:$("#panel_products_item"),panel_data:$("#panel_data"),panel_plans:$("#panel_plans"),panel_plans_item:$("#panel_plans_item"),panel_content:$("#panel_content"),panel_content_item:$("#panel_content_item"),panel_members:$("#panel_members"),panel_members_item:$("#panel_members_item"),panel_payments:$("#panel_payments"),panel_payments_item:$("#panel_payments_item"),panel_notifications:$("#panel_notifications"),panel_invoices:$("#panel_invoices"),panel_invoices_item:$("#panel_invoices_item"),panel_coupons:$("#panel_coupons"),panel_coupons_item:$("#panel_coupons_item"),panel_funds:$("#panel_funds"),panel_funds_item:$("#panel_funds_item"),panel_market:$("#panel_market"),nav_setup:$("#spaces_nav .sub-list a.setup"),nav_products:$("#spaces_nav .sub-list a.products"),nav_data:$("#spaces_nav .sub-list a.data"),nav_plans:$("#spaces_nav .sub-list a.plans"),nav_content:$("#spaces_nav .sub-list a.content"),nav_members:$("#spaces_nav .sub-list a.members"),nav_payments:$("#spaces_nav .sub-list a.payments"),nav_invoices:$("#app_nav a.invoices"),nav_market:$("#app_nav a.market"),nav_coupons:$("#app_nav a.coupons"),nav_account:$("#app_nav a.account"),nav_funds:$("#app_nav a.funds"),nav_terminal:$("#app_nav a.terminal"),nav_dashboard:$("#app_nav a.dashboard"),nav_notifications:$("#app_nav a.notifications")},stripe_dashboard_url="https://dashboard.stripe.com/";$("input[type=number]").on("mousewheel",function(e){e.preventDefault()}),$("input[type=number]:not(.price)").payment("restrictNumeric"),$("input[name=cc_number]").payment("formatCardNumber"),$("input[name=exp]").payment("formatCardExpiry"),$("input[name=cvc]").payment("formatCardCVC"),$("input.price").payment("restrictPrice"),ELM.hamburger.add(ELM.mobile_helper).click(function(e){ELM.body.toggleClass("open"),e.preventDefault()}),$("#pay_people").click(function(e){show_modal("pay-people"),e.preventDefault()});var colorpicker=ColorPicker(ELM.colorpicker[0],function(e,t,a){$(".open-colorpicker").trigger("colorpicker",[e])});ELM.content.on("click",".open-colorpicker",function(e){var t=$(this).offset().top+$(this).outerHeight()-20,a=$(this).offset().left-150;10>a&&(a=10),colorpicker.setHex("#"+$(this).attr("data-value")),ELM.colorpicker.css({top:t,left:a}).show(),$(".open-colorpicker").removeClass("open"),$(this).addClass("open")}).on("colorpicker",".open-colorpicker.open",function(e,t){t=t.replace("#",""),6==t.length&&($(this).css({"background-color":"#"+t}).attr("data-value",t),$(this).parent().attr("data-value",t))}),ELM.sidebar.on("click",".sub-list a",function(e){$(this).parent().children("a").removeClass("selected"),$(this).addClass("selected"),e.preventDefault()});var submenu_timer=!1;ELM.content.on("click",".submenu a",function(e){$(this).parent().children("a").removeClass("selected"),$(this).addClass("selected");var t=$(this).parents(".panel:first"),a=t.find(".panel-swap."+$(this).attr("data-pane"));t.find(".panel-swap").removeClass("appear show"),a.addClass("appear"),submenu_timer&&clearTimeout(submenu_timer),submenu_timer=window.setTimeout(function(){a.addClass("show").removeClass("appear")},400),e.preventDefault()}),ELM.content.on("click","menu.tab-switch a",function(e){$(this).parent().children("a").removeClass("selected"),$(this).addClass("selected");var t=$(this).attr("data-type"),a=$(this).parent().parent(),n=a[0].className.split(" ").filter(function(e){return 0!==e.lastIndexOf("type")});a.attr("data-type",t).attr("class",n.join(" ")+" type-"+t),e.preventDefault()}),ELM.sidebar_switcher.on("click","a",function(e){if(!$(this).hasClass("selected")){var t=$(this).attr("data-sidebar"),a=t,n=$("#sidebar_bar_"+t);ELM.sidebar.hasClass("fixed")&&(a+=" fixed"),ELM.sidebar.attr("class",a),animation_setup({elem:n,delay:0,do_filter:!1,start:function(){n.addClass("start")},end:function(){n.removeClass("start")}}),ELM.sidebar_switcher.find("a").removeClass("selected"),$(this).addClass("selected")}e.preventDefault()}),ELM.app_nav.on("click","a",function(e){$(this).parent().children("a").add(ELM.spaces_nav.children("li")).removeClass("selected"),$(this).addClass("selected");var t=$(this).attr("data-panel"),a=ELM.content.attr("class").replace(" new",""),n=ELM.content.find("section.panel[data-panel="+a+"]");ELM.content.find("section.panel").removeClass("old active-sub active-alt"),n.addClass("old"),window.setTimeout(function(){n.removeClass("old"),t!=a&&n.find(".panel-swap").removeClass("appear show")},600),ELM.content.attr("class",t),ELM.content.attr("data-oldpanel",a),ELM.container.attr("class",t),ELM.subnav.find("a.selected").removeClass("selected"),ELM.subnav.find("a."+$(this).attr("data-subnav")).addClass("selected"),ELM.panel_setup.removeAttr("data-cursym"),ELM.mobile_header.find("h2").html($(this).find("strong").html()),ELM.body.removeClass("open"),e.preventDefault()}),ELM.spaces_nav.on("click",".sub-list a",function(e){var t=$(this).attr("data-panel"),a=ELM.content.attr("class").replace(" new",""),n=ELM.content.find("section.panel[data-panel="+a+"]");n.addClass("active-alt"),t!=a&&n.find(".panel-swap").removeClass("appear show"),ELM.content.attr("class",t),ELM.body.removeClass("open")}),ELM.add_space_btn.click(function(e){show_modal(""==stripe_user_key?"accept-payments":"choose-space"),e.preventDefault()}),$("#choose_type_onetime, #choose_type_membership").click(function(e){"choose_type_membership"==this.id?($("#setup_space_title").html(_lc_words["new"]+" <em>"+_lc_words.membership+"</em> "+_lc_words.space),ELM.container.attr("class","membership"),ELM.panel_setup.attr("data-type","membership"),ELM.panel_setup.find("form select[name=space_mode] option.pre-order").remove()):($("#setup_space_title").html(_lc_words["new"]+" <em>"+_lc_words.one_time+"</em> "+_lc_words.space),ELM.container.attr("class","onetime"),ELM.panel_setup.attr("data-type","onetime"),ELM.panel_setup.find("form select[name=space_mode] option.pre-order").length<=0&&ELM.panel_setup.find("form select[name=space_mode] option:last").before('<option class="pre-order" value="pre-order">'+_lc_words.pre_order+"</option>")),ELM.mobile_header.find("h2").html(_lc_words.new_space),ELM.content.attr("class","setup new"),ELM.body.removeClass("open"),$(window).scrollTop(0),close_modal();var t=ELM.panel_setup.find("form"),a=ELM.panel_setup.find("> header");if(ELM.app_nav.children("a").add(ELM.spaces_nav.children("li")).removeClass("selected"),ELM.panel_setup.removeAttr("data-id").attr("data-cursym",currency_symbol),t[0].reset(),t.find("input[name=seller_name]").val(user.name),t.find("input[name=seller_email]").val(user.email),ELM.panel_setup.find("form select option:first").attr("selected","selected"),a.attr("data-bg_image",s3_url+"theme/default_space_bg.jpg").find("img").attr("src",s3_url+"theme/default_space_200.jpg"),a.attr("style","background-image:url('"+s3_url+"theme/default_space_bg.jpg');").removeClass("color dark light").addClass("image"),$("#upload_logo").removeClass("image").children(".inner:first").removeAttr("style"),$("#upload_background").removeClass("image").children(".inner:first").removeAttr("style"),$("#upload_background .tab-switch a.image").trigger("click"),ELM.shipping_list.html('<li class="none">'+_lc_words.none+"</li>"),$("#invoice_address_fields").add(ELM.panel_setup.find("form div.label.shipping")).removeClass("show").addClass("hide"),"choose_type_membership"==this.id){var n=user.email.split("@");ELM.panel_setup.find("form input[name=seller_website]").val("http://"+n[1]),t.find("select[name=space_mode] option.pre-order").remove(),t.find("input[name=require_shipping]").parents("label").removeClass("right left half")}else t.find("select[name=space_mode] option.pre-order").length<=0&&t.find("select[name=space_mode] option:last").before('<option class="pre-order" value="pre-order">'+_lc_words.pre_order+"</option>"),t.find("input[name=require_shipping]").parents("label").removeClass("left").addClass("half right");e.preventDefault()});var search_timeout=!1;$(".search-field").keyup(function(e){var t=$(this),a=t.parent(),n=t.val().trim(),i=a.children(".search-close"),s=a.attr("data-for");search_timeout&&clearTimeout(search_timeout),i.addClass("show"),n.length>1&&n!=t.data("prev-value")&&(search_timeout=window.setTimeout(function(){t.data("prev-value",n),a.addClass("isloading"),i.html("&nbsp;").spin({lines:10,length:3,width:2,radius:4,color:"#555",speed:1,trail:40,shadow:!1});
var e="members"==s||"payments"==s?s+"/"+ELM.spaces_nav.find("li.selected").attr("data-id"):s;$.ajax({type:"POST",url:base_url+"api/search/"+e,data:JSON.stringify({query:n}),success:function(e){a.removeClass("isloading").addClass("searched"),a.is("[data-type]")&&(e._type=a.attr("data-type"),e._par_panel=a.parents(".panel-pane:first")),ELM.body.trigger(s+"_fillout",e),i.html("&times;").removeAttr("style")},error:function(e){i.html("&times;").removeAttr("style"),a.removeClass("isloading"),ajax_error(e)}})},800))}).blur(function(e){var t=$(this);""==t.val().trim()&&t.parent().children(".search-close").removeClass("show")}),$(".search-close").click(function(e){var t=$(this),a=t.parent(),n=a.children("input:first");if(!a.hasClass("isloading")){if(a.hasClass("searched")){var i={_is_close:!0};a.is("[data-type]")&&(i._type=a.attr("data-type"),i._par_panel=a.parents(".panel-pane:first")),ELM.body.trigger(a.attr("data-for")+"_fillout",i),a.removeClass("searched")}n.val(""),t.removeClass("show")}e.preventDefault()}),$("#modal_accept_payments").on("click","a.ok",function(e){close_modal(),ELM.sidebar_switcher.find("a.home").click(),ELM.app_nav.find("a.accept-payments").click(),e.preventDefault()}),$("#content section.panel header").on("click","a.back",function(e){ELM.content.attr("class",$(this).attr("data-back")),e.preventDefault()}),$("a.btn.export-data").click(function(e){if($(this).parents("div.panel-pane").find("ul.item-list li:not(.none)").length<=0)confirmation("There is nothing to export yet.",function(e){},!1);else{var t=ELM.spaces_nav.find("li.selected").length>0?!0:!1,a=t?"in this Space":"from the Virtual Terminal",n=$(this).parents("#panel_members").length>0?"All of the Members in this Space will be exported into a CSV formatted file for downloading.":"All of the Payments "+a+" will be exported into a CSV formatted file for downloading.",i=t?ELM.spaces_nav.find("li.selected").attr("data-id"):0;confirmation(n,function(e){e&&(ELM.dialog.find("a.btn.cancel").click(),window.location=base_url+"api/spaces/"+i+"/export")},!0)}e.preventDefault()}),$("#reconnect_top_btn").click(function(){var e=$(this);return e.hasClass("stale")||(add_button_spinner({elem:e,color:"#fff"}),$.ajax({type:"PUT",url:base_url+"api/user/?action=oauth",success:function(e){window.location=e.url},error:function(t){remove_button_spinner(e),ajax_error(t)}})),!1}),ELM.log_back_in.find("a.btn.submit").click(function(){var e=$(this);if(!e.hasClass("stale")){add_button_spinner({elem:e,color:"#fff"});var t=ELM.log_back_in.find("input[name=password]");$.ajax({type:"POST",url:base_url+"api/login",data:JSON.stringify({password:t.val(),email:user.email}),success:function(){t.val(""),remove_button_spinner(e),show_notify({text:_lc_words.logged_in}),$(".loading").removeClass("loading");var a=$(document).data("last-ajax");void 0!==a&&$.ajax(a),ELM.log_back_in.find("a.close").click()},error:function(t){remove_button_spinner(e),t.LOGIN_REQ=!0,ajax_error(t)}})}return!1}),ELM.content.find("form div.label.file").on("click","a.change",function(){return $(this).parents("div.file").removeClass("delete empty").addClass("change"),!1}),ELM.content.find("form div.label.file").on("click","a.cancel",function(){return $(this).parents("div.file").removeClass("change delete"),!1}),ELM.content.find("form div.label.file").on("click","a.delete",function(){return $(this).parents("div.file").removeClass("change empty").addClass("delete"),!1}),ELM.modals.on("click","a.cancel, a.close",function(e){close_modal(),e.preventDefault()}),ELM.modals.on("click","a.modal-link",function(e){ELM.modals.add(ELM.modal_bg).attr("class",$(this).attr("data-modal")),e.preventDefault()}),ELM.notify.click(function(e){$(this).removeClass("show"),e.preventDefault()});var notify_timeout=!1;$(window).resize(function(){$(this).width()>960&&ELM.body.removeClass("open")}),$(document).ajaxComplete(function(e,t,a){$(document).data("last-ajax",a)}),ELM.body.on("blur","input, textarea",function(){$(this).removeClass("error"),$(this).parent().find(".error-description").remove()}).mousedown(function(e){$(".remove-body-click").removeClass("show"),e.target==ELM.colorpicker[0]||$(e.target).hasClass("open-colorpicker")||0!=$(e.target).parents("#colorpicker").length||(ELM.colorpicker.hide(),$(".open-colorpicker").removeClass("open"))}),window.devicePixelRatio>=3?$("img[data-3x]").each(function(){$(this).attr("src",$(this).attr("data-3x"))}):window.devicePixelRatio>=1.2&&$("img[data-2x]").each(function(){$(this).attr("src",$(this).attr("data-2x"))}),ELM.body.on("keypress","[data-type=letters]",function(e){return restrictAlpha(e)}),ELM.body.on("keypress","[data-type=alpha]",function(e){return restrictAlphaNumeric(e)}),ELM.body.on("blur","[data-type=email]",function(){var e=$(this).val();email_check(e)||""===e?$(this).removeClass("error"):($(this).addClass("error"),element_display_error($(this),"You must enter a valid email address."))}),$(document).keydown(function(e){27==e.which&&close_modal()});var _countries_opts="";for(var c in _countries)c=_countries[c],_countries_opts+='<option data-currency="'+c.currencyCode.toLowerCase()+'" value="'+c.iso3.toLowerCase()+'">'+c.name+"</option>";if(ELM.nav_dashboard.click(function(){$(this).hasClass("selected")||(ELM.panel_dash_recent.find(".search-close").trigger("click"),ELM.panel_dash_recent.find(".search-field").removeData("prev-value"),ELM.panel_dash_recent.find(".submenu a.payments").trigger("click"),ELM.panel_dash_recent.addClass("loading"),$.ajax({type:"GET",url:base_url+"api/transactions/",success:function(e){ELM.panel_dash_recent.addClass("fetched").data("fetched_data",e),transactions_fillout(e),ELM.panel_dash_recent.removeClass("loading")},error:function(e){ELM.panel_dash_recent.removeClass("loading"),ajax_error(e)}}),$.ajax({type:"GET",url:base_url+"api/reports/",success:function(e){ELM.panel_dash_sales.data("reports",e.payment_reports),ELM.panel_dash_members.data("reports",e.member_reports);var t=ELM.panel_dash_sales.find("div.reports-grid"),a=ELM.panel_dash_members.find("div.reports-grid"),n=e.payment_reports,i=e.member_reports;t.find("div.stat.payments strong").html(n.totals.alltime.count),t.find("div.stat.today strong").html(currency_symbol+n.totals.today.amount),t.find("div.stat.month strong").html(currency_symbol+n.totals.month.amount),t.find("div.stat.alltime strong").html(currency_symbol+n.totals.alltime.amount),a.find("div.stat.members strong").html(i.totals.alltime),a.find("div.stat.today strong").html(i.totals.today),a.find("div.stat.month strong").html(i.totals.month);var s="";if(void 0!==n.top_spaces)for(space_o in n.top_spaces)space=n.top_spaces[space_o],s=s+'<li class="ani-ran" data-id="'+space_o+'"><h4 class="inline">'+space.name+'</h4><div class="arrow"></div><div class="right-text full"><div class="wrap"><div class="inner"><div class="text"><strong>'+currency_symbol+space.amount+"</strong> <em>"+_lc_words.total+"</em></div></div></div></div></li>";if(void 0!==n.deleted_spaces)for(space in n.deleted_spaces)space=n.deleted_spaces[space],s=s+'<li class="ani-ran deleted"><h4 class="inline">'+space.name+'</h4><div class="arrow"></div><div class="right-text full"><div class="wrap"><div class="inner"><div class="badge">'+_lc_words.deleted+'</div><div class="text"><strong>'+currency_symbol+space.amount+"</strong> <em>"+_lc_words.total+"</em></div></div></div></div></li>";""==s?$("#sales_spaces_list").html("").parent().hide():$("#sales_spaces_list").html(s).parent().removeAttr("style");var r="";if(void 0!==i.members_spaces)for(space_mem in i.members_spaces)space_m=i.members_spaces[space_mem],r=r+'<li class="ani-ran" data-id="'+space_mem+'"><h4 class="inline">'+space_m.name+'</h4><div class="arrow"></div><div class="right-text full"><div class="wrap"><div class="inner"><div class="text"><strong>'+space_m.members+"</strong> <em>"+_lc_words.total+"</em></div></div></div></div></li>";""==r?$("#members_spaces_list").html("").parent().hide():$("#members_spaces_list").html(r).parent().removeAttr("style")},error:function(e){ajax_error(e)}}))}),ELM.panel_dash_sales.add(ELM.panel_dash_members).find("header select").change(function(e){var t=$(this).find("option:selected").text(),a=$(this).find("option:selected").val();if($(this).parent().find(".dropdown span").html(t),$(this).parents("#panel_dash_members").length>0){var n=ELM.panel_dash_members.find("div.reports-grid"),i=ELM.panel_dash_members.data("reports")[a];"totals"==a?(n.find("div.stat.members h5").text(_lc_words.members),n.find("div.stat.today h5").text("New Today"),n.find("div.stat.month h5").text("New This Month")):(n.find("div.stat.members h5").text("Total Cancellations"),n.find("div.stat.today h5").text("Today"),n.find("div.stat.month h5").text("This Month")),n.find("div.stat.members strong").html(i.alltime),n.find("div.stat.today strong").html(i.today),n.find("div.stat.month strong").html(i.month)}else{var s=ELM.panel_dash_sales.find("div.reports-grid"),i=ELM.panel_dash_sales.data("reports")[a];"refunds"==a?(s.find("div.stat.payments h5").text(_lc_words.refunds),s.find("div.stat.today h5").text("Today"),s.find("div.stat.month h5").text("This Month"),s.find("div.stat.alltime h5").text("Total Refunds")):(s.find("div.stat.payments h5").text(_lc_words.payments),s.find("div.stat.today h5").text(_lc_words.sales_today),s.find("div.stat.month h5").text("Sales This Month"),s.find("div.stat.alltime h5").text("Total Sales")),s.find("div.stat.payments strong").html(i.alltime.count),s.find("div.stat.today strong").html(currency_symbol+i.today.amount),s.find("div.stat.month strong").html(currency_symbol+i.month.amount),s.find("div.stat.alltime strong").html(currency_symbol+i.alltime.amount)}e.preventDefault()}),$("#sales_spaces_list, #members_spaces_list").on("click","li:not(.deleted)",function(e){ELM.spaces_nav.find("li[data-id="+$(this).attr("data-id")+"]").add(ELM.sidebar_switcher.find("a.spaces")).trigger("click"),e.preventDefault()}),ELM.body.on("transactions_fillout",function(e,t){var a=void 0!=t&&void 0==t._is_close?t:ELM.panel_dash_recent.data("fetched_data");delete a._is_close,transactions_fillout(a)}),ELM.nav_terminal.click(function(e){var t=ELM.panel_terminal.find("form");t[0].reset(),t.find("input[name=seller_name]").val(user.name),t.find("input[name=seller_email]").val(user.email),ELM.panel_terminal.find(".submenu a.terminal").trigger("click"),e.preventDefault()}),ELM.panel_terminal.on("click","a.swipe",function(e){$("#terminal_input").focus(),e.preventDefault()}),$("#terminal_input").change(function(e){var t=new SwipeParserObj($(this).val()),a=ELM.panel_terminal.find("form");t.account||show_notify({type:"error",text:"Swipe error. Please swipe again."});var n=t.firstname?t.firstname+" "+t.surname:t.account_name;return a.find("input[name=cc_name]").val(n.replace(/\s{2,}/g," ")),a.find("input[name=cc_number]").val(t.account).keypress(),a.find("input[name=exp]").val(t.exp_month+"/"+t.exp_year),$(this).val(""),a.find("input[name=amount]").focus(),!1}).focus(function(){ELM.panel_terminal.find("form a.btn.swipe").addClass("glow")}).blur(function(){ELM.panel_terminal.find("form a.btn.swipe").removeClass("glow")}),ELM.panel_terminal.find(".submenu a.reports").click(function(){var e=$(this);if(!e.hasClass("fetched")){var t=$(this).parents("section.panel:first");t.addClass("loading"),$.ajax({type:"GET",url:base_url+"api/reports/terminal",success:function(a){var n=t.find("div.stats");n.find("div.stat.payments strong").html(a.alltime.count),n.find("div.stat.today strong").html(currency_symbol+a.today.amount),n.find("div.stat.month strong").html(currency_symbol+a.month.amount),n.find("div.stat.alltime strong").html(currency_symbol+a.alltime.amount),e.addClass("fetched"),t.removeClass("loading")},error:function(e){t.removeClass("loading"),ajax_error(e)}})}}),ELM.panel_terminal.on("click","form a.submit",function(e){var t=$(this);if(!t.hasClass("stale")){var a=ELM.panel_terminal.find("form");add_button_spinner({elem:t,color:"#fff"});var n=!1,i=a.find("input[name=cc_name]").val(),s=a.find("input[name=cc_number]").val(),r=a.find("input[name=exp]").val(),l=a.find("input[name=cvc]").val(),o=a.find("input[name=email]").val(),d=a.find("input[name=amount]").val(),c=a.find("select[name=charge_currency] option:selected").val(),p=a.find("input[name=description]").val(),m=a.find("input[name=seller_name]").val(),u=a.find("input[name=seller_email]").val();d.match(/^\d+(?:\.\d+)?$/)?100>100*d?(element_display_error(a.find("input[name=amount]"),"Charge Amount must be at least $1"),n=!0):email_check(o)?""===p?(element_display_error(a.find("input[name=description]"),"Please enter a valid Description"),n=!0):""===m?(element_display_error(a.find("input[name=seller_name]"),"Please enter a Seller Name"),n=!0):email_check(u)?""===i?(element_display_error(a.find("input[name=cc_name]"),"Please enter a Customer Name"),n=!0):Stripe.validateCardNumber(s)?Stripe.validateExpiry(r.split("/")[0],r.split("/")[1])?Stripe.validateCVC(l)||(element_display_error(a.find("input[name=cvc]"),"Please enter a valid CVC number"),n=!0):(element_display_error(a.find("input[name=exp]"),"Please enter a valid Expiration Date"),n=!0):(element_display_error(a.find("input[name=cc_number]"),"Please enter a valid Credit Card Number"),n=!0):(element_display_error(a.find("input[name=seller_email]"),"Please enter a valid Seller Email"),n=!0):(element_display_error(a.find("input[name=email]"),"You must enter a valid Customer Email"),n=!0):(element_display_error(a.find("input[name=amount]"),"Please enter a valid Charge Amount"),n=!0);var _={number:s,cvc:l,exp_month:r.split("/")[0],exp_year:r.split("/")[1]};n?remove_button_spinner(t):(Stripe.setPublishableKey(stripe_user_key),Stripe.createToken(_,function(e,n){if(n.error)remove_button_spinner(t),show_notify({type:"error",text:"Could not validate your card. Please try again."});else{var s={token:n.id,from_terminal:!0,name:i,email:o,amount:d,charge_currency:c,seller_name:m,seller_email:u,description:base64.encode(p)};$.ajax({type:"POST",url:base_url+"api/payments",data:JSON.stringify(s),success:function(){remove_button_spinner(t),show_notify({text:"Charge Successful"}),a[0].reset(),a.find("select[name=charge_currency]")[0].value=c},error:function(e){remove_button_spinner(t),ajax_error(e)}})}}))}e.preventDefault()}),ELM.panel_terminal.on("change","select[name=charge_currency]",function(e){var t=ELM.panel_terminal.find("form"),a=get_currency_symbol($(this).find("option:selected").val());t.find("input[name=amount]").parent().children("strong:first").html(a)}),ELM.panel_acct_details.find("a.btn.submit").click(function(){var e=$(this);if(!e.hasClass("stale")){var t=ELM.panel_acct_details.find("input[name=name]").val(),a=ELM.panel_acct_details.find("input[name=email]").val(),n=ELM.panel_acct_details.find("select[name=payme_currency]"),i=ELM.panel_acct_details.find("select[name=plan] option:selected").val(),s=ELM.panel_acct_details.find("input[name=payme_enabled]:checked").length>0?"YES":"NO",r=ELM.panel_acct_details.find("select[name=default_payment_fund] option:selected").val(),l=ELM.panel_acct_details.find("select[name=billing_fund] option:selected").val(),o=ELM.panel_acct_details.find("select[name=timezone] option:selected").val(),d=i!=user.account_type&&""!=stripe_user_key?!0:!1,c=!1;if(""==t?(element_display_error(ELM.panel_acct_details.find("input[name=name]"),"Please enter your Name."),c=!0):email_check(a)?""==o&&(element_display_error(ELM.panel_acct_details.find("input[name=timezone]"),"You must select a Timezone."),c=!0):(element_display_error(ELM.panel_acct_details.find("input[name=email]"),"You must enter a valid Email."),c=!0),!c){var p={name:t,email:a,payme_enabled:s,default_payment_fund:r,billing_fund:l,timezone:o,address:ELM.panel_acct_details.find("input[name=address]").val(),city:ELM.panel_acct_details.find("input[name=city]").val(),state:ELM.panel_acct_details.find("input[name=state]").val(),zip:ELM.panel_acct_details.find("input[name=zip]").val(),country:ELM.panel_acct_details.find("input[name=country]").val()};n.length>0&&(p.payme_currency=n.find("option:selected").val());var m=function(e){var t="Your account will be immediately updated. Ok?";"basic"!==user.account_type&&"basic"===i?t="The Basic plan charges 3% per transaction and has no monthly fee.":"premium"!==user.account_type&&"premium"===i?t="The Premium plan charges 1% per transaction and $29 per month.":"platinum"!==user.account_type&&"platinum"===i&&(t="The Platinum plan charges 0% per transaction and $139 per month."),d?confirmation(t,function(t){t&&(e.plan=i,u(e))},!0):c||u(e)},u=function(t){add_button_spinner({elem:e,color:"#fff"}),$.ajax({type:"PUT",url:base_url+"api/user/?action=settings",data:JSON.stringify(t),success:function(a){user.name=t.name,user.email=t.email,user.payme_currency=t.payme_currency;var n=ELM.panel_acct_details.find("input[name=new_password]"),s=ELM.panel_acct_details.find("input[name=old_password]");""!=n.val()&&""!=s.val()?$.ajax({type:"PUT",url:base_url+"api/user/?action=password",data:JSON.stringify({password:n.val(),old_password:s.val()}),success:function(){show_notify({text:"Settings Saved"}),n.val(""),s.val(""),remove_button_spinner(e)},error:function(t){remove_button_spinner(e),ajax_error(t)}}):(show_notify({text:"Settings Saved"}),remove_button_spinner(e)),d&&(ELM.panel_acct_details.find("select[name=plan] option").removeAttr("selected"),ELM.panel_acct_details.find("select[name=plan]")[0].value=i,user.account_type=i)},error:function(t){remove_button_spinner(e),ajax_error(t),402==t.status&&$("#wallet_helper").addClass("show")}})};m(p)}}return!1}),ELM.panel_acct_details.find("form footer a.btn.delete").click(function(e){var t=$(this);if(!t.hasClass("stale")){var a=""!=stripe_user_key?"Are you sure you want to permanently Delete your account?<br>All your data, your customer data and all recurring payments your customers have will be permanently deleted.":"Are you sure you want to permanently Delete your account? All your data will be permanently deleted.";confirmation(a,function(e){e&&(add_button_spinner({elem:t,color:"#555"}),$.ajax({type:"DELETE",url:base_url+"api/user/",success:function(){window.location=base_url},error:function(e){remove_button_spinner(t),ajax_error(e)}}))},!0)}e.preventDefault()}),ELM.panel_acct_details.find("select[name=timezone]")[0].value=user.timezone,"UTC"==user.timezone){var timezone_today=new Date,timezone_jan=new Date(timezone_today.getFullYear(),0,1),timezone_jul=new Date(timezone_today.getFullYear(),6,1),timezone_dst=timezone_today.getTimezoneOffset()<Math.max(timezone_jan.getTimezoneOffset(),timezone_jul.getTimezoneOffset()),timezone_offset=-(timezone_today.getTimezoneOffset()/60),timezone_dst=+timezone_dst;if(0>timezone_offset)var tz=timezone_offset-timezone_dst;else var tz=timezone_offset+timezone_dst;ELM.panel_acct_details.find("select[name=timezone]").removeAttr("selected");var opt=ELM.panel_acct_details.find("select[name=timezone] option[data-utc="+tz+"]").clone();ELM.panel_acct_details.find("select[name=timezone] option[data-utc="+tz+"]").remove(),ELM.panel_acct_details.find("select[name=timezone]").prepend($('<option value="">-----------------------</option>')).prepend(opt)}$("#user_avatar").on("change","input[type=file]",function(){do_upload_image({elem:$(this),url:"api/user/?action=avatar",callback:function(e){e.avatar&&($("#user_avatar > .inner").attr("style","background-image:url('"+e.avatar+"')"),ELM.app_nav.find("a.account .avatar img").attr("src",e.avatar))}})}),$("#wallet_helper").click(function(e){ELM.subnav.find("a.funds").click(),$(this).removeClass("show"),e.preventDefault()}),ELM.nav_funds.click(function(e){var t=$(this);(!t.hasClass("selected")&&!t.hasClass("fetched")||void 0!=e.isTrigger)&&(ELM.panel_funds.addClass("loading"),$.ajax({type:"GET",url:base_url+"api/funds/",success:function(e){t.addClass("fetched");var a=1==e.count?_lc_words.fund:_lc_words.funds;if($("#funds_total_items").text(e.count+" "+a),e.count>0){for(var n=[],i=0;i<e.count;i++){var s=e.items[i],r=$('<li data-id="'+s.id+'" class="ani"><h4>'+s.cc_type+" - "+s.cc_last4+'</h4><div class="right-text full"><div class="wrap"><div class="inner"><div class="text">'+s.name_on_account+'</div></div></div></div><a href="" class="icon delete push" title="'+_lc_words["delete"]+'">✕</a></li>');n.push(r)}ELM.funds_list.html(n),animation_setup({elem:ELM.funds_list,delay:50,do_filter:!0})}else ELM.funds_list.html('<li class="none">'+_lc_words.no_funds_yet+"</li>");ELM.panel_funds.removeClass("loading")},error:function(e){ELM.panel_funds.removeClass("loading"),ajax_error(e)}})),e.preventDefault()}),ELM.panel_funds.find("header a.add").click(function(e){ELM.panel_funds_item.find("form")[0].reset(),ELM.panel_funds_item.removeAttr("data-id"),ELM.content.attr("class","funds-item new"),remove_display_errors(ELM.panel_funds_item),ELM.panel_funds_item.find("header .right.badge").html(_lc_words.new_fund).addClass("green"),e.preventDefault()}),ELM.panel_funds_item.find("a.btn.submit").click(function(e){var t=$(this),a=ELM.panel_funds_item.find("form");if(!t.hasClass("stale")){var n=!1,i={cc_name:a.find("input[name=cc_name]").val(),cc_number:a.find("input[name=cc_number]").val(),exp:a.find("input[name=exp]").val(),cvc:a.find("input[name=cvc]").val()};""==i.cc_name?(element_display_error(a.find("input[name=cc_name]"),"Please enter a Card Holder Name."),n=!0):Stripe.validateCardNumber(i.cc_number)?Stripe.validateExpiry(i.exp.split("/")[0],i.exp.split("/")[1])?Stripe.validateCVC(i.cvc)||(element_display_error(a.find("input[name=cvc]"),"Please enter a valid CVC number"),n=!0):(element_display_error(a.find("input[name=exp]"),"Please enter a valid Expiration Date"),n=!0):(element_display_error(a.find("input[name=cc_number]"),"Please enter a valid Credit Card Number"),n=!0),n||(add_button_spinner({elem:t,color:"#fff"}),Stripe.createToken({name:i.cc_name,number:i.cc_number,cvc:i.cvc,exp_month:i.exp.split("/")[0],exp_year:i.exp.split("/")[1]},function(e,a){a.error?(remove_button_spinner(t),ajax_error(a)):$.ajax({type:"POST",url:base_url+"api/funds",data:JSON.stringify({token:a.id}),success:function(){ELM.nav_funds.removeClass("selected").trigger("click"),show_notify({text:"Fund Added"}),remove_button_spinner(t)},error:function(e){remove_button_spinner(t),ajax_error(e)}})}))}e.preventDefault()}),ELM.funds_list.on("click","li a.delete",function(e){var t=$(this);confirmation("Are you sure you want to Delete this Fund?",function(e){e&&(ELM.panel_funds.addClass("loading"),$.ajax({type:"DELETE",url:base_url+"api/funds/"+t.parents("li").attr("data-id"),success:function(){ELM.panel_funds.removeClass("loading"),ELM.nav_funds.removeClass("selected").click(),show_notify({text:"Deleted Fund"})},error:function(e){ELM.panel_funds.removeClass("loading"),ajax_error(e)}}))},!0),e.preventDefault()}),ELM.nav_market.click(function(e){var t=$(this);(!t.hasClass("selected")&&!t.hasClass("fetched")||void 0!=e.isTrigger)&&(ELM.panel_market.addClass("loading"),$.ajax({type:"GET",url:base_url+"api/markets/",success:function(e){t.addClass("fetched");var a=$("#upload_market_banner");void 0!==e.banner_image&&""!=e.banner_image&&null!=e.banner_image?(ELM.panel_market.find("> header").add(a.find("> .inner")).css({"background-image":"url("+s3_url+"market/"+e.banner_image+")"}),a.addClass("image")):a.removeClass("image"),void 0!==e.name?(ELM.panel_market.find("> header h3").html(e.name),ELM.panel_market.find("input[name=name]").val(e.name),ELM.panel_market.find("input[name=website]").val(e.website),ELM.panel_market.find("input[name=twitter]").val(e.twitter),ELM.panel_market.find("input[name=facebook]").val(e.facebook),ELM.panel_market.find("textarea[name=description]").val(e.description),ELM.panel_market.find("input[name=keywords]").val(e.keywords),"YES"==e.enabled&&0==ELM.panel_market.find("input[name=enabled]:checked").length&&ELM.panel_market.find("input[name=enabled]").click(),$("#your_store_link").attr("href",base_url+"market/"+e.slug).show()):(ELM.panel_market.find("form")[0].reset(),$("#your_store_link").hide()),ELM.panel_market.removeClass("loading")},error:function(e){ELM.panel_market.removeClass("loading"),ajax_error(e)}})),e.preventDefault()}),ELM.panel_market.find("a.btn.submit").click(function(e){var t=$(this),a=ELM.panel_market.find("form");if(!t.hasClass("stale")){var n=!1,i={name:a.find("input[name=name]").val(),enabled:a.find("input[name=enabled]:checked").length>0?"YES":"NO"};""!=i.name&&/^[a-zA-Z0-9- &\']+$/.test(i.name)||(element_display_error(a.find("input[name=name]"),"The Store Name can only contain letters, numbers, &, ', spaces and dashes."),n=!0),n||(add_button_spinner({elem:t,color:"#fff"}),$.ajax({type:"PUT",url:base_url+"api/markets",data:JSON.stringify({name:i.name,description:a.find("textarea[name=description]").val(),website:a.find("input[name=website]").val(),twitter:a.find("input[name=twitter]").val(),facebook:a.find("input[name=facebook]").val(),keywords:a.find("input[name=keywords]").val(),enabled:i.enabled}),success:function(e){var n=""==e.banner_image?"Saved.<br>You'll need to upload a banner image to activate your store.":"Saved";a.find("input[name=keywords]").val(e.keywords),ELM.panel_market.find("> header h3").html(i.name),$("#your_store_link").attr("href",base_url+"market/"+e.slug).show(),show_notify({text:n}),remove_button_spinner(t)},error:function(e){remove_button_spinner(t),ajax_error(e)}}))}e.preventDefault()}),ELM.panel_market.on("change","input[type=file]",function(){do_upload_image({elem:$(this),url:"api/markets/?action=files",callback:function(e){e.banner&&ELM.panel_market.find("> header").add($("#upload_market_banner > .inner")).attr("style","background-image:url('"+s3_url+"market/"+e.banner+"')")}})});var setup_timeout=!1;ELM.spaces_nav.on("click","li:not(.none)",function(e){var t=$(this);if(!t.hasClass("selected")){remove_display_errors(ELM.panel_setup),ELM.container.add(ELM.panel_setup).removeClass("nosubnav");var a=t.attr("data-id"),n=ELM.panel_setup.addClass("loading").find("form");ELM.panel_setup.filter("[data-cursym]").length>0&&ELM.content.hasClass("setup")&&(ELM.panel_setup.addClass("pulse"),setup_timeout&&window.clearTimeout(setup_timeout),setup_timeout=window.setTimeout(function(){ELM.panel_setup.removeClass("pulse")},450)),t.parent().children("li").add($("#app_nav a")).add(ELM.subnav.find("a")).removeClass("selected"),t.add(t.find("a.setup")).addClass("selected"),t.find("a.setup").trigger("click"),ELM.container.attr("class",t.attr("data-type")),ELM.content.attr("class","setup"),n[0].reset(),n.find("input, textarea").removeClass("error"),n.find(".upload-holder .inner").removeAttr("style"),n.find(".upload-holder").removeClass("chosen"),ELM.panel_setup.find("> header h3").html("&nbsp;"),$("#setup_today_stat dd").html("&nbsp;"),ELM.mobile_header.find("h2").html($(this).find("h3").html()),t.hasClass("fetched")?space_setup_fillout(t,t.data("fetched_data")):$.ajax({type:"GET",url:base_url+"api/spaces/"+a,success:function(e){t.data("fetched_data",e),space_setup_fillout(t,e)},error:function(e){ELM.panel_setup.removeClass("loading"),ajax_error(e)}})}e.preventDefault()}),ELM.panel_setup.find("a.btn.submit").click(function(e){var t=$(this),a=ELM.panel_setup.find("form");if(!t.hasClass("stale")){remove_display_errors(ELM.panel_setup);var n=$("#upload_background");add_button_spinner({elem:t,color:"#fff"});var i=!1,s=ELM.content.hasClass("new")?!0:!1;if(space_id=s?"":ELM.spaces_nav.find("li.selected").attr("data-id"),space_type=ELM.panel_setup.attr("data-type"),cur_sym=ELM.panel_setup.attr("data-cursym"),vals={name:a.find("input[name=name]").val(),description:a.find("textarea[name=description]").val(),seller_name:a.find("input[name=seller_name]").val(),seller_email:a.find("input[name=seller_email]").val(),seller_website:a.find("input[name=seller_website]").val(),return_url:a.find("input[name=return_url]").val(),terms:a.find("textarea[name=terms]").val(),analytics:a.find("input[name=analytics]").val(),analytics_service:a.find("select[name=analytics_service] option:selected").val(),email_me:a.find("input[name=email_me]:checked").length>0?"YES":"NO",add_tax:a.find("input[name=add_tax]:checked").length>0?"YES":"NO",tax_amount:a.find("input[name=tax_amount]").val(),in_market:a.find("input[name=in_market]:checked").length>0?"YES":"NO",allow_coupons:a.find("input[name=allow_coupons]:checked").length>0?"YES":"NO",require_billing:a.find("input[name=require_billing]:checked").length>0?"YES":"NO",require_shipping:a.find("input[name=require_shipping]:checked").length>0?"YES":"NO",add_tax:a.find("input[name=add_tax]:checked").length>0?"YES":"NO",send_invoice:a.find("input[name=send_invoice]:checked").length>0?"YES":"NO",space_mode:a.find("select[name=space_mode] option:selected").val(),charge_currency:a.find("select[name=charge_currency] option:selected").val(),charge_date:a.find("input[name=charge_date]").val(),bg_appearance:n.attr("data-type"),bg_color:n.attr("data-value")},""==vals.name?(element_display_error(a.find("input[name=name]"),"Please enter a Space Name"),i=!0):a.find("select[name=charge_currency]").length>0?3!=vals.charge_currency.length&&(show_notify({type:"error",text:"Please enter a valid Currency"}),i=!0):""==vals.seller_name?(element_display_error(a.find("input[name=seller_name]"),"Please enter a Seller Name"),i=!0):email_check(vals.seller_email)?"pre-order"!=vals.space_mode||validate_date(vals.charge_date)?""==vals.tax_amount||vals.tax_amount.match(/^\d+(?:\.\d+)?$/)||(element_display_error(a.find("input[name=tax_amount]"),"Tax Amount value must be a number."),i=!0):(element_display_error(a.find("input[name=charge_date]"),"Please enter a valid Charge Date"),i=!0):(element_display_error(a.find("input[name=seller_email]"),"Please enter a valid Seller Email"),i=!0),i)remove_button_spinner(t);else{var r=s?"POST":"PUT",l={type:space_type,name:vals.name,seller_name:vals.seller_name,seller_email:vals.seller_email,seller_website:vals.seller_website,analytics:vals.analytics,analytics_service:vals.analytics_service,require_billing:vals.require_billing,require_shipping:vals.require_shipping,email_me:vals.email_me,in_market:vals.in_market,allow_coupons:vals.allow_coupons,add_tax:vals.add_tax,tax_amount:vals.tax_amount,send_invoice:vals.send_invoice,description:base64.encode(vals.description),space_mode:vals.space_mode,bg_appearance:vals.bg_appearance,bg_color:vals.bg_color};if(a.find("select[name=charge_currency]").length>0&&(l.charge_currency=vals.charge_currency,cur_sym=get_currency_symbol(vals.charge_currency)),"pre-order"==vals.space_mode&&(l.charge_date=vals.charge_date),"membership"==space_type){l.terms=base64.encode(vals.terms);var o=ELM.plans_list.children("li"),d=o.length;if(d>8)show_notify({type:"error",text:"You're limited to 8 plans."}),i=!0;else if(d>0){var c={},p={};o.filter(".new").each(function(e){var t=$(this).find("input.name").val(),a=$(this).find("input.amount").val(),n=$(this).find("select.interval option:selected").val();"Plan Name"==t||""==t?(element_display_error($(this).find("input.name"),"You Must enter a valid Plan Name."),i=!0):a.match(/^\d+(?:\.\d+)?$/)?99>100*a?(element_display_error($(this).find("input.amount"),"Amount must be at least "+cur_sym+"0.99"),i=!0):(c[e]={},c[e].name=t,c[e].amount=a,"custom"!==n?c[e].interval=n:(c[e].interval=$(this).find("select.interval_type option:selected").val(),c[e].interval_count=$(this).find("select.interval_count option:selected").val())):(element_display_error($(this).find("input.amount"),"You Must enter a valid "+cur_sym+" Amount."),i=!0)}),o.filter(".saved").each(function(e){var t=$(this).find("input.name");""==t.val()?(element_display_error($(this).find("input.name"),"You Must enter a valid Plan Name."),i=!0):t.val()!=t.attr("data-name")&&(p[e]={},p[e].id=$(this).attr("data-id"),p[e].name=t.val())}),$.isEmptyObject(c)||(l.new_plans=c),$.isEmptyObject(p)||(l.saved_plans=p)}}if("YES"==vals.send_invoice){var m=a.find("input[name=invoice_address]").val(),u=a.find("input[name=invoice_city]").val(),_=a.find("input[name=invoice_state]").val(),f=a.find("input[name=invoice_zip]").val(),h=a.find("input[name=invoice_country]").val();
""==m||""==u||""==_||""==f||""==h?(i||show_notify({type:"error",text:"Please fill out all invoice fields"}),i=!0):(l.invoice_address=m,l.invoice_city=u,l.invoice_state=_,l.invoice_zip=f,l.invoice_country=h)}if("onetime"==space_type){l.return_url=vals.return_url;var v=ELM.shipping_list.find("li:not(.none)"),g={};v.length>0&&v.each(function(e){var t=$(this).find("input.name").val(),a=$(this).find("input.amount").val();""==t?(element_display_error($(this).find("input.name"),"You Must enter a valid Shipping Option Name."),i=!0):a.match(/^\d+(?:\.\d+)?$/)?99>100*a?(element_display_error($(this).find("input.amount"),"Shipping Option Amount must be at least "+cur_sym+"0.99"),i=!0):(g[e]={},g[e].name=t,g[e].amount=a):(element_display_error($(this).find("input.amount"),"You Must enter a valid Shipping Option "+cur_sym+" Amount."),i=!0)}),l.shipping_options=g}i?remove_button_spinner(t):$.ajax({type:r,url:base_url+"api/spaces/"+space_id,data:JSON.stringify(l),success:function(e){if("POST"==r){var n=function(){var n=ELM.spaces_nav.find("li:not(.none)").length>0?!1:!0,i="membership"==space_type?_lc_words.membership:_lc_words.one_time,s=_lc_words.space_created;ELM.container.removeAttr("data-dashboard-classes"),ELM.spaces_nav.children("li.none").remove();var r=$("<div/>").html(get_currency_symbol(vals.charge_currency)).text();ELM.spaces_nav.prepend("membership"==space_type?'<li data-id="'+e.id+'" data-type="'+space_type+'" data-cursym="'+r+'"><div class="avatar"><img src="'+s3_url+'theme/default_space_200.jpg" alt=""></div><div class="title"><h3>'+vals.name+"</h3><p>"+i+'</p></div><menu class="sub-list"><a href="" data-panel="setup" class="setup"><span class="icon"></span><strong>'+_lc_words.setup+'</strong></a><a href="" data-panel="plans" class="plans"><span class="icon"></span><strong>'+_lc_words.plans+'</strong></a><a href="" data-panel="data" class="data"><span class="icon"></span><strong>'+_lc_words.data+'</strong></a><a href="" data-panel="content" class="content"><span class="icon"></span><strong>'+_lc_words.content+'</strong></a><a href="" data-panel="members" class="members"><span class="icon"></span><strong>'+_lc_words.members+"</strong></a></menu></li>":'<li data-id="'+e.id+'" data-type="'+space_type+'" data-cursym="'+r+'"><div class="avatar"><img src="'+s3_url+'theme/default_space_200.jpg" alt=""></div><div class="title"><h3>'+vals.name+"</h3><p>"+i+'</p></div><menu class="sub-list"><a href="" data-panel="setup" class="setup"><span class="icon"></span><strong>'+_lc_words.setup+'</strong></a><a href="" data-panel="products" class="products"><span class="icon"></span><strong>'+_lc_words.products+'</strong></a><a href="" data-panel="data" class="data"><span class="icon"></span><strong>'+_lc_words.data+'</strong></a><a href="" data-panel="payments" class="payments"><span class="icon"></span><strong>'+_lc_words.payments+"</strong></a></menu></li>"),ELM.spaces_nav.children("[data-id="+e.id+"]").data("fetched_data",e).click(),n&&"membership"==space_type?$("#space_plan_helper").addClass("show"):n&&$("#space_product_helper").addClass("show"),a.find("select[name=space_mode]").attr("data-mode",l.space_mode),show_notify({text:s}),remove_button_spinner(t)},i=ELM.panel_setup.find(".upload-holder.chosen:not(.type-color) input[type=file]");if(i.length>0){var s=ELM.panel_setup.attr("data-id"),o={total:i.length,completed:0};i.each(function(){var t=$(this);do_upload_image({elem:t,url:"api/spaces/"+e.id+"?action=files",callback:function(e){o.completed=o.completed+1,e.logo&&(ELM.panel_setup.children("header:first").find("img").attr("src",s3_url+"theme/"+e.logo),ELM.spaces_nav.find("li[data-id="+s+"] img").attr("src",s3_url+"theme/"+e.logo),t.parents(".inner:first").attr("style","background-image:url('"+s3_url+"theme/"+e.logo+"')")),e.bg_image&&ELM.panel_setup.children("header:first").add(t.parents(".inner:first")).attr("style","background-image:url('"+s3_url+"theme/"+e.bg_image+"')"),o.completed==o.total&&n()}})})}else n()}else if("PUT"==r){var d=_lc_words.saved_space,c=ELM.spaces_nav.children("[data-id="+e.id+"]");if(c.data("fetched_data",e).find("h3").add($("#setup_space_title")).html(vals.name),a.find("select[name=charge_currency]").length>0){var p=$("<div/>").html(get_currency_symbol(vals.charge_currency)).text();c.attr("data-cursym",p)}a.find("select[name=space_mode]").attr("data-mode",l.space_mode),show_notify({text:d}),remove_button_spinner(t)}},error:function(e){remove_button_spinner(t),ajax_error(e)}})}}e.preventDefault()}),ELM.panel_setup.find("form footer a.btn.delete").click(function(e){var t=$(this),a=ELM.panel_setup.attr("data-id"),n=ELM.container.hasClass("membership")?"Are you sure you want to permanently Delete this space?<br>All customers in this Space will be deleted, and all subscriptions for this Space will be terminated.":"Are you sure you want to permanently Delete this space?<br>All products and other data in this Space will be deleted.";"pre-order"==ELM.panel_setup.find("form select[name=space_mode]").attr("data-mode")&&(n+="<br><br>This Space is set to <strong>Pre-Order</strong>. All of your customers on this Space who have not yet been charged will NOT be charged and will be removed."),confirmation(n,function(e){e&&(add_button_spinner({elem:t,color:"#222"}),$.ajax({type:"DELETE",url:base_url+"api/spaces/"+a,success:function(){ELM.spaces_nav.find("li[data-id="+a+"]").remove(),ELM.spaces_nav.children("li:not(.none)").length>0?ELM.spaces_nav.find("li:first").click():(ELM.sidebar_switcher.find("a.home").click(),ELM.nav_account.click(),ELM.spaces_nav.append('<li class="none">'+_lc_words.no_spaces_yet+"</li>")),ELM.spaces_nav.scrollTop(0),show_notify({text:"Deleted Space"}),remove_button_spinner(t)},error:function(e){remove_button_spinner(t),ajax_error(e)}}))},!0),e.preventDefault()}),ELM.panel_setup.on("change","input[name=require_shipping]",function(){if($(this).is(":checked"))ELM.shipping_list.parents(".shipping").addClass("show");else{ELM.shipping_list.parents(".shipping").removeClass("show");var e=ELM.panel_setup.find("input[name=send_invoice]");e.is(":checked")&&e.click()}}),ELM.panel_setup.on("change","input[name=require_billing]",function(){if(!$(this).is(":checked")){var e=ELM.panel_setup.find("input[name=send_invoice]");e.is(":checked")&&e.click()}}),ELM.panel_setup.on("change","select.interval",function(){var e=$(this);"custom"==e.find("option:selected").val()?(e.after('<span class="extra">: <select class="interval_count short"><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option></select><select class="interval_type short"><option value="month">'+_lc_words.months+'</option><option value="week">'+_lc_words.weeks+"</option></select></span>"),e.addClass("short")):e.removeClass("short").parent().find("span.extra").remove()}),ELM.panel_setup.on("change","select[name=space_mode]",function(){"pre-order"==$(this).val()?("pre-order"!==$(this).attr("data-mode")&&confirmation("Setting the Space Status to <strong>Pre-Order</strong> means your customers will not be charged when they checkout. Instead, they will be charged on the <strong>Charge Date</strong>. You must set a Charge Date, and you'll be able to change the Charge Date at anytime. If you do change the Charge Date, all your customers on this Space will be notified via email.<br><br>Your customers will be able to cancel their order at anytime as well. You will be notified if this happens.",function(){$("#setup_charge_date").focus()},!1),$("#setup_charge_date").css("display","block")):($("#setup_charge_date").hide(),"pre-order"==$(this).attr("data-mode")&&"live"==$(this).val()&&confirmation("This Space is currently set to <strong>Pre-Order</strong>. If you switch from Pre-Order to Live Mode, all of your customers on this Space who have not yet been charged will be charged immediately. Save the Setup form to apply this change.",function(){},!1))}),ELM.shipping_list.parents(".shipping").find("header a.add").click(function(){var e=ELM.shipping_list.children("li").length,t=ELM.panel_setup.attr("data-cursym"),a=e-1>0?"no-height":"",n=$('<li class="invisible '+a+'"><input type="text" class="name inline" placeholder="'+_lc_words.fee_name+'" value="Domestic" title="'+_lc_words.fee_name+'"><span class="currency inline"><strong>'+t+' </strong><input type="text" class="amount price" value="10.99" placeholder="10.99" min="1" title="'+t+" "+_lc_words.amount+'"></span><a href="" class="icon delete push" title="'+_lc_words["delete"]+'">✕</a></li>');return ELM.shipping_list.children("li.none").remove(),ELM.shipping_list.prepend(n),ELM.shipping_list.find("input.price").payment("restrictPrice"),e-1>0?(window.setTimeout(function(){n.removeClass("no-height")},5),window.setTimeout(function(){n.removeClass("invisible")},220)):window.setTimeout(function(){n.removeClass("invisible")},5),!1}),ELM.shipping_list.on("click","a.delete",function(){var e=$(this),t=e.parents("li"),a=ELM.shipping_list.children("li").length;return t.addClass("invisible"),a-1>0?(window.setTimeout(function(){t.addClass("no-height")},200),window.setTimeout(function(){t.remove()},500)):window.setTimeout(function(){ELM.shipping_list.html('<li class="none">'+_lc_words.none+"</li>")},200),!1}),ELM.panel_setup.on("change","input[name=send_invoice]",function(){var e=$("#invoice_address_fields"),t=ELM.panel_setup.find("input[name=require_billing]");$(this).is(":checked")?(""==e.find("input[name=invoice_address]").val()&&e.find("input[name=invoice_address]").val(user.address.address),""==e.find("input[name=invoice_city]").val()&&e.find("input[name=invoice_city]").val(user.address.city),""==e.find("input[name=invoice_state]").val()&&e.find("input[name=invoice_state]").val(user.address.state),""==e.find("input[name=invoice_zip]").val()&&e.find("input[name=invoice_zip]").val(user.address.zip),""==e.find("input[name=invoice_country]").val()&&e.find("input[name=invoice_country]").val(user.address.country),e.addClass("show"),t.is(":checked")||t.click()):e.removeClass("show")}),ELM.panel_setup.on("change","input[name=add_tax]",function(){var e=ELM.panel_setup.find("input[name=tax_amount]").parents("label:first");$(this).is(":checked")?e.addClass("show"):e.removeClass("show")}),ELM.panel_setup.on("change",".upload input[type=file]",function(){var e=$(this);if(ELM.content.hasClass("new")){if(e.parents(".upload-holder").addClass("chosen"),e[0].files&&e[0].files[0]){var t=new FileReader;t.onload=function(t){e.parent().css({"background-image":"url('"+t.target.result+"')"}).parent().addClass("image")},t.readAsDataURL(e[0].files[0])}}else{var a=ELM.panel_setup.attr("data-id");do_upload_image({elem:e,url:"api/spaces/"+a+"?action=files",callback:function(t){var n=ELM.spaces_nav.children("[data-id="+a+"]").data("fetched_data");t.logo&&(ELM.panel_setup.children("header:first").find("img").attr("src",s3_url+"theme/"+t.logo),ELM.spaces_nav.find("li[data-id="+a+"] img").attr("src",s3_url+"theme/"+t.logo),e.parents(".inner:first").attr("style","background-image:url('"+s3_url+"theme/"+t.logo+"')"),n.logo=t.logo),t.bg_image&&(ELM.panel_setup.children("header:first").add(e.parents(".inner:first")).attr("style","background-image:url('"+s3_url+"theme/"+t.bg_image+"')"),n.bg_image=t.bg_image),ELM.spaces_nav.children("[data-id="+t.id+"]").data("fetched_data",n)}})}}),$("#upload_background menu.tab-switch a.color").click(function(e){var t=$(this).parents(".upload-holder").attr("data-value");ELM.panel_setup.children("header:first").attr("style","background-image:none;background-color:#"+t).removeClass("image").addClass("color "+get_color_contrast(t))}),$("#upload_background menu.tab-switch a.image").click(function(e){var t=ELM.panel_setup.children("header:first");t.attr("style","background-image:url("+t.attr("data-bg_image")+")").removeClass("dark light color").addClass("image")}),$("#upload_background").on("colorpicker",function(e,t){ELM.panel_setup.children("header:first").attr("style","background-image:none;background-color:"+t).removeClass("dark light").addClass(get_color_contrast(t.replace("#","")))}),$("#setup_share_space").click(function(e){show_modal("share-space"),e.preventDefault()}),$("#space_product_helper").click(function(e){ELM.subnav.find("a.products").click(),$(this).removeClass("show"),e.preventDefault()}),ELM.spaces_nav.on("click","a.products",function(e){var t=$(this);t.hasClass("selected")&&void 0==e.isTrigger||(ELM.panel_products.addClass("loading"),t.hasClass("fetched")?products_list_fillout(t.data("fetched_data")):(ELM.products_list.html(""),$.ajax({type:"GET",url:base_url+"api/products/?space_id="+ELM.spaces_nav.find("li.selected").attr("data-id"),success:function(e){t.addClass("fetched").data("fetched_data",e),products_list_fillout(e)},error:function(e){ELM.panel_products.removeClass("loading"),ajax_error(e)}}))),e.preventDefault()}),ELM.panel_products.find("header a.add").click(function(e){ELM.panel_products_item.find("form")[0].reset(),ELM.panel_products_item.removeAttr("data-id"),remove_display_errors(ELM.panel_products_item),ELM.content.attr("class","products_item new"),ELM.panel_products_item.find("> header h3").html(_lc_words.new_product),ELM.panel_products_item.find("> header dl.id dd").html("").parent().hide(),ELM.files_list.html('<li class="none">'+_lc_words.no_files+"</li>"),e.preventDefault()}),ELM.products_list.on("click","li:not(>.handle,.none)",function(e){var t=ELM.panel_products_item.find("form"),a=$(this).attr("data-id"),n=ELM.content.attr("class").replace(" new","");ELM.content.find("section.panel[data-panel="+n+"]").addClass("active-sub"),t[0].reset(),remove_display_errors(ELM.panel_products_item),ELM.panel_products.addClass("loading"),$.ajax({type:"GET",url:base_url+"api/products/"+a,success:function(e){if(ELM.panel_products.removeClass("loading"),ELM.panel_products_item.attr("data-id",a).attr("data-stock",e.stock),ELM.content.attr("class","products_item"),ELM.panel_products_item.find("> header dl.id dd").html(a).parent().show(),ELM.panel_products_item.find("> header h3").html(e.name),t.find("select[name=type] option").removeAttr("selected"),t.find("input[name=name]").val(e.name),t.find("textarea[name=description]").val(e.description),t.find("input[name=amount]").val(e.amount),t.find("input[name=stock]").val(e.stock),t.find("input[name=max_quantity]").val(e.max_quantity),t.find("div.label.file").removeClass("delete"),t.find("select[name=type]")[0].value=e.type,"YES"==e.enable_quantity?(t.find("input[name=enable_quantity]").attr("checked","checked"),t.find("input[name=max_quantity]").parents("label:first").addClass("show")):(t.find("input[name=enable_quantity]").removeAttr("checked"),t.find("input[name=max_quantity]").parents("label:first").removeClass("show")),"any"==e.type?t.find("input[name=amount]").attr("disabled","disabled"):t.find("input[name=amount]").removeAttr("disabled"),e.files.length>0){for(var n="",i=0;i<e.files.length;i++){var s=e.files[i];n+='<li class="saved" data-id="'+s.id+'"><span class="handle"><em></em><em></em><em></em></span><input type="text" class="name inline" maxlength="100" placeholder="'+_lc_words.file_name+'" title="'+_lc_words.file_name+'" data-oldVal="'+s.name+'" value="'+s.name+'"><div class="left-text">'+s.original_name+'</div><a href="" class="icon re-upload push" title="'+_lc_words.re_upload_file+'"><input type="file">↑</a><a href="'+s.file_url+'" class="icon download push" title="'+_lc_words.download_file+'">↓</a><a href="" class="icon delete push" title="'+_lc_words["delete"]+'">✕</a><div class="progress-bar"><div class="inner"></div></div></li>'}ELM.files_list.html(n).sortable("reload")}else ELM.files_list.html('<li class="none">'+_lc_words.no_files+"</li>");"YES"==e.enabled?t.find("input[name=enabled]").attr("checked","checked"):t.find("input[name=enabled]").removeAttr("checked"),ELM.body.animate({scrollTop:0})},error:function(e){ELM.panel_products.removeClass("loading"),ajax_error(e)}}),e.preventDefault()});var products_sort_timeout=!1;ELM.products_list.sortable({handle:".handle"}).bind("sortupdate",function(e){sort_handler({elem:ELM.products_list,path:"products",time:1500,callback:function(e){ELM.nav_products.data("fetched_data",e)}})});var files_sort_timeout=!1;ELM.files_list.sortable({handle:".handle"}).bind("sortupdate",function(e,t){$(t.item[0]).hasClass("saved")&&sort_handler({elem:ELM.files_list,path:"files",id:ELM.panel_products_item.attr("data-id"),time:1500,callback:function(e){var t=ELM.spaces_nav.find("li.selected a.products").data("fetched_data");for(var a in t)if(t[a].id==ELM.panel_products_item.attr("data-id")){t[a].files=e.items;break}ELM.spaces_nav.find("li.selected a.products").data("fetched_data",t)}})}),ELM.panel_products_item.find("a.btn.submit").click(function(e){var t=$(this),a=ELM.panel_products_item.find("form");if(!t.hasClass("stale")){remove_display_errors(ELM.panel_products_item);var n=!1,i=ELM.panel_setup.attr("data-cursym"),s={name:a.find("input[name=name]").val(),type:a.find("select[name=type] option:selected").val(),description:a.find("textarea[name=description]").val(),amount:a.find("input[name=amount]").val(),stock:a.find("input[name=stock]").val(),max_quantity:a.find("input[name=max_quantity]").val(),enable_quantity:a.find("input[name=enable_quantity]:checked").length>0?"YES":"NO",enabled:a.find("input[name=enabled]:checked").length>0?"YES":"NO"},r=s.stock!=ELM.panel_products_item.attr("data-stock")?!0:!1;if(""==s.name?(element_display_error(a.find("input[name=name]"),"Please enter a Product Name"),n=!0):"fixed"!=s.type||s.amount.match(/^\d+(?:\.\d+)?$/)?"fixed"==s.type&&100*s.amount<99?(element_display_error(a.find("input[name=amount]"),"Amount must be at least "+i+"0.99"),n=!0):""==s.stock||s.stock.match(/^\d+(?:\.\d+)?$/)?""==s.max_quantity||s.max_quantity.match(/^\d+(?:\.\d+)?$/)?""!=s.max_quantity&&s.max_quantity<=0&&(element_display_error(a.find("input[name=max_quantity]"),"Max. Quantity value must greater than zero."),n=!0):(element_display_error(a.find("input[name=max_quantity]"),"Max. Quantity value must be a number."),n=!0):(element_display_error(a.find("input[name=stock]"),"In Stock value must be a number."),n=!0):(element_display_error(a.find("input[name=amount]"),"You must enter a valid "+i+" Amount."),n=!0),!n){var l=ELM.spaces_nav.find("li.selected").attr("data-id"),o=void 0!==ELM.panel_products_item.attr("data-id")?ELM.panel_products_item.attr("data-id"):l,d=void 0!==ELM.panel_products_item.attr("data-id")?"PUT":"POST",c={space_id:l,name:s.name,type:s.type,description:base64.encode(s.description),amount:s.amount,max_quantity:s.max_quantity,enable_quantity:s.enable_quantity,enabled:s.enabled};r&&(c.stock=s.stock),add_button_spinner({elem:t,color:"#fff"}),$.ajax({type:d,url:base_url+"api/products/"+o,data:JSON.stringify(c),success:function(e){var a=function(){var a=ELM.products_list.children("li").length,n=1==a?_lc_words.product:_lc_words.products;$("#products_total_items").text(a+" "+n),ELM.spaces_nav.find("li.selected:first a.products").data("fetched_data",e),remove_button_spinner(t),ELM.panel_products_item.find("> header a.back").trigger("click"),show_notify({text:_lc_words.saved_product})};if("PUT"==d){var n=ELM.products_list.find("li[data-id="+o+"]"),r="any"==s.type?_lc_words.any:i+s.amount;n.find("h4").text(s.name),n.find(".right-text .text").html(r),a()}else{var l=e.new_product,r="any"==l.type?_lc_words.any:i+l.amount;ELM.products_list.find("li.none").remove(),ELM.products_list.prepend('<li data-id="'+l.id+'" class="ani ani-ran"><div class="handle"><em></em><em></em><em></em></div><h4>'+l.name+'</h4><div class="arrow"></div><div class="right-text full"><div class="wrap"><div class="inner"><div class="text">'+r+"</div></div></div></div></li>"),ELM.products_list.sortable("reload"),delete e.new_product;var c=ELM.files_list.children("li.new"),p=l.id,m={number:0,total:c.length};c.length>0?c.find("input[type=file]").each(function(e){var t=function(){m.number=+m.number+1,m.number==m.total&&a()};product_upload_handler($(this),p,!1,t)}):a()}},error:function(e){remove_button_spinner(t),ajax_error(e)}})}}e.preventDefault()}),ELM.panel_products_item.on("change","input[type=file]",function(e){var t=void 0!=$(this).parents("li:first").attr("data-id")?$(this).parents("li:first").attr("data-id"):!1;$(this).parents("li:first").find(".left-text").html(e.target.value.replace("C:\\fakepath\\","")),product_upload_handler($(this),ELM.panel_products_item.attr("data-id"),t,!1)}),ELM.panel_products_item.on("blur","input.name",function(){var e=$(this),t=e.val(),a=e.attr("data-oldVal"),n=e.parents("li:first").attr("data-id");t==a||e.parents("li:first").hasClass("new")||$.ajax({type:"PUT",url:base_url+"api/files/"+n,data:JSON.stringify({name:t}),success:function(a){e.attr("data-oldVal",t),show_notify({text:_lc_words.file_name_saved})},error:function(e){ajax_error(e)}})}),ELM.panel_products_item.find("a.btn.delete").click(function(e){var t=$(this),a=ELM.panel_products_item.attr("data-id");confirmation("Are you sure you want to Delete this Product? Existing customers will not have access to it in the future.",function(e){e&&(add_button_spinner({elem:t,color:"#222"}),$.ajax({type:"DELETE",url:base_url+"api/products/"+ELM.panel_products_item.attr("data-id"),success:function(){ELM.products_list.find("li[data-id="+a+"]").remove();for(var e=ELM.spaces_nav.find("li.selected:first a.products").data("fetched_data"),n=0;n<e.count;n++)if(e.items[n].id==a){delete e.items[n];break}e.count=e.count-1,e.items.length=e.items.length-1,ELM.spaces_nav.find("li.selected:first a.products").data("fetched_data",e);var i=1==e.count?_lc_words.product:_lc_words.products;$("#products_total_items").text(e.count+" "+i),ELM.products_list.children("li").length<=0&&ELM.products_list.prepend('<li class="none ani-ran">'+_lc_words.no_products_yet+"</li>"),ELM.products_list.sortable("reload"),ELM.content.attr("class","products"),show_notify({text:_lc_words.deleted_product}),remove_button_spinner(t)},error:function(e){ajax_error(e),remove_button_spinner(t)}}))},!0),e.preventDefault()}),ELM.panel_products_item.find("select[name=type]").change(function(){var e=$(this).find("option:selected").val();"any"==e?ELM.panel_products_item.find("input[name=amount]").attr("disabled","disabled"):ELM.panel_products_item.find("input[name=amount]").removeAttr("disabled")}),ELM.panel_products_item.on("change","input[name=enable_quantity]",function(){var e=ELM.panel_products_item.find("input[name=max_quantity]").parents("label:first");$(this).is(":checked")?e.addClass("show"):e.removeClass("show")}),ELM.files_list.parent().find("header a.add").click(function(){var e=$('<li class="new invisible no-height"><span class="handle"><em></em><em></em><em></em></span><input type="text" class="name inline" maxlength="100" placeholder="'+_lc_words.file_name+'" title="'+_lc_words.file_name+'" value="'+_lc_words.file_name+'"><a href="" class="icon upload push" title="'+_lc_words.upload+'"><input type="file">↑</a><div class="left-text">'+_lc_words.choose_file+'</div><a href="" class="icon delete push" title="'+_lc_words["delete"]+'">✕</a><div class="progress-bar"><div class="inner"></div></div></li>');return ELM.files_list.find("li.none").remove(),ELM.files_list.prepend(e),window.setTimeout(function(){e.removeClass("no-height")},5),window.setTimeout(function(){e.removeClass("invisible")},220),ELM.files_list.sortable("reload"),!1}),ELM.files_list.on("click","li a.delete",function(){var e=ELM.files_list.find("li").length,t=$(this),a=t.parents("li");return a.hasClass("saved")?confirmation("Are you sure you want to Delete this File?",function(e){if(e){var t=a.attr("data-id");$.ajax({type:"DELETE",url:base_url+"api/files/"+t,success:function(){a.addClass("invisible"),window.setTimeout(function(){a.addClass("no-height")},200),window.setTimeout(function(){a.remove()},500),show_notify({text:_lc_words.deleted})},error:function(e){ajax_error(e)}})}},!0):(a.addClass("invisible"),window.setTimeout(function(){a.addClass("no-height")},200),window.setTimeout(function(){a.remove()},500)),0>=e-1&&ELM.files_list.html('<li class="none">'+_lc_words.no_files+"</li>"),!1}),ELM.spaces_nav.on("click","a.data",function(e){var t=$(this);t.hasClass("selected")&&void 0==e.isTrigger||(ELM.panel_data.addClass("loading"),t.hasClass("fetched")?data_list_fillout(t.data("fetched_data")):(ELM.data_list.html(""),$.ajax({type:"GET",url:base_url+"api/data_fields/?space="+ELM.spaces_nav.find("li.selected").attr("data-id"),success:function(e){t.addClass("fetched").data("fetched_data",e),data_list_fillout(e)},error:function(e){ELM.panel_data.removeClass("loading"),ajax_error(e)}})))}),ELM.data_list.sortable({handle:".handle"}).bind("sortupdate",function(e,t){$(t.item[0]).hasClass("saved")&&sort_handler({elem:ELM.data_list,path:"data_fields",time:1500,callback:function(e){ELM.nav_data.data("fetched_data",e)}})}),ELM.data_list.on("click","a.delete",function(e){var t=$(this),a=t.parents("li"),n=ELM.data_list.children("li").length;a.hasClass("saved")?confirmation("Are you sure you want to Delete this Data Item?",function(e){if(e){var t=a.attr("data-id");$.ajax({type:"DELETE",url:base_url+"api/data_fields/"+t,success:function(){a.addClass("invisible"),window.setTimeout(function(){a.addClass("no-height")},200),window.setTimeout(function(){a.remove()},500);var e=parseInt($("#data_total_items span").text())-1;$("#data_total_items span").text(e),ELM.data_list.children("li").length<=0?(ELM.panel_data.find("footer a.submit").addClass("disabled"),ELM.data_list.html('<li class="none">'+_lc_words.no_data_items_yet+"</li>")):(ELM.panel_data.find("footer a.submit").removeClass("disabled"),ELM.data_list.sortable("reload")),show_notify({text:_lc_words.deleted_data_item})},error:function(e){ajax_error(e)}})}},!0):(a.addClass("invisible"),window.setTimeout(function(){a.addClass("no-height")},200),window.setTimeout(function(){a.remove(),0>=n-1?(ELM.panel_data.find("footer").hide(),ELM.data_list.html('<li class="none">'+_lc_words.no_data_items_yet+"</li>")):(ELM.panel_data.find("footer").show(),ELM.data_list.sortable("reload"))},600)),e.preventDefault()}),ELM.panel_data.find("header a.add").click(function(e){ELM.data_list.find("li.none").remove();var t=$('<li class="new no-highlight invisible no-height"><div class="handle"><em></em><em></em><em></em></div><input type="text" class="name inline" placeholder="'+_lc_words.name+'" title="'+_lc_words.name+'"><label class="general-holder"><input type="checkbox" class="required"> '+_lc_words.required+'</label><div class="select-holder"><select class="type"><option value="general">'+_lc_words.general_text+'</option><option value="email">'+_lc_words.email+'</option><option value="letters">'+_lc_words.letters_only+'</option><option value="numbers">'+_lc_words.numbers_only+'</option><option value="alpha">'+_lc_words.alphanumeric_only+'</option><option value="textarea">'+_lc_words.textarea+'</option></select></div><a href="" class="icon delete push" title="'+_lc_words["delete"]+'">✕</a></li>');ELM.data_list.prepend(t),window.setTimeout(function(){t.removeClass("no-height")},5),window.setTimeout(function(){t.removeClass("invisible")},220),ELM.panel_data.find("footer").show(),ELM.data_list.sortable("reload"),e.preventDefault()}),ELM.panel_data.find("a.btn.submit").click(function(e){var t=$(this);if(!t.hasClass("stale")&&!t.hasClass("disabled")){var a=ELM.data_list.children("li"),n=a.length,i={},s={},r=!1;if(0>=n)show_notify({type:"error",text:"You must add a Data Item."});else{var l={space_id:ELM.spaces_nav.find("li.selected").attr("data-id")};a.filter(".new").each(function(e){var t=$(this).children("input.name").val();"Item Name"==t||""==t?(element_display_error($(this).children("input.name"),"You must enter a valid Item Name.",!1),r=!0):(i[e]={},i[e].name=t,i[e].type=$(this).find("select.type option:selected").val(),i[e].required=$(this).find("input.required:checked").length>0?"YES":"NO")}),a.filter(".saved").each(function(e){var t=$(this).children("input.name");""==t.val()?(element_display_error($(this).children("input.name"),"You must enter a valid Item Name.",!1),r=!0):(s[e]={},s[e].id=$(this).attr("data-id"),s[e].name=t.val(),s[e].type=$(this).find("select.type option:selected").val(),s[e].required=$(this).find("input.required:checked").length>0?"YES":"NO")}),void 0!==i[0]&&(l.new_items=i),void 0!==s[0]&&(l.saved_items=s);var o=[];a.each(function(){o.push(null!=$(this).attr("data-id")?{id:$(this).attr("data-id")}:{name:$(this).children("input.name").val()})}),l.order=o,r||(add_button_spinner({elem:t,color:"#fff"}),$.ajax({type:"PUT",url:base_url+"api/data_fields/"+l.space_id,data:JSON.stringify(l),success:function(e){show_notify({text:_lc_words.data_saved}),remove_button_spinner(t),ELM.nav_data.data("fetched_data",e)},error:function(e){remove_button_spinner(t),ajax_error(e)}}))}}e.preventDefault()}),ELM.spaces_nav.on("click","a.content",function(e){var t=$(this);t.hasClass("selected")&&void 0==e.isTrigger||(ELM.panel_content.addClass("loading"),t.hasClass("fetched")?content_list_fillout(t.data("fetched_data")):(ELM.content_list.html(""),$.ajax({type:"GET",url:base_url+"api/posts/?space="+ELM.spaces_nav.find("li.selected").attr("data-id"),success:function(e){t.addClass("fetched").data("fetched_data",e),content_list_fillout(e)},error:function(e){ELM.panel_content.removeClass("loading"),ajax_error(e)}}))),e.preventDefault()}),ELM.panel_content.find("header a.add").click(function(e){var t=ELM.panel_content_item.find("form");t[0].reset(),ELM.panel_content_item.find("header .right.badge").html(_lc_words.new_post).addClass("green"),ELM.panel_content_item.removeAttr("data-id"),t.find("div.label.file").removeClass("change").addClass("empty"),t.find(".checks-holder").removeClass("disabled").find("input").removeAttr("disabled checked"),ELM.content.attr("class","content-item new"),e.preventDefault()}),ELM.content_list.on("click","li:not(.none)",function(e){var t=ELM.panel_content_item.find("form"),a=$(this).attr("data-id"),n=ELM.content.attr("class").replace(" new","");ELM.content.find("section.panel[data-panel="+n+"]").addClass("active-sub"),t[0].reset(),t.removeClass("new"),ELM.panel_content.addClass("loading");var i=t.find("span.checks-holder");i.removeClass("disabled"),i.find("input").removeAttr("disabled"),$.ajax({type:"GET",url:base_url+"api/posts/"+a,success:function(e){ELM.panel_content.removeClass("loading"),ELM.panel_content_item.attr("data-id",a),ELM.content.attr("class","content-item"),ELM.body.animate({scrollTop:0}),ELM.panel_content_item.find("header .right.badge").html(e.time).removeClass("green"),t.find("textarea").val(e.text);var n=t.find(".file-helper");if(n.removeClass("delete"),""!=e.original_filename&&null!=e.original_filename?(n.find("a.remove").removeAttr("style"),n.removeClass("empty change"),n.find(".icon").removeClass("upload").addClass("re-upload").attr("title",_lc_words.re_upload_file),n.find(".left-text").html('<a href="'+e.file_url+'">'+e.original_filename+'</a><a href="" class="remove" title="'+_lc_words.remove_file+'">&times;</a>')):(n.find("a.remove").hide(),n.removeClass("change").addClass("empty"),n.find(".icon").removeClass("re-upload").addClass("upload").attr("title",_lc_words.upload),n.find(".left-text").html(_lc_words.choose_file)),"all"==e.plans){var s=t.find("span.checks input.all");t.find("span.checks input").not(s).removeAttr("checked"),s.attr("checked","checked"),i.addClass("disabled").find("input").attr("disabled","disabled")}else{for(var r=!1,l=0;l<e.plans.length;l++)r=r?r.add(t.find("span.checks-holder input[value="+e.plans[l]+"]")):t.find("span.checks-holder input[value="+e.plans[l]+"]");r?(r.attr("checked","checked"),t.find("span.checks input").not(r).removeAttr("checked")):t.find("span.checks input").removeAttr("checked")}},error:function(e){ELM.panel_content.removeClass("loading"),ajax_error(e)}}),e.preventDefault()}),ELM.panel_content_item.find("a.btn.submit").click(function(e){var t=$(this),a=ELM.panel_content_item.find("form");if(!t.hasClass("stale")){var n=!1,i={text:a.find("textarea[name=text]").val(),file:a.find("input[name=file]")};
""==i.text&&""==i.file.val().replace("C:\\fakepath\\","")&&(ELM.content.hasClass("new")||i.file.parent().hasClass("empty"))&&(show_notify({type:"error",text:"Please enter either some Post text or attach a file."}),n=!0);var s={space_id:ELM.spaces_nav.find("li.selected").attr("data-id"),text:base64.encode(i.text),"plans[]":[]};a.find(".file-helper").hasClass("delete")&&(s.delete_file="YES");var r=!1;a.find("input.all").is(":checked")?(s["plans[]"]="all",r=!0):a.find("span.checks-holder input:checked").each(function(){s["plans[]"].push($(this).val()),r=!0}),r||(show_notify({type:"error",text:"You must select at least 1 plan to show this post to."}),n=!0);var l=!1;if(void 0!=i.file.val()){if(""!=i.file.val().replace("C:\\fakepath\\","")){var o=new FormData;o.append("file",i.file[0].files[0]),l=!0}}else a.find(".file-helper").hasClass("delete")&&(s.delete_file=!0);if(!n){add_button_spinner({elem:t,color:"#fff"});var d=ELM.content.hasClass("new")?"POST":"PUT",c="PUT"==d?ELM.panel_content_item.attr("data-id"):"";$.ajax({type:d,url:base_url+"api/posts/"+c,data:JSON.stringify(s),success:function(e){var a=e.clip,n=function(n){if(show_notify({text:_lc_words.post_saved}),remove_button_spinner(t),ELM.panel_content_item.find("header a.back").trigger("click"),"PUT"==d)n?ELM.content_list.find("li[data-id="+e.id+"]").addClass("file").prepend('<div class="icon"></div>'):void 0!=s.delete_file&&ELM.content_list.find("li[data-id="+e.id+"]").removeClass("file").children(".icon").remove();else{ELM.content_list.find("li.none").remove();var i=ELM.content_list.children("li").length,r=1==i?_lc_words.plan:_lc_words.plans;$("#plans_total_items").text(i+" "+r),ELM.content_list.prepend(n?'<li data-id="'+e.id+'" class="file ani ani-ran"><div class="icon"></div><h4>'+a+'</h4><div class="arrow"></div><div class="right-text full"><div class="wrap"><div class="inner"><time class="text">'+e.time+"</time></div></div></div></li>":'<li data-id="'+e.id+'" class="ani ani-ran"><h4>'+a+'</h4><div class="arrow"></div><div class="right-text full"><div class="wrap"><div class="inner"><time class="text">'+e.time+"</time></div></div></div></li>")}};if(l){var i="POST"==d?e.id:c,r=function(e){if(e.lengthComputable){var t=Math.round(100*e.loaded/e.total);100==t?ELM.upload_progress.removeClass("show"):(ELM.upload_progress.addClass("show"),ELM.upload_progress.find("div.inner").css("width",t+"%"))}};$.ajax({type:"POST",url:base_url+"api/posts/"+i+"?action=files",data:o,cache:!1,contentType:!1,processData:!1,dataType:!1,xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",function(e){r(e)},!1),e},success:function(e){n(!0)},error:function(a){remove_button_spinner(t),ajax_error(a),ELM.content.removeClass("new").attr("data-id",e.id)}})}else n(!1)},error:function(e){remove_button_spinner(t),ajax_error(e)}})}}e.preventDefault()}),ELM.panel_content_item.find("a.btn.delete").click(function(e){var t=$(this),a=ELM.panel_content_item.attr("data-id");confirmation("Are you sure you want to permanently Delete this post?",function(e){e&&(add_button_spinner({elem:t,color:"#222"}),$.ajax({type:"DELETE",url:base_url+"api/posts/"+a,success:function(){ELM.content_list.find("li[data-id="+a+"]").remove();var e=ELM.content_list.children("li").length,n=1==e?_lc_words.post:_lc_words.posts;$("#content_total_items").text(e+" "+n),0>=e&&ELM.content_list.prepend('<li class="none ani-ran">'+_lc_words.no_posts_yet+"</li>"),ELM.content.attr("class","content"),show_notify({text:_lc_words.deleted_post}),remove_button_spinner(t)},error:function(e){remove_button_spinner(t),ajax_error(e)}}))},!0),e.preventDefault()}),ELM.panel_content_item.on("change","input[type=file]",function(e){$(this).parents(".file-helper:first").find(".left-text").html(e.target.value.replace("C:\\fakepath\\",""))}),ELM.panel_content_item.on("click",".file-helper a.remove",function(e){$(this).parents(".file-helper").toggleClass("delete"),e.preventDefault()}),ELM.panel_content_item.find("form input.all").click(function(){var e=$(this).parents("span.checks").children("span.checks-holder");$(this).is(":checked")?(e.addClass("disabled"),e.find("input").attr("disabled","disabled")):(e.removeClass("disabled"),e.find("input").removeAttr("disabled"))}),ELM.panel_content_item.find("form span.checks-holder").on("click","input",function(){ELM.panel_content_item.find("form input.all").removeAttr("checked")}),ELM.spaces_nav.on("click","a.plans",function(e){var t=$(this);t.hasClass("selected")&&void 0==e.isTrigger||(ELM.panel_plans.addClass("loading"),t.hasClass("fetched")?plans_list_fillout(t.data("fetched_data")):(ELM.plans_list.html(""),$.ajax({type:"GET",url:base_url+"api/plans/?space="+ELM.spaces_nav.find("li.selected").attr("data-id"),success:function(e){t.addClass("fetched").data("fetched_data",e),plans_list_fillout(e)},error:function(e){ELM.panel_plans.removeClass("loading"),ajax_error(e)}}))),e.preventDefault()}),ELM.panel_plans.find("header a.add").click(function(e){var t=ELM.panel_plans_item.find("form");t[0].reset(),ELM.panel_plans_item.find("header .right.badge").show(),ELM.panel_plans_item.removeAttr("data-id"),t.find("[disabled=disabled]").removeAttr("disabled"),t.find(".extra").remove(),t.find("select[name=interval]").removeAttr("style").parent().removeClass("disabled-contrast"),ELM.panel_plans_item.find("header .view-stripe").hide(),remove_display_errors(ELM.panel_plans_item),ELM.content.attr("class","plans-item new"),e.preventDefault()});var plans_sort_timeout=!1;ELM.plans_list.sortable({handle:".handle"}).bind("sortupdate",function(e){sort_handler({elem:ELM.plans_list,path:"plans",time:1500,callback:function(e){ELM.nav_plans.data("fetched_data",e)}})}),ELM.panel_plans_item.on("change","input[name=onetime_enabled]",function(){var e=ELM.panel_plans_item.find("input[name=onetime_amount]").parents("label:first"),t=ELM.panel_plans_item.find("input[name=onetime_switch_charge]").parents("label:first");$(this).is(":checked")?e.add(t).addClass("show").find("input").removeAttr("disabled"):e.add(t).removeClass("show").find("input").attr("disabled","disabled")}),ELM.panel_plans_item.on("change","select.interval",function(){var e=$(this);"custom"==e.find("option:selected").val()?e.after('<span class="extra">: &nbsp;</span><span class="extra select"><select name="interval_count" class="interval_count short"><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option></select><select name="interval_type" class="interval_type short"><option value="month">'+_lc_words.months+'</option><option value="week">'+_lc_words.weeks+"</option></select></span>"):e.removeClass("short").parent().find("span.extra").remove()}),ELM.plans_list.on("click","li:not(.none)",function(e){var t=ELM.panel_plans_item.find("form"),a=$(this).attr("data-id"),n=ELM.content.attr("class").replace(" new","");ELM.content.find("section.panel[data-panel="+n+"]").addClass("active-sub"),t[0].reset(),t.removeClass("new"),ELM.panel_plans_item.find("header .right.badge").hide(),ELM.panel_plans.addClass("loading"),remove_display_errors(ELM.panel_plans_item);var i=t.find("span.checks-holder");i.removeClass("disabled"),i.find("input").removeAttr("disabled"),ELM.panel_plans_item.find("header time").html(""),t.find(".extra").remove(),$.ajax({type:"GET",url:base_url+"api/plans/"+a,success:function(e){ELM.panel_plans.removeClass("loading"),ELM.panel_plans_item.attr("data-id",a),ELM.content.attr("class","plans-item"),ELM.body.animate({scrollTop:0});var n=t.find("select[name=interval]");ELM.panel_plans_item.find("header .view-stripe").attr("href",stripe_dashboard_url+"plans/"+e.stripe_id).show(),t.find("input[name=name]").val(e.name),t.find("textarea").val(e.description),t.find("input[name=amount]").val(e.amount).attr("disabled","disabled"),t.find("input[name=onetime_amount]").val(e.onetime_amount),n.attr("disabled","disabled"),"YES"==e.enabled&&0==t.find("input[name=enabled]:checked").length&&t.find("input[name=enabled]").click(),"NO"==e.onetime_switch_charge&&t.find("input[name=onetime_switch_charge]:checked").length>0&&t.find("input[name=onetime_switch_charge]").click(),"YES"==e.onetime_enabled&&0==t.find("input[name=onetime_enabled]:checked").length?t.find("input[name=onetime_enabled]").click():t.find("input[name=onetime_enabled]").parents(".form-group:first").find("label.hideable").removeClass("show"),e.interval_count>0?(n.hide(),n.after('<div class="input extra disabled capitalize">'+e.interval_count+" "+e.interval+"s</div>").parent().addClass("disabled-contrast")):(n.removeAttr("style").parent().removeClass("disabled-contrast"),n[0].value=e.interval)},error:function(e){ELM.panel_plans.removeClass("loading"),ajax_error(e)}}),e.preventDefault()}),ELM.panel_plans_item.find("a.btn.submit").click(function(e){var t=$(this),a=ELM.panel_plans_item.find("form"),n=ELM.spaces_nav.find("li.selected").attr("data-id"),i=ELM.panel_setup.attr("data-cursym");if(!t.hasClass("stale")){remove_display_errors(ELM.panel_plans_item);var s=!1,r={name:a.find("input[name=name]").val(),description:a.find("textarea[name=description]").val(),enabled:a.find("input[name=enabled]:checked").length>0?"YES":"NO",amount:a.find("input[name=amount]").val(),interval:a.find("select[name=interval] option:selected").val(),interval_count:a.find("select[name=interval_count] option:selected").val(),interval_type:a.find("select[name=interval_type] option:selected").val(),onetime_enabled:a.find("input[name=onetime_enabled]:checked").length>0?"YES":"NO",onetime_switch_charge:a.find("input[name=onetime_switch_charge]:checked").length>0?"YES":"NO",onetime_amount:a.find("input[name=onetime_amount]").val()};""==r.name?(element_display_error(a.find("input[name=name]"),"Please enter a Plan Name"),s=!0):r.amount.match(/^\d+(?:\.\d+)?$/)?"YES"!=r.onetime_enabled||r.onetime_amount.match(/^\d+(?:\.\d+)?$/)?"YES"==r.onetime_enabled&&100*r.onetime_amount<99&&(element_display_error(a.find("input[name=onetime_amount]"),"Amount must be at least "+i+"0.99"),s=!0):(element_display_error(a.find("input[name=onetime_amount]"),"You must enter a valid "+i+" Amount."),s=!0):(element_display_error(a.find("input[name=amount]"),"You must enter a valid "+i+" Amount."),s=!0);var l={space_id:n,name:r.name,enabled:r.enabled,amount:r.amount,onetime_enabled:r.onetime_enabled,onetime_amount:r.onetime_amount,onetime_switch_charge:r.onetime_switch_charge};if("custom"==r.interval?(l.interval=r.interval_type,l.interval_count=r.interval_count):l.interval=r.interval,""!=r.description&&(l.description=base64.encode(r.description)),!s){var o=ELM.panel_plans_item.is("[data-id]")?"PUT":"POST",d="PUT"==o?ELM.panel_plans_item.attr("data-id"):n;add_button_spinner({elem:t,color:"#fff"}),$.ajax({type:o,url:base_url+"api/plans/"+d,data:JSON.stringify(l),success:function(e){if("PUT"==o)ELM.plans_list.find("li[data-id="+d+"] h4").text(r.name);else{var a=e.new_plan,n=a.interval_count>0?a.interval_count+" "+a.interval+"s":a.interval;ELM.plans_list.find("li.none").remove(),ELM.plans_list.prepend('<li data-id="'+a.id+'" class="ani ani-ran"><div class="handle"><em></em><em></em><em></em></div><h4>'+a.name+'</h4><div class="arrow"></div><div class="right-text full"><div class="wrap"><div class="inner"><div class="text capitalize"><strong>'+i+a.amount+"</strong> / "+n+"</div></div></div></div></li>"),ELM.plans_list.sortable("reload");var s=ELM.plans_list.children("li").length,l=1==s?_lc_words.plan:_lc_words.plans;$("#plans_total_items").text(s+" "+l),delete e.new_plan}ELM.spaces_nav.find("li.selected:first a.plans").data("fetched_data",e),show_notify({text:_lc_words.plan_saved}),remove_button_spinner(t),ELM.panel_plans_item.find("header a.back").trigger("click")},error:function(e){remove_button_spinner(t),ajax_error(e)}})}}e.preventDefault()}),ELM.panel_plans_item.find("a.btn.delete").click(function(e){var t=$(this),a=ELM.panel_plans_item.attr("data-id");confirmation("Are you sure you want to Delete this Plan?<br>Deleting this plan will not affect current subscribers to the plan, but new subscribers to the plan won't be allowed.",function(e){e&&(add_button_spinner({elem:t,color:"#222"}),$.ajax({type:"DELETE",url:base_url+"api/plans/"+a,success:function(){ELM.plans_list.find("li[data-id="+a+"]").remove();for(var e=ELM.spaces_nav.find("li.selected:first a.plans").data("fetched_data"),n=0;n<e.count;n++)if(e.items[n].id==a){delete e.items[n];break}e.count=e.count-1,e.items.length=e.items.length-1,ELM.spaces_nav.find("li.selected:first a.plans").data("fetched_data",e);var i=1==e.count?_lc_words.plan:_lc_words.plans;$("#plans_total_items").text(e.count+" "+i),ELM.plans_list.children("li").length<=0&&ELM.plans_list.prepend('<li class="none ani-ran">'+_lc_words.no_plans_yet+"</li>"),ELM.plans_list.sortable("reload"),ELM.content.attr("class","plans"),show_notify({text:_lc_words.deleted_plan}),remove_button_spinner(t)},error:function(e){ajax_error(e),remove_button_spinner(t)}}))},!0),e.preventDefault()}),ELM.spaces_nav.on("click","a.payments",function(e){ELM.panel_payments.find(".search-close").trigger("click"),ELM.panel_payments.find(".search-field").removeData("prev-value"),ELM.panel_payments.find(".submenu a.payments").trigger("click")}),$(".submenu a.payments:not(.transactions)").click(function(e){var t=$(this).parents("section.panel:first"),a=t.find("div.inner:first"),n=t.find("div.pane-payments ul.item-list.payments"),i=n.parents(".panel-pane:first");n.html(""),a.addClass("loading");var s=t.find("a.load-more");if(n.is("[data-type=terminal]"))var r=0,l="terminal";else if(n.is("[data-type=members]"))var r=ELM.panel_members_item.attr("data-id"),l="member";else var r=ELM.spaces_nav.find("li.selected").attr("data-id"),l="payment";s.hide();var o=function(e,d){$.ajax({type:"GET",url:base_url+"api/payments/"+r+"?type="+l+"&start="+e,success:function(r){if($.hasData(i)){var c=i.data("fetched_data");c.push(r.items),c.count=c.count+r.items.length,i.addClass("fetched").data("fetched_data",c)}else i.addClass("fetched").data("fetched_data",r);if(r.count>0?(ELM.panel_payments.find(".search-field").removeAttr("style"),r._append=!0,payments_fillout({data:r,list_elem:n,type:l})):(s.hide(),0==e&&(ELM.panel_payments.find(".search-field").hide(),n.html('<li class="none">'+_lc_words.no_payments_yet+"</li>"))),"terminal"==l)var p=currency_symbol,m=r.terminals,u=m.today.amount,_=m.month.amount,f=m.alltime.amount,h=m.alltime.count;else if("payment"==l)var p=ELM.panel_setup.attr("data-cursym"),m=ELM.spaces_nav.find("li.selected").data("reports"),u=m.today,_=m.month,f=m.alltime,h=m.payments;d();var v=n.children("li").length;if(v<parseInt(h)&&v>19?s.show().unbind("click").click(function(e){var t=$(this);$(this).hasClass("stale")||(add_button_spinner({elem:t,color:"#384251"}),o(v,function(){remove_button_spinner(t),t.show()})),e.preventDefault()}):s.unbind("click").hide(),"terminal"==l||"payment"==l){var g=t.find("div.stats");g.find("div.stat.payments strong").html(h),g.find("div.stat.today strong").html(p+u),g.find("div.stat.month strong").html(p+_),g.find("div.stat.alltime strong").html(p+f)}a.removeClass("loading")},error:function(e){a.removeClass("loading"),ajax_error(e),d()}})};o(0,function(){}),e.preventDefault()}),$("ul.item-list.payments").on("click","li:not(.none,.member,.heading)",function(e){var t=$(this),a=t.attr("data-id"),n=t.attr("data-buyer-type")&&"me"==t.attr("data-buyer-type")?!0:!1,i=ELM.content.attr("class").replace(" new",""),s=window.devicePixelRatio>=1.2?200:100;window.devicePixelRatio>=3&&(s=400),ELM.content.find("section.panel[data-panel="+i+"]").addClass("active-sub"),ELM.panel_payments_item.addClass("loading"),ELM.panel_payments_item.find("> header a.back").attr("data-back",i),ELM.payments_item_menu.find(".refund, .ship, .cancel").hide(),ELM.panel_payments_item.find("div.form-group.shipping, div.form-group.business, div.form-group.additional, div.form-group.description").hide(),ELM.panel_payments_item.find("> header div.meta h3, > header div.meta a.email, > header dl.left dd, > header dl.right dd").html("&nbsp;"),$("#payment_refunds_list").add(ELM.payment_products_list).html(""),ELM.panel_payments_item.find("> header div.avatar img").attr("src",""),$.removeData(ELM.panel_payments_item,"fetched_data"),ELM.content.attr("class","payments-item"),$.ajax({type:"GET",url:base_url+"api/payments/"+a,success:function(e){ELM.body.animate({scrollTop:0});var t=get_currency_symbol(e.currency),i=[],r=[];ELM.panel_payments_item.data("fetched_data",e),ELM.panel_payments_item.attr("data-id",a).attr("data-cursym",t).attr("data-total",e.amount).attr("data-refunded-amount",e.refunded_amount),ELM.panel_payments_item.find("> header div.avatar img").attr("src","").attr("src","https://www.gravatar.com/avatar/"+e.customer_info.avatar+"?s="+s+"&d="+encodeURIComponent(s3_url+"media/default-avatar_"+s+".png")),ELM.panel_payments_item.find("> header div.meta h3").html(e.customer_info.name),n?(ELM.panel_payments_item.find("div.details div.right").hide(),ELM.panel_payments_item.find("> header div.meta a.email").html(e.customer_info.email).attr("href","javascript:void(0)")):(ELM.panel_payments_item.find("div.details div.right").show(),ELM.panel_payments_item.find("> header div.meta a.email").html(e.customer_info.email).attr("href","mailto:"+e.customer_info.email+"?body=Transaction ID: "+e.transaction_id));var l=e.time.split(" - ");l=l[0]+"<small>"+l[1]+"</small>",null!==e.po_id&&""!==e.po_id?(ELM.panel_payments_item.find("> header dl.date dt").html(_lc_words.pre_order_date),ELM.panel_payments_item.find("> header dl.date dd").html(e.po_time)):(ELM.panel_payments_item.find("> header dl.date dt").html(_lc_words.payment_date),ELM.panel_payments_item.find("> header dl.date dd").html(l)),ELM.panel_payments_item.find("header dl.transaction dd").html(e.transaction_id);var o="";if(void 0!==e.products&&null!==e.products)for(var d=0;d<e.products.length;d++){var c=void 0!==e.products[d].quantity&&e.products[d].quantity>1?'<div class="badge">&times;'+e.products[d].quantity+"</div>":"";o=o+"<li><h4>"+e.products[d].name+'</h4><div class="right-text full"><div class="wrap"><div class="inner">'+c+'<div class="text">'+t+e.products[d].amount_paid+"</div></div></div></div></li>"}void 0!==e.shipping_info&&null!==e.shipping_info&&void 0!==e.shipping_info.name&&(o=o+'<li class="gray"><h4><em>'+_lc_words.shipping_fee+":</em> <span>"+e.shipping_info.name+'</span></h4><div class="right-text full"><div class="wrap"><div class="inner"><div class="text">'+t+e.shipping_info.amount+"</div></div></div></div></li>"),"0"!==e.coupon_id&&0!==e.coupon_id&&(o=o+'<li class="gray"><h4><em>'+_lc_words.coupon_discount+":</em> <span>"+e.coupon_code+'</span></h4><div class="right-text full"><div class="wrap"><div class="inner"><div class="text"><em>-'+t+e.coupon_discount+"</em></div></div></div></div></li>"),"0.00"!==e.tax&&0!==e.tax&&(o=o+'<li class="gray"><h4><em>'+_lc_words.tax+'</em></h4><div class="right-text full"><div class="wrap"><div class="inner"><div class="text"><em>+'+t+e.tax+"</em></div></div></div></div></li>"),o=null!==e.po_id&&""!==e.po_id?o+'<li class="last"><span class="title">'+_lc_words.not_yet_charged+'</span><div class="total"><small>'+e.currency+"</small> <span>"+t+e.amount+"</span></div></li>":o+'<li class="last"><h4><em>'+e.cc_type+" &bull; "+e.cc_last4+'</em></h4><div class="right-text"><div class="wrap"><div class="inner"><div class="total"><small>'+e.currency+"</small><span>"+t+e.amount+"</span></div></div></div></li>",ELM.payment_products_list.html(o).data("products",JSON.stringify(e.products)),n?(ELM.panel_payments_item.find("> header a.view-stripe").hide(),ELM.panel_payments_item.find("> header div.pre-order.badge").hide()):null!==e.po_id&&""!==e.po_id?(ELM.panel_payments_item.find("> header a.view-stripe").hide(),ELM.panel_payments_item.find("> header div.pre-order.badge").show()):(ELM.panel_payments_item.find("> header div.pre-order.badge").hide(),ELM.panel_payments_item.find("> header a.view-stripe").attr("href",stripe_dashboard_url+"payments/"+e.stripe_charge_id).show());var p=ELM.panel_payments_item.find("div.form-group.shipping");if(e.customer_info.shipping_name){var m=e.customer_info.shipping_name+"<br>"+e.customer_info.shipping_address+"<br>"+e.customer_info.shipping_city+", "+e.customer_info.shipping_state+", "+e.customer_info.shipping_zip+"<br>"+e.customer_info.shipping_country;p.find("p").html(m).parent().show(),ELM.payments_item_menu.find(".ship").show(),i.push(p)}else ELM.panel_payments_item.find("div.form-group.shipping p").html("").parent().hide(),ELM.payments_item_menu.find(".ship").hide(),r.push(p);var u=ELM.panel_payments_item.find("div.form-group.billing");e.customer_info.billing_address?(u.find("p").html(e.customer_info.name+"<br>"+e.customer_info.billing_address+"<br>"+e.customer_info.billing_city+", "+e.customer_info.billing_state+", "+e.customer_info.billing_zip+"<br>"+e.customer_info.billing_country).parent().show(),i.push(u)):(ELM.panel_payments_item.find("div.form-group.billing p").html("").parent().hide(),r.push(u));var _=ELM.panel_payments_item.find("div.form-group.additional"),f=_.find("> div.inner"),h=$("#payment_refunds_list");if(null!==e.additional_info)if(void 0!==e.additional_info&&e.additional_info.length>0){for(var v="",d=0;d<e.additional_info.length;d++)""!==e.additional_info[d].value&&(v=v+'<div class="label disabled-contrast"><em>'+e.additional_info[d].name+'</em><div class="input">'+e.additional_info[d].value+"</div></div>");""!==v?(f.html(v).parents("div.form-group").show(),i.push(_)):(f.html("").parents("div.form-group").hide(),r.push(_))}else f.html("").parents("div.form-group").hide(),r.push(_);else f.html("").parents("div.form-group").hide(),r.push(_);var g=$("#payment_shipped_list"),y='<li class="none">'+_lc_words.no_shipments+"</li>",b=[];if(null!==e.shipped_products&&void 0!==e.shipped_products&&e.shipped_products.length>0){for(var E="",d=0;d<e.shipped_products.length;d++)""!==e.shipped_products[d].value&&(b.push(e.shipped_products[d].product_id),E+="<li><h4>"+e.shipped_products[d].name+"</h4><p>"+_lc_words.shipped_on+" <strong>"+e.shipped_products[d].time+"</strong> "+_lc_words.via+' <strong class="capitalize">'+e.shipped_products[d].shipping_carrier+"</strong> "+_lc_words.with_tracking_code+": <strong>"+e.shipped_products[d].shipping_tracking_code+"</strong></p></li>");""!=E&&(y=E)}e.customer_info.shipping_name?(g.html(y).parents("div.form-group").show(),ELM.payment_products_list.data("shipped_product_ids",b)):(g.html("").parents("div.form-group").hide(),$.removeData(ELM.payment_products_list,"shipped_product_ids"));var w=ELM.panel_payments_item.find("div.form-group.description");if(""!=e.description&&"terminal"==e.payment_from?(w.find("> div.inner").html("<p>"+e.description+"</p>").parent().removeAttr("style"),i.push(w)):(ELM.panel_payments_item.find("div.form-group.description > div.inner").html("").parent().hide(),r.push(w)),"YES"==e.refunded&&e.refunds.length>0){var L=e;L.cur_sym=t;var M=_get_refunds_html(L);h.html(M)}else h.html('<li class="none">'+_lc_words.no_refunds+"</li>");if(parseFloat(e.refunded_amount)+.5>=e.amount?ELM.payments_item_menu.find(".refund").hide():ELM.payments_item_menu.find(".refund").show(),null!==e.po_id&&""!==e.po_id?(ELM.payments_item_menu.find(".receipt, .refund").hide(),ELM.payments_item_menu.find(".cancel").show()):(ELM.payments_item_menu.find(".receipt").show(),ELM.payments_item_menu.find(".cancel").hide()),is_odd_number(i.length)&&i[i.length-1].addClass("full"),r.length>0)for(var d=0;d<r.length;d++)r[d].removeClass("full");ELM.panel_payments_item.removeClass("loading")},error:function(e){ELM.panel_payments_item.removeClass("loading"),ELM.panel_payments_item.find("> header a.back").trigger("click"),ajax_error(e)}}),e.preventDefault()}),ELM.payments_item_menu.on("click","a.receipt",function(e){var t=$(this);t.hasClass("stale")||confirmation("Are you sure you want to re-send the original receipt email to this customer?",function(e){if(e){add_button_spinner({elem:t,color:"#555"});var a=ELM.panel_payments_item.attr("data-id");$.ajax({type:"PUT",url:base_url+"api/payments/"+a+"/?action=resend",success:function(){show_notify({text:_lc_words.email_sent}),remove_button_spinner(t)},error:function(e){remove_button_spinner(t),ajax_error(e)}})}},!0),e.preventDefault()}),ELM.panel_payments_item.on("click","a.refund",function(e){var t=$("#modal_refund"),a=parseFloat(ELM.panel_payments_item.attr("data-total"))-parseFloat(ELM.panel_payments_item.attr("data-refunded-amount")),n=ELM.panel_payments_item.data("fetched_data");t.find("input[name=amount]").val(Math.floor(100*a)/100),t.find("span.currency strong").html(ELM.panel_payments_item.attr("data-cursym")),"YES"==n.refunded&&Number(n.refunded_amount)>=Number(n.amount)?show_notify({type:"error",text:"You've already fully refunded this payment."}):show_modal("refund"),e.preventDefault()}),$("#modal_refund a.btn.submit").click(function(e){var t=$(this),a=$("#modal_refund").find("form");if(!t.hasClass("stale")){var n=!1,i=parseFloat(ELM.panel_payments_item.attr("data-total"))-parseFloat(ELM.panel_payments_item.attr("data-refunded-amount")),s={amount:a.find("input[name=amount]").val()};if(s.amount.match(/^\d+(?:\.\d+)?$/)?100*s.amount<50?(element_display_error(a.find("input[name=amount]"),"Amount must be at least 0.50"),n=!0):100*s.amount>100*i&&(show_notify({type:"error",text:"Refunds cannot exceed the original payment total. "+ELM.panel_payments_item.attr("data-cursym")+i+" is the max you can refund."}),a.find("input[name=amount]").addClass("error").val(i),n=!0):(element_display_error(a.find("input[name=amount]"),"You must enter a valid Amount."),n=!0),!n){var r={amount:s.amount};add_button_spinner({elem:t,color:"#fff"}),$.ajax({type:"PUT",url:base_url+"api/payments/"+ELM.panel_payments_item.attr("data-id")+"/?action=refund",data:JSON.stringify(r),success:function(e){var n=ELM.panel_payments_item.attr("data-cursym");a[0].reset(),close_modal();var i=parseFloat(ELM.panel_payments_item.attr("data-refunded-amount"))+parseFloat(s.amount),r=ELM.panel_payments_item.data("fetched_data"),l=e;void 0==r.refunds&&(r.refunds=[]),r.refunds.unshift(l),r.refunded_amount=i,r.amount_after_refunds=Number(r.amount)-i,ELM.panel_payments_item.data("fetched_data",r),r.cur_sym=n;var o=_get_refunds_html(r);$("#payment_refunds_list").html(o),i>=parseFloat(ELM.panel_payments_item.attr("data-total"))&&ELM.panel_payments_item.find("a.icon-btn.refund").hide(),show_notify({text:_lc_words.payment_refunded}),remove_button_spinner(t)},error:function(e){remove_button_spinner(t),ajax_error(e)}})}}e.preventDefault()}),ELM.panel_payments_item.on("click","menu a.ship",function(e){var t=JSON.parse(ELM.payment_products_list.data("products"));ELM.modal_shipped.find("input[name=amount]").val(ELM.panel_payments_item.attr("data-total")),ELM.modal_shipped.find("span.currency strong").html(ELM.panel_payments_item.attr("data-cursym")),ELM.modal_shipped.find("form")[0].reset(),ELM.modal_shipped.find("input[name=carrier_name]").parents("label:first").removeClass("show"),ELM.modal_shipped.find("span.checks-holder").html("");for(var a=ELM.payment_products_list.data("shipped_product_ids"),n=0,i=0;i<t.length;i++)$.inArray(t[i].id,a)<0&&(ELM.modal_shipped.find("span.checks-holder").append('<label><input type="checkbox" name="products[]" value="'+t[i].id+'"> '+t[i].name+"</label>"),n++);n>0?show_modal("shipped"):show_notify({type:"error",text:"You've already shipped all items."}),e.preventDefault()}),ELM.modal_shipped.find("a.btn.submit").click(function(e){var t=$(this),a=ELM.modal_shipped.find("form");if(!t.hasClass("stale")){var n=!1,i={shipped_on:a.find("input[name=shipped_on]").val(),carrier:a.find("select[name=carrier] option:selected").val(),tracking_code:a.find("input[name=tracking_code]").val(),carrier_name:a.find("input[name=carrier_name]").val()},s={shipped_on:i.shipped_on,carrier:i.carrier,tracking_code:i.tracking_code,"products[]":[]},r=!1;a.find("span.checks-holder input:checked").each(function(){s["products[]"].push($(this).val()),r=!0}),r?a.find("input[name=carrier_name]:visible").parent().hasClass("show")&&""==i.carrier_name?(element_display_error(a.find("input[name=carrier_name]"),"You must enter a Carrier Name"),n=!0):""==i.tracking_code?(element_display_error(a.find("input[name=tracking_code]"),"Please enter an Tracking Code"),n=!0):validate_date(i.shipped_on)||(element_display_error(a.find("input[name=shipped_on]"),"You must enter a valid Shipped Date"),n=!0):(show_notify({type:"error",text:"You must select at least 1 product"}),n=!0),n||(a.find("input[name=carrier_name]:visible").length>0&&(s.carrier_name=i.carrier_name),add_button_spinner({elem:t,color:"#fff"}),$.ajax({type:"PUT",url:base_url+"api/payments/"+ELM.panel_payments_item.attr("data-id")+"/?action=shipped",data:JSON.stringify(s),success:function(e){a[0].reset(),close_modal(),show_notify({text:_lc_words.notification_sent}),remove_button_spinner(t)},error:function(e){remove_button_spinner(t),ajax_error(e)}}))}e.preventDefault()}),ELM.modal_shipped.on("change","select[name=carrier]",function(){var e=ELM.modal_shipped.find("input[name=carrier_name]").parents("label:first");return""===$(this).children("option:selected").val()?e.addClass("show"):e.removeClass("show"),!1}),ELM.payments_item_menu.on("click","a.cancel",function(e){var t=$(this);t.hasClass("stale")||confirmation("Are you sure you want to permanently cancel this Pre-Order? The customer's card will not be charged and they will will be notified of this cancellation via email.",function(e){if(e){add_button_spinner({elem:t,color:"#555"});var a=ELM.panel_payments_item.attr("data-id");$.ajax({type:"DELETE",url:base_url+"api/pre_orders/"+a,success:function(){show_notify({text:_lc_words.pre_order_deleted}),ELM.recent_list.add(ELM.payments_list).children("li[data-id="+a+"]").remove(),ELM.panel_payments_item.find("header a.back").click(),remove_button_spinner(t)},error:function(e){remove_button_spinner(t),ajax_error(e)}})}},!0),e.preventDefault()}),ELM.body.on("payments_fillout",function(e,t){var a=t._type,n=t._par_panel,i=t._par_panel.find(".item-list:first");if(delete t._type,delete t._par_panel,void 0!=t&&void 0==t._is_close)var s=t;else{var s=n.data("fetched_data");s._fetched=!0,delete s._append}delete s._is_close,n.find("a.load-more").hide(),payments_fillout({data:s,list_elem:i,type:a})}),ELM.spaces_nav.on("click","a.members",function(e){if(!$(this).hasClass("selected")){ELM.panel_members.find(".search-close").trigger("click"),ELM.panel_members.find(".search-field").removeData("prev-value");var t=ELM.members_list.parents(".panel-pane:first");ELM.panel_members.find(".submenu a.members").trigger("click"),ELM.members_list.html(""),ELM.panel_members.addClass("loading");var a=ELM.panel_members.find("a.load-more"),n=ELM.spaces_nav.find("li.selected").attr("data-id");a.hide();var i=function(e,s){$.ajax({type:"GET",url:base_url+"api/members/?space="+n+"&start="+e,success:function(e){if($.hasData(t)){var n=t.data("fetched_data");n.push(e.items),n.count=n.count+e.items.length,t.addClass("fetched").data("fetched_data",n)}else t.addClass("fetched").data("fetched_data",e);var r=ELM.panel_setup.attr("data-cursym");e._append=!0,members_fillout(e),s();var l=ELM.members_list.children("li").length,o=e.reports.members;l<parseInt(o)&&l>19?a.show().unbind("click").click(function(e){var t=$(this);$(this).hasClass("stale")||(add_button_spinner({elem:t,color:"#384251"}),i(l,function(){remove_button_spinner(t),t.show()})),e.preventDefault()}):a.unbind("click").hide();var d=ELM.panel_members.find("div.stats");d.find("div.stat.members strong").html(o),d.find("div.stat.today strong").html(r+e.reports.today),d.find("div.stat.month strong").html(r+e.reports.month),d.find("div.stat.alltime strong").html(r+e.reports.alltime),ELM.members_plans_list.html("");var c="";if(!$.isEmptyObject(e.plans))for(plan in e.plans)if(e.plans[plan].active===!0){var p=1==e.plans[plan]?"Member":"Members";c+='<li data-id="'+plan+'"><h4>'+e.plans[plan].name+'</h4><div class="right-text full"><div class="wrap"><div class="inner"><div class="text">'+e.reports.plans[plan]+" "+p+"</div></div></div></div></li>"
}""==c?ELM.members_plans_list.parents(".form-group").hide():ELM.members_plans_list.html(c).parents(".form-group").removeAttr("style"),ELM.panel_members.removeClass("loading")},error:function(e){s(),ELM.panel_members.removeClass("loading"),ajax_error(e)}})};i(0,function(){})}e.preventDefault()}),$("ul.item-list.members").on("click","li:not(.none,.payment,.heading)",function(e){var t=$(this),a=t.attr("data-id"),n=ELM.content.attr("class").replace(" new",""),i=window.devicePixelRatio>=1.2?200:100;window.devicePixelRatio>=3&&(i=400),ELM.content.find("section.panel[data-panel="+n+"]").addClass("active-sub"),ELM.panel_members_item.find(".submenu a.details").trigger("click"),ELM.panel_members_item.addClass("loading"),ELM.panel_members_item.find("> header a.back").attr("data-back",n),ELM.panel_members_item.find("> header div.meta h3, > header div.meta a.email, > header dl.left dd, > header dl.right dd").html("&nbsp;"),$("#payment_refunds_list").add(ELM.payment_products_list).html(""),ELM.panel_members_item.find("> header div.avatar img").attr("src",""),ELM.panel_members_item.find("div.form-group > header menu a").removeAttr("style"),ELM.content.attr("class","members-item"),$.ajax({type:"GET",url:base_url+"api/members/"+a,success:function(e){ELM.body.animate({scrollTop:0});var t=ELM.spaces_nav.find("li[data-id="+e.space_id+"]").attr("data-cursym"),n=void 0!==e.shipping_info&&""!=e.shipping_info?!0:!1,s=void 0!==e.additional_info&&e.additional_info.length>0?!0:!1;ELM.panel_members_item.attr("data-id",a),ELM.panel_members_item.find("> header div.avatar img").attr("src","https://www.gravatar.com/avatar/"+e.avatar+"?s="+i+"&d="+encodeURIComponent(s3_url+"media/default-avatar_"+i+".png")),ELM.panel_members_item.find("> header div.meta h3").html(e.name),ELM.panel_members_item.find("> header div.meta a.email").html(e.email).attr("href","mailto:"+e.email),ELM.panel_members_item.find("> header dl.plan dd").html(e.plan_name),ELM.panel_members_item.find("> header dl.paid dd").html(t+e.payments_total),ELM.panel_members_item.find("div.grids div.date p").html(e.time),ELM.panel_members_item.find("div.grids div.status p").html(e.status);var r=ELM.panel_members_item.find("div.grids div.deleted"),l=ELM.panel_members_item.find("div.grids div.card");"deleted"==e.status?(r.parent().removeClass("hidden"),r.find("p").html(e.deleted_on),l.parent().addClass("hidden"),ELM.panel_members_item.find("footer.footer").addClass("hidden")):(l.parent().removeClass("hidden"),l.find("p").html(e.cc_type+" &bull; "+e.cc_last4),r.parent().addClass("hidden"),ELM.panel_members_item.find("footer.footer").removeClass("hidden")),ELM.panel_members_item.find("> header a.view-stripe").attr("href",stripe_dashboard_url+"customers/"+e.stripe_customer_id);var o=ELM.panel_members_item.find("div.form-group.shipping"),d=ELM.panel_members_item.find("div.form-group.additional");if(n){if(void 0!=_countries[e.shipping_info.shipping_country])var c='<label class="half right disabled-contrast"><em>'+_lc_words.country+'</em><select name="country" disabled="disabled">'+_countries_opts+"</select></label></form>";else var c='<label class="half right disabled-contrast"><em>'+_lc_words.country+'</em><input type="text" name="country" value="'+e.shipping_info.shipping_country+'" disabled="disabled"></label></form>';var p='<form><label class="disabled-contrast"><em>'+_lc_words.name+'</em><input type="text" name="name" value="'+e.shipping_info.shipping_name+'" disabled="disabled"></label><label class="disabled-contrast"><em>'+_lc_words.street_address+'</em><input type="text" name="address" value="'+e.shipping_info.shipping_address+'" disabled="disabled"></label><label class="half left disabled-contrast"><em>'+_lc_words.city+'</em><input type="text" name="city" value="'+e.shipping_info.shipping_city+'" disabled="disabled"></label><label class="half right disabled-contrast"><em>'+_lc_words.state_province+'</em><input type="text" name="state" value="'+e.shipping_info.shipping_state+'" disabled="disabled"></label><label class="half left disabled-contrast"><em>'+_lc_words.zip_postal_code+'</em><input type="text" name="zip" value="'+e.shipping_info.shipping_zip+'" disabled="disabled"></label>'+c;s?o.removeClass("full"):o.addClass("full"),o.show().find(".inner").html(p),void 0!=_countries[e.shipping_info.shipping_country]&&(o.find("select[name=country]")[0].value=e.shipping_info.shipping_country)}else o.hide().find(".inner").html("");if(s){for(var m="<form>",u=0;u<e.additional_info.length;u++){var _=e.additional_info[u];if(""!==_.value){var f="yes"==_.required?"required":"";text_type="text","numbers"==_.type?text_type="number":"email"==_.type&&(text_type="email");var h="textarea"==_.type?'<textarea data-id="'+_.id+'" data-type="'+_.type+'" disabled="disabled" '+f+">"+_.value+"</textarea>":'<input type="'+text_type+'" data-id="'+_.id+'" data-type="'+_.type+'" value="'+_.value+'" disabled="disabled" '+f+">";m+='<label class="disabled-contrast"><em>'+_.name+"</em>"+h+"</label>"}}m+="</form>",n?d.removeClass("full"):d.addClass("full"),d.show().find(".inner").html(m),d.find("input[type=number]").payment("restrictNumeric")}else d.hide().find(".inner").html("");ELM.panel_members_item.find(".pane-payments > header h3").html(void 0!==e.payments&&e.payments.length>0?e.payments_count+" <em>"+_lc_words.payments_totaling+"</em> "+t+e.payments_total+"</em>":"0 <em>"+_lc_words.payments+"</em>"),"suspended"==e.status?$("#suspend_member").addClass("activate").text(_lc_words.activate):$("#suspend_member").removeClass("activate").text(_lc_words.suspend),ELM.panel_members_item.removeClass("loading")},error:function(e){ELM.panel_members_item.removeClass("loading"),ELM.panel_payments_item.find("> header a.back").trigger("click"),ajax_error(e)}}),e.preventDefault()}),$("#delete_member").click(function(){var e=$(this);return e.hasClass("stale")||confirmation("Are you sure you want to permanently Delete this member?",function(t){if(t){add_button_spinner({elem:e,color:"#555"});var a=ELM.panel_members_item.attr("data-id");$.ajax({type:"DELETE",url:base_url+"api/members/"+a,success:function(){show_notify({text:_lc_words.member_deleted}),remove_button_spinner(e),ELM.panel_members_item.find("header a.back").click()},error:function(t){remove_button_spinner(e),ajax_error(t)}})}},!0),!1}),$("#suspend_member").click(function(){var e=$(this);if(e.hasClass("activate"))var t="Are you sure you want to Activate this member?",a={status:"active"},n=_lc_words.activated;else var t="Are you sure you want to Suspend this member?",a={status:"suspended"},n=_lc_words.suspended;return e.hasClass("stale")||confirmation(t,function(t){if(t){add_button_spinner({elem:e,color:"#555"});var i=ELM.panel_members_item.attr("data-id");$.ajax({type:"PUT",url:base_url+"api/members/"+i,data:JSON.stringify(a),success:function(){show_notify({text:_lc_words.member+" "+n}),e.removeAttr("style").removeClass("stale"),"active"==a.status?(e.removeClass("activate").text(_lc_words.suspend),ELM.panel_members_item.find("div.grids div.status p").text(_lc_words.active)):(e.addClass("activate").text(_lc_words.activate),ELM.panel_members_item.find("div.grids div.status p").text(_lc_words.suspended))},error:function(t){remove_button_spinner(e),ajax_error(t)}})}},!0),!1}),$("#members_shipping_edit, #members_additional_edit").click(function(e){e.preventDefault();var t=$(this).parents(".form-group:first");t.find("label").removeClass("disabled-contrast"),t.find("label input, label select, label textarea").removeAttr("disabled"),t.find("label:first").focus(),$(this).hide(),$(this).siblings(".save").show()}),$("#members_shipping_save").click(function(e){e.preventDefault();var t=$(this),a=t.parents(".form-group:first").find("form");if(!t.hasClass("stale")){var n=!1,i={name:a.find("input[name=name]").val(),address:a.find("input[name=address]").val(),city:a.find("input[name=city]").val(),state:a.find("input[name=state]").val(),zip:a.find("input[name=zip]").val()};if(i.country=a.find("input[name=country]").length>0?a.find("input[name=country]").val():a.find("select[name=country] option:selected").val(),""==i.name?(element_display_error(a.find("input[name=name]"),"You must enter a Name."),n=!0):""==i.address?(element_display_error(a.find("input[name=address]"),"You must enter an Address."),n=!0):""==i.city?(element_display_error(a.find("input[name=city]"),"You must enter a City."),n=!0):""==i.state?(element_display_error(a.find("input[name=state]"),"You must enter a State."),n=!0):""==i.zip&&(element_display_error(a.find("input[name=zip]"),"You must enter a Zip / Postal Code."),n=!0),!n){add_button_spinner({elem:t,color:"#555"});var s={name:i.name,address:i.address,city:i.city,state:i.state,zip:i.zip,country:i.country};$.ajax({type:"PUT",url:base_url+"api/members/"+ELM.panel_members_item.attr("data-id")+"?action=shipping",data:JSON.stringify(s),success:function(){a.find("label").addClass("disabled-contrast"),a.find("label input, label select, label textarea").attr("disabled","disabled"),$("#members_shipping_edit").add(t).removeAttr("style").removeClass("stale"),show_notify({text:_lc_words.saved})},error:function(e){remove_button_spinner(t),ajax_error(e)}})}}}),$("#members_additional_save").click(function(e){e.preventDefault();var t=$(this),a=t.parents(".form-group:first").find("form");if(!t.hasClass("stale")){var n=!1,i={},s={};a.find("label").each(function(){var e=$(this).find("[data-id]");i[e.attr("data-id")]={value:e.val(),id:e.attr("data-id"),type:e.attr("data-type"),required:e.is("[required]")?!0:!1},s[e.attr("data-id")]=e.val()});for(var r in i)i[r].required&&""==i[r].value&&(element_display_error(a.find("[data-id="+r+"]"),"Cannot be empty."),n=!0);n||(add_button_spinner({elem:t,color:"#555"}),$.ajax({type:"PUT",url:base_url+"api/members/"+ELM.panel_members_item.attr("data-id")+"?action=data",data:JSON.stringify(s),success:function(){a.find("label").addClass("disabled-contrast"),a.find("label input, label select, label textarea").attr("disabled","disabled"),$("#members_additional_edit").add(t).removeAttr("style").removeClass("stale"),show_notify({text:_lc_words.saved})},error:function(e){remove_button_spinner(t),ajax_error(e)}}))}}),ELM.body.on("members_fillout",function(e,t){if(void 0!=t&&void 0==t._is_close)var a=t;else{var a=ELM.members_list.parents(".panel-pane:first").data("fetched_data");a._fetched=!0,delete a._append}delete a._is_close,ELM.panel_members.find("a.load-more").hide(),members_fillout(a)}),ELM.nav_invoices.click(function(e){var t=$(this);t.hasClass("selected")&&void 0==e.isTrigger||(ELM.panel_invoices.addClass("loading"),$.ajax({type:"GET",url:base_url+"api/invoices/",success:function(e){t.addClass("fetched");var a=1==e.count?_lc_words.invoice:_lc_words.invoices;if($("#invoices_total_items").text(e.count+" "+a),e.count>0){for(var n=[],i=0;i<e.count;i++){var s=e.items[i],r=get_currency_symbol(s.charge_currency),l="YES"==s.paid?'<div class="badge green">'+_lc_words.paid+"</div>":'<div class="badge red">'+_lc_words.unpaid+"</div>",o=$('<li data-id="'+s.id+'" class="ani"><h4>'+s.name+'</h4><div class="arrow"></div><div class="right-text full"><div class="wrap"><div class="inner">'+l+'<div class="text">'+r+s.amount+"</div></div></div></div></li>");n.push(o)}ELM.invoices_list.html(n),animation_setup({elem:ELM.invoices_list,delay:50,do_filter:!0})}else ELM.invoices_list.html('<li class="none">'+_lc_words.no_invoices_yet+"</li>");ELM.panel_invoices.removeClass("loading")},error:function(e){ELM.panel_invoices.removeClass("loading"),ajax_error(e)}})),e.preventDefault()}),ELM.panel_invoices.find("header a.add").click(function(e){var t=ELM.panel_invoices_item.find("form");t[0].reset(),t.find("input,textarea,select").removeAttr("disabled","disabled"),t.removeClass("disabled-contrast"),t.find("textarea").html(""),t.find("footer a.resend, footer .right").addClass("hidden"),t.find("footer a.submit").removeClass("hidden"),t.find(".charges header .right").html("").addClass("hidden"),ELM.panel_invoices_item.find(".inner > header .right").addClass("hidden"),ELM.panel_invoices_item.removeAttr("data-id"),remove_display_errors(ELM.panel_invoices_item),ELM.content.attr("class","invoices_item new"),ELM.invoice_charges_list.parents(".form-group:first").find("> header a.add").removeAttr("style"),ELM.invoice_charges_list.html('<li class="split-input"><input type="text" class="name" placeholder="'+_lc_words.charge_name+'" title="'+_lc_words.charge_name+'"><span class="currency"><strong>'+currency_symbol+' </strong><input type="text" class="amount price" value="100.00" placeholder="100.00" min="1" title="'+_lc_words.charge_amount+'"></span><a href="" class="icon delete push" title="'+_lc_words["delete"]+'">✕</a></li>'),ELM.invoice_charges_list.find("input.price").payment("restrictPrice"),ELM.panel_invoices_item.find(".inner > header .badge").html(_lc_words.new_invoice).addClass("green").removeClass("hidden red"),e.preventDefault()}),ELM.invoices_list.on("click","li:not(.none)",function(e){var t=ELM.panel_invoices_item.find("form"),a=$(this).attr("data-id"),n=ELM.content.attr("class").replace(" new","");ELM.content.find("section.panel[data-panel="+n+"]").addClass("active-sub"),t[0].reset(),t.find("input,textarea,select").removeClass("error").attr("disabled","disabled"),t.addClass("disabled-contrast"),ELM.panel_invoices.addClass("loading"),ELM.panel_invoices_item.find(".inner > header .badge").html("").addClass("hidden").removeClass("green red"),t.find("footer a.submit").addClass("hidden"),ELM.invoice_charges_list.parents(".form-group:first").find("> header a.add").hide(),$.ajax({type:"GET",url:base_url+"api/invoices/"+a,success:function(e){ELM.panel_invoices.removeClass("loading"),ELM.panel_invoices_item.attr("data-id",a),ELM.content.attr("class","invoices_item"),ELM.body.animate({scrollTop:0}),t.find("input[name=name]").val(e.name),t.find("input[name=email]").val(e.email),t.find("input[name=address]").val(e.address),t.find("input[name=city]").val(e.city),t.find("input[name=state]").val(e.state),t.find("input[name=zip]").val(e.zip),t.find("input[name=country]").val(e.country),t.find("textarea[name=note]").html(e.note),t.find("select[name=charge_currency]").length>0&&(t.find("select[name=charge_currency]")[0].value=e.charge_currency);var n=get_currency_symbol(e.charge_currency),i="";if(""!=e.charges){e.charges=$.parseJSON(e.charges);for(c in e.charges)i+='<li class="split-input"><input type="text" class="name inline" title="'+_lc_words.charge_name+'" value="'+e.charges[c].name+'" disabled="disabled"><span class="currency"><strong>'+n+' </strong><input type="text" class="amount price" value="'+e.charges[c].amount+'" min="1" title="'+_lc_words.charge_amount+'" disabled="disabled"></span></li>'}ELM.invoice_charges_list.html(i),ELM.invoice_charges_list.find("input.price").payment("restrictPrice"),ELM.panel_invoices_item.find(".inner > header a.btn.right").attr("href",base_url+"i/"+e.url_name).removeClass("hidden"),t.find(".charges header .right").html(n+e.amount).removeClass("hidden"),"YES"==e.paid?(ELM.panel_invoices_item.find(".inner > header .badge").html(_lc_words.paid).addClass("green").removeClass("hidden red"),t.find("footer .right").html(_lc_words.paid_on+" <strong>"+e.paid_on+"</strong>").removeClass("hidden"),t.find("footer a.delete, footer a.resend").addClass("hidden")):(ELM.panel_invoices_item.find(".inner > header .badge").html(_lc_words.unpaid).addClass("red").removeClass("hidden green"),t.find("footer .right").html("").addClass("hidden"),t.find("footer a.delete, footer a.resend").removeClass("hidden"))},error:function(e){ELM.panel_invoices.removeClass("loading"),ajax_error(e)}}),e.preventDefault()}),ELM.panel_invoices_item.find("a.btn.submit").click(function(e){var t=$(this),a=ELM.panel_invoices_item.find("form");if(!t.hasClass("stale")){remove_display_errors(ELM.panel_invoices_item);var n=!1,i={name:a.find("input[name=name]").val(),email:a.find("input[name=email]").val(),address:a.find("input[name=address]").val(),city:a.find("input[name=city]").val(),state:a.find("input[name=state]").val(),zip:a.find("input[name=zip]").val(),country:a.find("input[name=country]").val(),note:a.find("textarea[name=note]").val()};i.currency=a.find("select[name=charge_currency]").length>0?a.find("select[name=charge_currency] option:selected").val():user.default_currency,""==i.name?(element_display_error(a.find("input[name=name]"),"Please enter an Invoicee Name"),n=!0):email_check(i.email)?(""!=i.address||""!=i.city||""!=i.state||""!=i.zip||""!=i.country)&&(""==i.address?(element_display_error(a.find("input[name=address]"),"Please enter an Address"),n=!0):""==i.city?(element_display_error(a.find("input[name=city]"),"Please enter a City"),n=!0):""==i.state?(element_display_error(a.find("input[name=state]"),"Please enter a State / Province"),n=!0):""==i.zip?(element_display_error(a.find("input[name=zip]"),"Please enter a ZIP / Postal Code"),n=!0):""==i.country&&(element_display_error(a.find("input[name=country]"),"Please enter a Country"),n=!0)):(element_display_error(a.find("input[name=email]"),"Please enter a valid Email"),n=!0);var s=[],r=ELM.invoice_charges_list.children("li:not(.none)");if(r.length<=0&&(show_notify({type:"error",text:"You must add some Charges"}),n=!0),n||r.each(function(){return""==$(this).find("input.name").val()?(element_display_error($(this).find("input.name"),"Enter a Charge Name",!1),void(n=!0)):""==$(this).find("input.amount").val()||$(this).find("input.amount").val()<=0?(element_display_error($(this).find("input.amount"),"Enter a Charge Amount",!1),void(n=!0)):void s.push({name:$(this).find("input.name").val(),amount:$(this).find("input.amount").val()})}),!n){var l={name:i.name,email:i.email,address:i.address,city:i.city,state:i.state,zip:i.zip,country:i.country,charges:s,currency:i.currency,note:i.note};add_button_spinner({elem:t,color:"#fff"}),$.ajax({type:"POST",url:base_url+"api/invoices/",data:JSON.stringify(l),success:function(e){remove_button_spinner(t),ELM.nav_invoices.removeClass("selected").trigger("click"),show_notify({text:_lc_words.invoice_sent}),a[0].reset()},error:function(e){remove_button_spinner(t),ajax_error(e)}})}}e.preventDefault()}),ELM.panel_invoices_item.on("click","footer a.btn.resend",function(e){var t=$(this);t.hasClass("stale")||confirmation("Are you sure you want to re-send the this invoice?",function(e){if(e){add_button_spinner({elem:t,color:"#555"});var a=ELM.panel_invoices_item.attr("data-id");$.ajax({type:"PUT",url:base_url+"api/invoices/"+a+"/?action=resend",success:function(){show_notify({text:_lc_words.invoice_re_sent}),remove_button_spinner(t)},error:function(e){remove_button_spinner(t),ajax_error(e)}})}},!0),e.preventDefault()}),ELM.invoice_charges_list.parents(".form-group:first").find("> header a.add").click(function(){var e=ELM.invoice_charges_list.children("li").length,t=ELM.panel_invoices_item.find("select[name=charge_currency]"),a=t.length>0?get_currency_symbol(t.val()):currency_symbol;return height_class=e-1>0?"no-height":"",elem=$('<li class="split-input invisible '+height_class+'"><input type="text" class="name" placeholder="'+_lc_words.charge_name+'" title="'+_lc_words.charge_name+'"><span class="currency"><strong>'+a+' </strong><input type="text" class="amount price" value="100.00" placeholder="100.00" min="1" title="'+_lc_words.charge_amount+'"></span><a href="" class="icon delete push" title="'+_lc_words["delete"]+'">✕</a></li>'),ELM.invoice_charges_list.children("li.none").remove(),ELM.invoice_charges_list.prepend(elem),ELM.invoice_charges_list.find("input.price").payment("restrictPrice"),e-1>0?(window.setTimeout(function(){elem.removeClass("no-height")},5),window.setTimeout(function(){elem.removeClass("invisible")},220)):window.setTimeout(function(){elem.removeClass("invisible")},5),!1}),ELM.invoice_charges_list.on("click","a.delete",function(){var e=$(this),t=e.parents("li"),a=ELM.invoice_charges_list.children("li").length;return t.addClass("invisible"),a-1>0?(window.setTimeout(function(){t.addClass("no-height")},200),window.setTimeout(function(){t.remove()},500)):window.setTimeout(function(){ELM.invoice_charges_list.html('<li class="none">'+_lc_words.none+"</li>")},200),!1}),ELM.panel_invoices_item.on("change","select[name=charge_currency]",function(){return ELM.invoice_charges_list.find("span.currency strong").html(get_currency_symbol($(this).val())),!1}),ELM.panel_invoices_item.find("a.btn.delete").click(function(e){var t=$(this);confirmation("Are you sure you want to Delete this Invoice?",function(e){e&&$.ajax({type:"DELETE",url:base_url+"api/invoices/"+ELM.panel_invoices_item.attr("data-id"),success:function(){ELM.nav_invoices.removeClass("selected").click(),show_notify({text:_lc_words.deleted_invoice})},error:function(e){ajax_error(e)}})},!0),e.preventDefault()}),ELM.nav_coupons.click(function(e){var t=$(this);(!t.hasClass("selected")&&!t.hasClass("fetched")||void 0!=e.isTrigger)&&(ELM.panel_coupons.addClass("loading"),$.ajax({type:"GET",url:base_url+"api/coupons/",success:function(e){t.addClass("fetched");var a=1==e.count?_lc_words.coupon:_lc_words.coupons;if($("#coupons_total_items").text(e.count+" "+a),e.count>0){for(var n=[],i=0;i<e.count;i++){var s=e.items[i],r="fixed"==s.type?currency_symbol+s.amount:s.amount+"%",l="NO"==s.enabled?'<div class="badge">'+_lc_words.disabled+"</div>":"";redemptions=""!=s.redemption_limit?"<span>"+s.redemptions+"</span> "+_lc_words.of.toLowerCase()+" "+s.redemption_limit+" "+_lc_words.redeemed:"<span>"+s.redemptions+"</span> "+_lc_words.redeemed,li=$('<li data-id="'+s.id+'" class="ani"><h4 class="inline">'+s.code+'</h4><div class="left-text">'+r+" "+_lc_words.off+'</div><div class="arrow"></div><div class="right-text full"><div class="wrap"><div class="inner">'+l+'<div class="text">'+redemptions+"</div></div></div></div></li>"),n.push(li)}ELM.coupons_list.html(n),animation_setup({elem:ELM.coupons_list,delay:50,do_filter:!0})}else ELM.coupons_list.html('<li class="none">'+_lc_words.no_coupons_yet+"</li>");ELM.panel_coupons.removeClass("loading")},error:function(e){ELM.panel_coupons.removeClass("loading"),ajax_error(e)}})),e.preventDefault()}),ELM.panel_coupons.find("header a.add").click(function(e){ELM.panel_coupons_item.find("form")[0].reset(),ELM.panel_coupons_item.find("form").removeClass("disabled-contrast"),ELM.panel_coupons_item.find("header .right.badge").html(_lc_words.new_coupon).addClass("green"),ELM.panel_coupons_item.find("form input, form select").removeAttr("disabled"),ELM.panel_coupons_item.find("form input[name=enabled]").attr("checked","checked"),$("#coupons_redeemed_amount").html("").hide(),remove_display_errors(ELM.panel_coupons_item),ELM.panel_coupons_item.removeAttr("data-id"),ELM.content.attr("class","coupons_item new"),e.preventDefault()}),ELM.coupons_list.on("click","li:not(.none)",function(e){var t=ELM.panel_coupons_item.find("form"),a=$(this).attr("data-id"),n=ELM.content.attr("class").replace(" new","");remove_display_errors(ELM.panel_coupons_item),ELM.content.find("section.panel[data-panel="+n+"]").addClass("active-sub"),t[0].reset(),$("#coupons_redeemed_amount").removeAttr("style"),t.find("input,textarea").removeClass("error"),ELM.panel_coupons.addClass("loading"),$.ajax({type:"GET",url:base_url+"api/coupons/"+a,success:function(e){e=e.items[0],ELM.panel_coupons.removeClass("loading"),ELM.panel_coupons_item.attr("data-id",a),ELM.content.attr("class","coupons_item"),ELM.panel_coupons_item.find("header .right.badge").html(e.time).removeClass("green");var n=""!=e.redemption_limit?e.redemptions+" "+_lc_words.of.toLowerCase()+" "+e.redemption_limit+" "+_lc_words.redeemed:e.redemptions+" "+_lc_words.redeemed;ELM.coupons_list.find("li[data-id="+a+"] .right-text .text span").html(e.redemptions),$("#coupons_redeemed_amount").html(n),t.find("input[name=code]").val(e.code).attr("disabled","disabled"),t.find("input[name=amount]").val(e.amount).attr("disabled","disabled"),t.find("input[name=redemption_limit]").val(e.redemption_limit).attr("disabled","disabled"),t.find("input[name=ending_date]").val(e.ending_date).attr("disabled","disabled"),t.find("select[name=type]")[0].value=e.type,t.find("select[name=type]").attr("disabled","disabled"),"YES"==e.enabled?t.find("input[name=enabled]").attr("checked","checked"):t.find("input[name=enabled]").removeAttr("checked")},error:function(e){ELM.panel_coupons.removeClass("loading"),ajax_error(e)}}),e.preventDefault()}),ELM.panel_coupons_item.find("a.btn.submit").click(function(e){var t=$(this),a=ELM.panel_coupons_item.find("form");if(!t.hasClass("stale")){remove_display_errors(ELM.panel_coupons_item);var n=!1,i={code:a.find("input[name=code]").val(),type:a.find("select[name=type] option:selected").val(),amount:a.find("input[name=amount]").val(),redemption_limit:a.find("input[name=redemption_limit]").val(),ending_date:a.find("input[name=ending_date]").val(),enabled:a.find("input[name=enabled]:checked").length>0?"YES":"NO"};if(""!=i.code&&/^[a-zA-Z0-9-]+$/.test(i.code)?i.code.length<6?(element_display_error(a.find("input[name=code]"),"The Discount Code must be at least 6 characters."),n=!0):"fixed"!=i.type||i.amount.match(/^\d+(?:\.\d+)?$/)?"fixed"==i.type&&100*i.amount<50?(element_display_error(a.find("input[name=amount]"),"Amount must be at least 0.50"),n=!0):"percent"!=i.type||i.amount.match(/^\d+(?:\.\d+)?$/)?"percent"==i.type&&100*i.amount/100>100?(element_display_error(a.find("input[name=amount]"),"Amount must not be greater than 100%."),n=!0):""==i.redemption_limit||i.redemption_limit.match(/^\d+$/)?""==i.ending_date||validate_date(i.ending_date)||(element_display_error(a.find("input[name=ending_date]"),"You must enter a valid End Date."),n=!0):(element_display_error(a.find("input[name=redemption_limit]"),"Redemption Limit must be a number."),n=!0):(element_display_error(a.find("input[name=amount]"),"Amount must be a number."),n=!0):(element_display_error(a.find("input[name=amount]"),"You must enter a valid Amount."),n=!0):(element_display_error(a.find("input[name=code]"),"Please enter a valid Coupon Code. Lettes, numbers and dashes only."),n=!0),!n){var s=void 0!==ELM.panel_coupons_item.attr("data-id")?"PUT":"POST";if(add_button_spinner({elem:t,color:"#fff"}),"PUT"==s)var r=ELM.panel_coupons_item.attr("data-id"),l={enabled:i.enabled};else var r="",l={code:i.code,type:i.type,amount:i.amount,redemption_limit:i.redemption_limit,ending_date:i.ending_date,enabled:i.enabled};$.ajax({type:s,url:base_url+"api/coupons/"+r,data:JSON.stringify(l),success:function(e){remove_button_spinner(t),ELM.nav_coupons.removeClass("selected").trigger("click"),show_notify({text:"Saved Coupon"})},error:function(e){remove_button_spinner(t),ajax_error(e)}})}}e.preventDefault()}),ELM.panel_coupons_item.find("a.btn.delete").click(function(e){var t=$(this);confirmation("Are you sure you want to Delete this Coupon?",function(e){e&&$.ajax({type:"DELETE",url:base_url+"api/coupons/"+ELM.panel_coupons_item.attr("data-id"),success:function(){ELM.nav_coupons.removeClass("selected").trigger("click"),show_notify({text:_lc_words.deleted_coupon})},error:function(e){ajax_error(e)}})},!0),e.preventDefault()}),ELM.spaces_nav.children("li:not(.none)").length>0?ELM.nav_dashboard.trigger("click"):ELM.nav_account.trigger("click");var sort_handler_timeout=!1,sort_handler=function(e){sort_handler_timeout&&window.clearTimeout(sort_handler_timeout),sort_handler_timeout=window.setTimeout(function(){var t=[],a=void 0!==e.id?e.id:ELM.spaces_nav.find("li.selected").attr("data-id");e.elem.children("li").each(function(){null!=$(this).attr("data-id")&&void 0!=$(this).attr("data-id")&&t.push($(this).attr("data-id"))}),$.ajax({type:"PUT",url:base_url+"api/"+e.path+"/"+a+"?action=sort",data:JSON.stringify({items:t,space_id:a}),success:function(t){void 0!==e.callback&&e.callback(t)},error:function(e){}})},e.time)},animation_object={};base64={},base64.PADCHAR="=",base64.ALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",base64.getbyte64=function(e,t){var a=base64.ALPHA.indexOf(e.charAt(t));if(-1==a)throw"Cannot decode base64";return a},base64.decode=function(e){e=""+e;var t=base64.getbyte64,a,n,i,s=e.length;if(0==s)return e;if(s%4!=0)throw"Cannot decode base64";a=0,e.charAt(s-1)==base64.PADCHAR&&(a=1,e.charAt(s-2)==base64.PADCHAR&&(a=2),s-=4);var r=[];for(n=0;s>n;n+=4)i=t(e,n)<<18|t(e,n+1)<<12|t(e,n+2)<<6|t(e,n+3),r.push(String.fromCharCode(i>>16,i>>8&255,255&i));switch(a){case 1:i=t(e,n)<<18|t(e,n+1)<<12|t(e,n+2)<<6,r.push(String.fromCharCode(i>>16,i>>8&255));break;case 2:i=t(e,n)<<18|t(e,n+1)<<12,r.push(String.fromCharCode(i>>16))}return r.join("")},base64.getbyte=function(e,t){var a=e.charCodeAt(t);return 255>a?a:void 0},base64.encode=function(e){if(1!=arguments.length)throw"SyntaxError: Not enough arguments";var t=base64.PADCHAR,a=base64.ALPHA,n=base64.getbyte,i,s,r=[];e=""+e;var l=e.length-e.length%3;if(0==e.length)return e;for(i=0;l>i;i+=3)s=n(e,i)<<16|n(e,i+1)<<8|n(e,i+2),r.push(a.charAt(s>>18)),r.push(a.charAt(s>>12&63)),r.push(a.charAt(s>>6&63)),r.push(a.charAt(63&s));switch(e.length-l){case 1:s=n(e,i)<<16,r.push(a.charAt(s>>18)+a.charAt(s>>12&63)+t+t);break;case 2:s=n(e,i)<<16|n(e,i+1)<<8,r.push(a.charAt(s>>18)+a.charAt(s>>12&63)+a.charAt(s>>6&63)+t)}return r.join("")},$(function(){FastClick.attach(document.body)}),document.addEventListener("touchstart",function(){},!0);